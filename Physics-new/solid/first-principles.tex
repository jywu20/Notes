\chapter{晶体}\label{chap:components}

\section{原子物质的哈密顿量}

普通的固体、液体、气体由一系列原子组成。通过实验和计算可以发现，原子的最外层电子在各种过程中容易发生重新排列，称为\concept{价电子}；内层电子和原子核（合称为\concept{离子实}）则通常保持为一个整体，也即，其内部状态发生变化的物理过程的描述需要使用QCD，其涉及的能标远高于价电子发生变化涉及的能标。

本文基本上只分析涉及价电子低能运动的物理过程，即只讨论非相对论极限下的电荷-电磁场耦合系统，而忽略强相互作用、弱相互作用和引力。
此时，带电粒子由薛定谔场完全描述，系统具有$U(1)$规范对称性且无粒子数生灭，有确定的粒子数，于是可以原则上实物粒子部分可以直接用单粒子量子力学描述。
进一步，我们假定系统中没有变化特别快的电磁场，这意味着实际上我们可以积掉电磁场并且得到一个延迟不明显的相互作用，那就是说，我们可以把所有电磁相互作用都用静电学和静磁学处理。由于无论是电子还是离子实都是非相对论性的，电子-电子相互作用、电子-离子实相互作用、离子实-离子实相互作用几乎完全是库伦相互作用。

\subsection{动能和库伦能}

设有$N_e$个价电子，$N_i$个离子实（i表示离子），不考虑外界扰动的一次量子化哈密顿量为
\begin{equation}
    {H} = {H}_\text{e} + {H}_\text{i} + {H}_\text{ei},
    \label{eq:many-body-hamiltonian}
\end{equation}
其中${H}_\text{e}$表示仅涉及价电子的哈密顿量，${H}_\text{i}$表示仅涉及离子实的哈密顿量，最后一项则是两者的相互作用，所有相互作用是库仑相互作用。
诸价电子组成的系统就好像由电子组成的气体，称为\concept{相互作用电子气}。单体哈密顿量为电子的动能项加上单体势能项。在物质不受外界作用时当然不应该有单体势能项，于是
\[
    {H}_\text{e1} = \frac{{\vb*{p}}^2}{2m},
\]
在坐标表象下它就是
\[
    {H}_\text{e1} = - \frac{\laplacian}{2m}.
\]
二体哈密顿量为电子两两作用而产生的库伦势能是
\[
    {H}_\text{e2} = \frac{e^2}{\abs{\vb*{r}_1 - \vb*{r}_2}},
\]
从而价电子本身的能量以及它们之间发生库伦相互作用的能量就是
\begin{equation}
    {H}_\text{e} = \sum_{i=1}^{N_\text{e}} \frac{{p}_i^2}{2m_\text{e}} + \frac{1}{2} \sum_{i\neq j} \frac{e^2}{\abs{\vb*{r}_i - \vb*{r}_j}}.
\end{equation}
使用类似的方法，离子实的组成的系统（如果是晶体那就是晶格）的哈密顿量为
\begin{equation}
    {H}_\text{i} = \sum_{\alpha=1}^{N_\text{i}} \frac{{p}_\alpha^2}{2m_i} + \frac{1}{2} \sum_{\alpha\neq\beta} V(\vb*{R}_\alpha-\vb*{R}_\beta).
\end{equation}
由于离子实中的内层电子结构复杂，离子实之间的相互作用能写不出特别简单的表达式（我们相当于把内层电子的自由度也积掉了）。请注意这个相互作用能是平移不变的，这是当然的，因为QED是平移不变的；但是实际的固体在短距离上并不是平移不变的，因为在低能下有对称性自发破缺。
离子实和价电子的相互作用则是
\begin{equation}
    {H}_\text{ei} = \sum_{\alpha, i} V_\text{ei}(\vb*{r}_i-\vb*{R}_\alpha). 
\end{equation}
分别使用$i$表示价电子，用$\alpha$表示离子实；由于价电子和离子实不全同，不需要加上$1/2$系数。
同样我们还是假定了相互作用本身的平移不变性。
本文仅仅讨论固体（实际上主要是晶体）的物理，因此我们将假定离子实的位移始终局限在非常小的范围内。

\begin{back}{量子涨落}{quantum-fluctuation}
    “量子涨落”一词的含义其实有一些不清楚之处。

    由于量子理论中的哈密顿量可以有彼此不对易的项，计算该哈密顿量的配分函数必然会得到一个路径积分，每条路径上，不同虚时间点的物理量可以任意取值，而路径积分权重中将会出现一个Berry相位项（如$\pi \dot{\phi}$项），这个现象就可以称为量子涨落。
    $\hbar \to 0$或者说取鞍点近似时，这个Berry相位项就是勒让德变换中的$\pi \dot{\phi}$项。

    这个说法的经典极限此时是有一定的微妙之处的，就平衡态统计中的配分函数而言，取$\hbar \to 0$似乎会让配分函数变成简单的$\sum \ee^{-\beta H}$，每条路径都没有虚时间演化；但是另一方面，经典动力学中$\hbar \to 0$时虽然哈密顿量中没有不对易的项，但是物理量的时间演化还是有的。
    这个微妙之处是必然会出现的，因为量子力学中我们依靠算符的非平庸对易关系（$[H, A]$）来获得时间演化，求经典极限时，直接关于哈密顿量的配分函数在$\hbar \to 0$极限下退化为$\sum \ee^{-\beta H}$，但是海森堡运动方程由于有$1/\hbar$的前置因子，会给出经典的哈密顿运动方程。
    这也体现出了“经典统计物理”的内在张力：经典统计物理相比量子统计物理更加难以良定义。
    某种意义上不存在纯粹的经典统计物理：例如，计算服从牛顿力学的经典粒子系统的配分函数时如果同时以$\vb*{r}$和$\vb*{p}$为变量，则必须引入相空间离散化，实际上这是用到了坐标和动量的不确定性关系的。

    在求解薛定谔方程时，可以将发生得较慢的过程涉及到的物理量当成不变的，或者将量子效应不明显的那部分系统用经典动力学处理，这就称为“忽略量子涨落”，其意义是显然的。

    经典物理的微扰求解实际上也是可以用费曼图表示的，只不过这种费曼图中的粒子线的方向必须严格体现“事件发生的顺序”\cite{hellingsolving}。因此，量子场论中超出经典场论的费曼图的那部分费曼图也可以称为量子涨落。

    还有一种“量子涨落”的定义是物理量在能量本征态下的方差。这种定义的量子涨落和前述“系统构型的虚时间演化”是紧密相关的：如果物理量$A$的方差很大，这意味着它和哈密顿量里面的某些项强烈地不对易，从而它有时间演化。
    然而，这个对量子涨落的定义会导致一定的混淆。
    我们也经常将偏离基态的系统构型称为“涨落”，因此会有“低能下的涨落”之说，即系统的低能自由度。
    然而，如果一个物理量$A$在低能能量本征态下的方差很大，那么它显然不适合用于标记系统的低能自由度。
    因此，如果$A$“具有很强的量子涨落”，那么$A$“不是系统的低能涨落”！
    例如，在$\sigma^z$铁磁序中，$\sigma^x$“有很强的量子涨落”，但是它不是系统的低能涨落。
    规范场的禁闭相中规范场有很强的量子涨落（否则规范荷不可能被紧紧束缚在一起：例如，设一个规范荷被外场移动了一些，很快强烈的规范场被激发出来将另一个规范荷也移动相同距离，然后规范场强度下降），但是系统的低能涨落中不包括规范场涨落。
\end{back}

在大部分过程中，由于原子核的质量比电子的质量大至少三个数量级，涉及价电子的过程通常比涉及离子实的过程发生得快很多，从而在价电子的时间尺度上，诸离子实的位置可以看成是给定的。
从而，在分析价电子时我们可以将${H}_i$项直接略去，并忽略离子实位置的量子涨落，而将${H}_\text{ei}(\vb*{r}_i-\vb*{R}_\alpha)$项对$\vb*{R}_\alpha$求和得到$V_\text{ion}(\vb*{r}_i)$。这个近似称为\concept{玻恩–奥本海默近似}。这样一来相互作用电子气的一次量子化哈密顿量在坐标表象下就是
\begin{equation}
    {H} = \sum_{i=1}^{N_\text{e}} \left( - \frac{\laplacian}{2m_\text{e}} + V_\text{ion}(\vb*{r}_i)\right) + \frac{1}{2} \sum_{i\neq j} \frac{e^2}{\abs{\vb*{r}_i - \vb*{r}_j}},
    \label{eq:electron-gas-hamiltonian}
\end{equation}
从而二次量子化哈密顿量为
\begin{equation}
    \begin{aligned}
        {H} = &\sum_{\sigma} \int \dd[3]{\vb*{r}} {\psi}_\sigma^\dagger(\vb*{r}) \left( - \frac{\laplacian}{2m} + V_\text{ion}(\vb*{r}) \right) {\psi}_\sigma(\vb*{r}) \\
        &+ \frac{1}{2} \sum_{\alpha, \beta} \int \dd[3]{\vb*{r}_1} \int \dd[3]{\vb*{r}_2} 
        {\psi}_\alpha^\dagger (\vb*{r}_1) {\psi}_\beta^\dagger (\vb*{r}_2) \frac{e^2}{\abs{\vb*{r}_1 - \vb*{r}_2}} {\psi}_\beta (\vb*{r}_2) {\psi}_\alpha (\vb*{r}_1). 
    \end{aligned}
    \label{eq:electron-gas-hamiltonian-sq}
\end{equation}
其中${\psi}^\dagger(\vb*{r})$是薛定谔场的场算符，它也是在位置为$\vb*{r}$的位置产生一个电子的产生算符。这个哈密顿量当然也可以通过QED的低能近似得到，但并没有必要这么做。请注意电子是费米子。
\eqref{eq:electron-gas-hamiltonian-sq}实际上不是对角的，因为它的单粒子项涉及一个梯度算符。
另一方面，离子实的相互作用可以认为遵从由电子总能量确定的等效势，%
\footnote{
    注意，先计算电子-电子库伦散射导致的能量然后用它计算晶格中离子实的相互作用最后计算离子实振动对电子的影响，这个过程中\emph{没有}双重计数，虽然我们表面上似乎“积掉了电子而计算等效的原子间相互作用”。
}%
可以列写晶格的薛定谔方程求解其位置。
然而由于离子实通常比较大，我们很多时候会彻底忽略离子实位置的量子涨落而使用分子动力学方法处理它。

最后我们指出，由于凝聚态介质始终可以和外界交换电子——外界的电子可以进入系统，系统中的电子可以溢出——系统中电子气本身的哈密顿量\eqref{eq:electron-gas-hamiltonian-sq}不足以充分描述系统。
本文将只研究近平衡系统，因此这种与外界的相互作用可以使用化学势描述，即我们需要在\eqref{eq:electron-gas-hamiltonian-sq}中加入一项$-\mu {\psi}^\dagger(\vb*{r}) {\psi}(\vb*{r})$，这样得到的哈密顿量才是完整的。
换而言之，电子气完整的哈密顿量形如
\begin{equation}
    \begin{aligned}
        {H} &= \sum_{\vb*{k}, \sigma} \Big( \underbrace{\frac{\vb*{k}^2}{2m}}_{\epsilon_{\vb*{k}}} - \mu \Big) {c}^\dagger_{\vb*{k} \sigma} {c}_{\vb*{k} \sigma} 
        + \int \dd[3]{\vb*{r}} V_\text{ion}(\vb*{r}) {\psi}^\dagger(\vb*{r}) {\psi}(\vb*{r}) \\ 
        &+ \frac{1}{2} \sum_{\alpha, \beta} \int \dd[3]{\vb*{r}_1} \int \dd[3]{\vb*{r}_2} 
        {\psi}_\alpha^\dagger (\vb*{r}_1) {\psi}_\beta^\dagger (\vb*{r}_2) \frac{e^2}{\abs{\vb*{r}_1 - \vb*{r}_2}} {\psi}_\beta (\vb*{r}_2) {\psi}_\alpha (\vb*{r}_1).
    \end{aligned}
    \label{eq:full-electron-gas-hamiltonian}
\end{equation}
在有些模型中有时也将外势场并入$\epsilon_{\vb*{k}}$项。
为了简便起见，通常用$\xi$表示扣除了化学势的单电子能量，即
\begin{equation}
    \xi_{\vb*{k}} = \epsilon_{\vb*{k}} - \mu.
\end{equation}

\subsection{哈密顿量的一般形式}

以上我们都是将库伦相互作用加入薛定谔场中，可以说是给出了第一性原理计算需要的哈密顿量（虽然实际上从高能物理的角度这远非第一性原理，但对凝聚态理论来说通常已经够用了）。
但实际上还有以下机制没有考虑：
\begin{itemize}
    \item 作用在单体上的外场的束缚，离子实的束缚已经被计入考虑了，但是还有其它外场，比如说或许会有一个磁场，然后哈密顿量中将会有一项$-\vb*{\mu} \cdot \vb*{B}$；无论如何这会是一个单粒子算符。
    \item 电子-声子相互作用会引入一个二电子和一个声子发生相互作用的顶角，积掉声子自由度之后会留下一个等效的电子-电子相互作用，这会让\eqref{eq:full-electron-gas-hamiltonian}中电子-电子相互作用的系数发生变化，不再是严格的库伦排斥。
\end{itemize}
于是我们写出一般形式的相互作用电子气的二次量子化哈密顿量：
\begin{equation}
    {H} = \sum_{\vb*{k}, \sigma} (T_{\vb*{k}} - \mu) {c}^\dagger_{\vb*{k} \sigma} {c}_{\vb*{k} \sigma} 
    + \sum_{\vb*{k}_1, \vb*{k}_2, \sigma} V_{\vb*{k}_1 \vb*{k}_2 \sigma} {c}^\dagger_{\vb*{k}_1 \sigma} {c}_{\vb*{k}_2 \sigma}
    + \sum_{\vb*{k}_1, \vb*{k}_2, \vb*{q}, \alpha, \beta} {c}^\dagger_{\vb*{k}_1+\vb*{q}, \alpha} {c}^\dagger_{\vb*{k}_2-\vb*{q}, \beta} V_{\vb*{q}} {c}_{\vb*{k}_2 \beta} {c}_{\vb*{k}_1 \alpha}. 
\end{equation}
相应的，热力学作用量为
\begin{equation}
    S = \sum_n \left( 
        \sum_{\vb*{k}, \sigma} (-\ii \omega_n + T_{\vb*{k}} - \mu) \bar{c}_{\vb*{k} \sigma} c_{\vb*{k} \sigma} 
        + \sum_{\vb*{k}_1, \vb*{k}_2, \sigma} V_{\vb*{k}_1 \vb*{k}_2 \sigma} \bar{c}_{\vb*{k}_1 \sigma} c_{\vb*{k}_2 \sigma} 
        + \frac{1}{2V} \sum_{\vb*{k}_1, \vb*{k}_2, \vb*{q}, \sigma} \bar{c}_{\vb*{k}_1+\vb*{q}, \sigma} \bar{c}_{\vb*{k}_2-\vb*{q}, \sigma} V_{\vb*{q}} c_{\vb*{k}_2 \sigma} c_{\vb*{k}_1 \sigma} \right). 
        \label{eq:general-electron-electron-interaction}
\end{equation}
上式中的动能项和相互作用项的形式由对称性确定，具体系数可以暂时不设置具体值（因为直接从\eqref{eq:full-electron-gas-hamiltonian}出发做重整化群计算显然是非常困难的）。
我们经常写出一些简化了的模型以复现某个现象，如忽略一部分动能（即忽略一部分电子跃迁方式），或者简化相互作用形式。

\begin{back}{量子多体系统中的理论与数值计算方法}{manybody-theory}
    \begin{itemize}
        \item 费曼图微扰计算（需要注意由于库伦相互作用是瞬时而超距的，通常将库仑相互作用顶角写成用虚线连接的两个顶角，每个顶角有一个电子入射和一个电子出射，虚线可以携带动量），由于相互作用是二体的，在相互作用较弱时计算一到二圈图就可以得到很好的效果，不过实际上相互作用并不总是那么弱，此时需要一些其它近似手段，如RPA近似等各种重求和方法。
        \item 做平均场计算并与实验或数值计算作比较（可以对原来的模型做平均场也可以对Hubbard-Stratonovich变换之后的辅助场做平均场，两者等价）。
        考虑平均场之上的涨落，获得一个关于平均值附近涨落的理论，具体方法通常是这样的：由于相互作用项是四阶的，可以使用Hubbard-Stratonovich变换引入一个辅助场，通过适当选取辅助场（通常要和某个有趣的序参量具有同样的对称性）并积掉电子自由度，则接近临界点时，辅助场满足的场论就给出了长程自由度。
        \item 密度泛函理论方法：凝聚态系统彼此不同的地方其实就在于晶格势场，我们只需要找到系统基态的一些量，如电子数密度等，能够和晶格势场建立一一对应关系即可，然后通过一些办法把系统总能量写成系统基态的这些量的泛函，通过优化该泛函，就得到了不少关于基态的性质，并且在适当的近似下能够计算出关于系统的全部信息。
        \item 量子蒙特卡洛方法、张量网络方法等数值方法。
    \end{itemize}

    量子多体系统通常都足够复杂，且可能有很强的相互作用，以至于分析方法多种多样，但是没有哪一种能够占有支配地位。
\end{back}

\subsection{外加电磁场}

现在讨论外加电磁场导致的哈密顿量变化，或者说“辐射和物质相互作用”导致的哈密顿量变化。
一般的，设系统被放置在电磁场$(\varphi, \vb*{A})$中，则一次量子化哈密顿量（使用一次量子化哈密顿量是为了和经典的“一群电子定向移动”的物理图像对应上）为
\begin{equation}
    {H} = \frac{1}{2m} \sum_i ({\vb*{p}_i} - q_i \vb*{A}({\vb*{r}_i}))^2 + \sum_i q_i \varphi({\vb*{r}}_i) + {H}_\text{int},
    \label{eq:hamiltonian-with-eb-original}
\end{equation}
其中$\vb*{p}$是正则动量，${H}_\text{int}$表示粒子间相互作用。
本文仅考虑外加电磁场产生的线性响应，于是考虑辐射场不很强以至于$\vb*{A}^2$可以忽略的情况，也即，仅保留单光子过程，或者说做偶极辐射近似。%
\eqref{eq:hamiltonian-with-eb-original}的导出见\opticsdoc，其中第\ref{optics-sec:particle-hamiltonian}节解释了将辐射场和库伦相互作用分开的方式，第\ref{optics-sec:multipole}节解释了偶极辐射近似。

对电子系统，$q=-e$，那么就有
\begin{equation}
    \begin{aligned}
        {H} &= \frac{1}{2m} \sum_i ({\vb*{p}_i} + e \vb*{A}({\vb*{r}_i}))^2 - e \sum_i \varphi({\vb*{r}}_i) + {H}_\text{int} \\ 
        &= - \frac{1}{2m} \sum_i (\grad + \ii e \vb*{A}({\vb*{r}_i}))^2 - e \sum_i \varphi({\vb*{r}}_i) + {H}_\text{int}.
    \end{aligned}
\end{equation}
设$\Omega$是某个空间区域，电流密度为$\vb*{J}$，则
\begin{equation}
    \int_\Omega \dd[3]{\vb*{r}} {\vb*{J}} = - \sum_i e {\vb*{v}}_i,
\end{equation}
其中$\vb*{v}_i$是电子移动的速度，满足
\begin{equation}
    {\vb*{v}}_i = \pdv{H}{\vb*{r}_i} = \frac{{\vb*{p}}_i + e \vb*{A}({\vb*{r}}_i)}{m}.
\end{equation}
考虑到$\Omega$的任意性，我们就有以下近似表达式：
\begin{equation}
    {\vb*{J}} = \underbrace{- \frac{e}{m} \sum_i ( \delta(\vb*{r} - {\vb*{r}}_i) {\vb*{p}} + {\vb*{p}} \delta(\vb*{r} - {\vb*{r}}_i) )}_{{\vb*{j}}} \underbrace{- \frac{e^2}{m} {n}_\text{e}}_{{\vb*{j}}_\text{D}} \vb*{A}.
\end{equation}
${\vb*{j}}$项特意被写成了厄米的形式；${\vb*{j}}_\text{D}$已经做了一遍粗粒化了，将诸$\vb*{A}_i$平均了一遍。
通常这是合理的，因为电磁波的波长通常不会特别小，从而不会有很大的空间起伏。（而如果有很大的空间起伏，我们就会使用cQED而不是经典电动力学讨论问题了）

现在写出略去高阶项的哈密顿量的形式。选取库伦规范，并认为$\varphi=0$，此时会发现，实际上我们有
\[
    {H} = \frac{1}{2m} \sum_i {\vb*{p}}_i^2 + {H}_\text{int} + \frac{e}{m} \sum_i {\vb*{p}}_i \cdot \vb*{A}({\vb*{r}}_i) - e \sum_i \varphi({\vb*{r}_i}),
\]
$\vb*{A}({\vb*{r}}_i)$和${\vb*{p}}_i$本来是不对易的，但是库伦规范下它们对易。
代入${\vb*{J}}$的表达式并再次略去高阶项，就有
\[
    {H} = \frac{1}{2m} \sum_i {\vb*{p}}_i^2 + {H}_\text{int} - \int \dd[3]{\vb*{r}} {\vb*{J}} \cdot \vb*{A} - e \sum_i \varphi({\vb*{r}_i}).
\]
至于含有电势的那一项，注意到电荷密度为
\[
    {\rho} = - e \sum_{i} \delta({\vb*{r}}_i - \vb*{r}),
\]
于是最后得到
\begin{equation}
    {H} = \frac{1}{2m} \sum_i {\vb*{p}}_i^2 + {H}_\text{int} + \int \dd[3]{\vb*{r}} \varphi {\rho} - \int \dd[3]{\vb*{r}} {\vb*{J}} \cdot \vb*{A}.
\end{equation}
虽然物质本身的哈密顿量不是洛伦兹协变的（因为取了非相对论近似），但是物质和辐射的相互作用项却是洛伦兹协变的——对电磁场的描述一般都是如此。
以上哈密顿量实际上仅仅讨论了轨道部分，电子还有自旋磁矩
\[
    {H}_{\text{spin}} = \sum_i {\vb*{\mu}}_i \cdot \vb*{B}({\vb*{r}}_i),
\]
我们可以如法炮制地将它写成
\[
    {H}_{\text{spin}} = \int \dd[3]{\vb*{r}} {\vb*{\mu}} \cdot \vb*{B}.
\]
因此完整的哈密顿量实际上是
\begin{equation}
    {H} = - \frac{1}{2m} \sum_i {\vb*{p}}_i^2 + {H}_\text{int} + \int \dd[3]{\vb*{r}} \varphi {\rho} - \int \dd[3]{\vb*{r}} {\vb*{J}} \cdot \vb*{A} + \int \dd[3]{\vb*{r}} {\vb*{\mu}} \cdot \vb*{B}.
    \label{eq:hamiltonian-with-eb}
\end{equation}
所有和单粒子携带的电荷数量有关的量全部被藏在电荷密度和电流密度中了，上式在电荷正反变换下不变。

\eqref{eq:hamiltonian-with-eb}当然也可以非常容易地写成二次量子化的形式。
薛定谔场满足$U(1)$对称性，因此通过诺特定理可以得到守恒荷（当然就是电荷）
\begin{equation}
    \rho = - e \sum_\sigma {\psi}^\dagger_\sigma {\psi}_\sigma = - e {n}_\text{e},
\end{equation}
守恒流（也即电流密度）
\begin{equation}
    {\vb*{j}} = - \frac{\ii e}{2m} \sum_\sigma ({\psi}_\sigma^\dagger(\vb*{r}) \grad{{\psi}_\sigma}(\vb*{r}) - (\grad{{\psi}_\sigma^\dagger}(\vb*{r})) {\psi}_\sigma(\vb*{r})) - \frac{e^2}{m} \vb*{A}(\vb*{r}) \sum_\sigma {\psi}^\dagger_\sigma(\vb*{r}) {\psi}_\sigma(\vb*{r}),
\end{equation}
而另一方面自旋磁矩为
\begin{equation}
    {\vb*{\mu}} = {\psi}^\dagger_\alpha \vb*{\sigma}_{\alpha \beta} {\psi}_\beta.
\end{equation}
这样就把三个对外加电磁场的线性响应全部写成二次量子化的形式了；我们可以用推迟格林函数计算出有关的响应大小。

由线性响应理论，我们有
\[
    \begin{aligned}
        \expval*{{J}_i}_A (t) &= \expval*{{J}_i}_0 + \ii \int \dd{t} \int \dd[3]{\vb*{r}'} \theta(t-t') \expval*{\comm*{{J}_i(\vb*{r}, t)}{{J}_j(\vb*{r}', t')}} A_j(\vb*{r}', t') \\
        &= - \frac{e^2}{m} \expval*{{n}_\text{e}} A_i + \ii \int \dd{t} \int \dd[3]{\vb*{r}'} \theta(t-t') \expval*{\comm*{{j}_i(\vb*{r}, t)}{{j}_j(\vb*{r}', t')}} A_j(\vb*{r}', t').
    \end{aligned}
\]
这里的$i, j$为维度脚标，并不表示粒子编号，且使用爱因斯坦求和约定；下标$A$表示有外场$\vb*{A}$时的期望值；${j}_i$的无外场期望是零，这是对称性的结果。

实际上，电阻率定义为%
\footnote{$\vb*{A}(\vb*{r}, t)$完全可以不是时间、空间平移不变的，但是既然我们将$\vb*{A}$当成扰动，只需要无扰动的系统的动力学时间、空间平移不变即可。}%
\begin{equation}
    J_i(\vb*{r}, t) = \int \dd[3]{\vb*{r}'} \int_{-\infty}^t \sigma_{ij}(\vb*{r}-\vb*{r}', t - t') E_j(\vb*{r}', t'),
\end{equation}
于是为了避免繁琐的时间上的微积分我们切换到频域上，有
% TODO:确认记号问题

现在我们回到二次量子化的框架下，考虑怎么计算有关的推迟格林函数。

在虚时间路径积分中不能简单地将\eqref{eq:hamiltonian-with-eb-original}（从而，\eqref{eq:hamiltonian-with-eb}）做勒让德变换。
在这两个哈密顿量中有一个$U(1)$规范场$(\varphi, \vb*{A})$，由于规范对称性的存在，实际上只有$\vb*{A}$是独立的自由度，因此不能保证在Wick转动中含有$\varphi$的项是不变的。
最简单的从\eqref{eq:hamiltonian-with-eb-original}推导出虚时间路径积分的方法是最小耦合。我们知道$\varphi \rho$项会出现本质上是因为加入$U(1)$规范场之后需要将导数替换为协变导数，而可以验证以下替换
\begin{equation}
    \partial_\tau \longrightarrow \partial_\tau - \ii e \varphi, \quad - \ii \grad \longrightarrow - \ii \grad + e \vb*{A} 
    \label{eq:imaginary-em-covariant-derivative}
\end{equation}
给出了虚时间场论中的协变导数，于是在自由理论中做这个替换就得到了与电磁场发生相互作用的电子场的虚时间配分函数。

这样会带来一个疑难，就是Wick转动后电势前面多出来了一个负号；但是凝聚态理论中电子可以被放在一个势场中，显然Wick转动后势场前面不需要多出来一个负号。
这个疑难的解答是，含有$\ii e \varphi \rho$项的理论描述了一个电子场和一个电磁场的耦合，而“电子置于势场中”的模型中电磁场已经被积掉了。
如果将电磁场积掉，按照高斯积分的原理，$e \varphi \rho$项前面会多一个负号，并且要乘以系数$\ii$的平方，于是我们发现Wick转动后前面不需要多出来一个负号的势场出现了。

在以上的推导中，我们均取$e>0$为正的元电荷；在分析电子系统时，还有一种记号是取$e<0$，令$\abs*{e}$为元电荷。
这样可以让电子系统的配分函数看起来更像是直接从$U(1)$规范不变性得到的（即$\vb*{p}$替换成$\vb*{p} - e \vb*{A}$），从而看起来更加接近高能物理中的记号。
此处我们采用第一种记号，认为$e > 0$。

\section{晶格形成}

所谓晶体指的是一种在三个独立的空间方向上具有离散的平移不变性且并没有连续平移不变性的物体。\eqref{eq:many-body-hamiltonian}显然具有连续的平移不变性，因此晶体的形成必然经历了对称性自发破缺，且在较高的能量下原本的晶体一定会相变成某种更加均匀的东西。
本章将展示组成晶体的离子实是具体如何组成晶体的。原则上可以有哪些晶体见\autoref{chap:lattice-structure}。

将固体分解为组成它的组件所需的能量称为\concept{内聚能}。造成内聚的相互作用方式包括：
\begin{itemize}
    \item 离子键，离子之间的库伦引力。
    \item 共价键，相对局域的电子云的重叠导致的等效原子间吸引力。
    \item 金属键，离域电子组成大范围的电子气，导致等效的原子间吸引力。此时静电屏蔽非常强，从而正电荷可以看成均匀的“凝胶”。很直观地，晶格中原子排列的具体形式没有特别的要求。
    \item 范德华力，一种分子之间较弱的相互作用力，键能很低，大体上可以分为取向力、诱导力、色散力。
    \item 氢键，几乎裸露的氢原子和其它原子的吸引力，比范德华力强但比真正的化学键弱。
\end{itemize}
这些吸引相互作用不能让原子无限制地靠近。这包括两个原因。
首先，当然是因为原子核带正电，彼此之间存在排斥，正如氢分子的形成时，电子成键能够降低能量，而原子核靠近会增高能量。
然而对稍微大一些的原子，内层电子的屏蔽就很明显，此时阻止原子靠近的主要因素是电子距离足够近时的\concept{泡利排斥能}。
举一个极端的例子：设两个氦原子核距离非常接近，此时1s轨道上似乎应该有四个电子。
如果电子不遵循费米统计，多电子态就是单电子波函数的直积，那么的确电子-电子库伦排斥会增强，但是电子介导的原子核之间的吸引相互作用也会增强。
然而，由于费米统计，实际上两个电子要出现在高于1s轨道的轨道上，因此能量大大增大，并且没有什么能够弥补这种能量增大。
即使没有电子-电子库伦排斥，费米统计也会导致原子核接近时体系能量增大，这就是泡利排斥能。

可以使用\concept{分子轨道理论}近似地分析共价键：设有两个（可以不一样的）原子A和B。我们在两个原子周围各自取一个单原子电子波函数（即所谓原子轨道），然后将来自另一个原子的库伦吸引力当成微扰。
如果作为出发点的两个原子轨道能量差别不大，那么考虑了来自另一个原子的相互作用之后，将会出现显著的能级劈裂。
较低的那个能级就是\concept{成键轨道}，而较高的那个能级就是\concept{反键轨道}，它们是彼此正交的、原来两个原子轨道的线性组合。
最后，引入电子-电子相互作用，但是仍然假定多电子波函数近似为两个单电子波函数的直积（这就是\concept{分子轨道}一说的来历：我们假定系统中仍然有定义良好的单电子轨道，尽管此时这个轨道遍布整个分子）。
此时电子-电子相互作用导致的一阶能量修正包括一项密度-密度排斥力和一项交换相互作用。前者会让成键轨道上的电子相互排斥，然而无论怎么放置这两个电子，都会有互相排斥；后一项在成键轨道上有两个自旋相反的电子时却会让两个电子相互吸引。
如果总的电子-电子相互作用导致的修正没有大过成键轨道能量降低的量，那么一个共价键就形成了：因为电子放在成键轨道上能够降低总能量。
直观地看，此时成键轨道上的两个电子的电子云互相重叠，由于没有特别紧密地重叠，库伦排斥并不是特别大，而两个原子中间的这团电子云同时受到两边的原子的库伦吸引，因此就在两个原子之间建立了明显的等效吸引力。
反之，如果一开始的两个原子轨道能量相差很大，那么成键轨道和反键轨道和原来的两个原子轨道没有什么差别，电子放在成键轨道上不能降低多少能量，此时也不会有等效的强烈的原子-原子相互作用，也就没有共价键。

金属键弥散到整个金属晶体中，原子-原子间的等效吸引力没有特别明显的方向性之类，原子排列得越密集，库伦能越低。
这就是金属中密排结构特别常见的原因。
但是另外一方面，原子密排又会导致电子动量增大，以及泡利不相容原理导致的排斥。

关于如何为原子和分子间的各种相互作用建模，见\softdoc中的第\ref{soft-sec:molecular-interaction}节。

\section{固体系统的表征}

表征一个固体系统通常可以使用的方法，或者说固体系统常见的可测量量（这里不是指可观察量算符，而是指真的做量子测量能够测出来的物理量，比如说期望，等等），包括导电性、磁性、对电磁波的响应、力学和热学性质。

\subsection{热学和固体力学}

热学性质——从而固体力学性质——经常可以使用自由粒子的模型来估计。
一种无相互作用的粒子的哈密顿量是完全对角化的：
\[
    H = \sum_{\vb*{k}, \sigma} \omega_{\vb*{k}\sigma} \left(n_{\vb*{k} \sigma} + \frac{1}{2}\right),
\]
于是对配分函数的贡献为
\begin{equation}
    Z = \sum_{E_i} \ee^{- \beta E_i} = \ee^{-\beta E_{\text{eq}}} \prod_{\vb*{k}, \sigma} \ee^{- \beta \frac{\omega_{\vb*{k}\sigma}}{2}} \sum_{n_{\vb*{k}, \sigma}} \ee^{-\beta \omega_{\vb*{k}\sigma} n_{\vb*{k} \sigma}},
\end{equation}
因此这种粒子对内能的贡献为
\begin{equation}
    U = E_{\text{eq}} + \sum_{\vb*{k}, \sigma} \left( \frac{1}{2} + \frac{1}{\ee^{\beta \omega_{\vb*{k}\sigma}} - 1} \right) \omega_{\vb*{k}\sigma}.
\end{equation}
这样，等容热容为
\begin{equation}
    C_V = \left(\pdv{U}{V}\right)_V = \sum_{\vb*{k}, \sigma} \left(\frac{\omega_{\vb*{k}\sigma}}{T}\right)^2 \frac{\ee^{\omega_{\vb*{k}\sigma} / T}}{(\ee^{\omega_{\vb*{k}\sigma} / T} - 1)^2}.
\end{equation}
每种粒子都会对热容有一个贡献，相互作用会修正这个贡献。

\subsection{电磁响应和输运}

如果一种粒子携带某种荷，那么还可以观察到\concept{输运}。大体上输运过程可以分成两种，一种是粒子平均自由程远小于系统尺寸的过程，此时系统内部足以出现荷的梯度，输运流量和这种梯度有关，可以称为\concept{扩散}；另一种是粒子平均自由程大于系统尺寸的过程，此时系统内部的粒子基本上不受到任何阻碍，输运流量由系统边界上的性质确定，即所谓\concept{弹道输运}。

输运经常是依靠外加电磁场而产生的。
由于$\vb*{A}$耦合在$\vb*{j}$上，而能够决定极化电场的也无非是电子数密度，讨论电子气的电磁响应基本上就是要计算密度-密度关联函数。
如果不考虑电子之间的库仑相互作用，那么这是平凡的：诸如“谐振子受到电场策动，然后出现极化”的图像就能工作得很好。
在绝缘体中这大体上是正确的，在金属中则不见得是这样。
因此，比较精确地计算电子气的电磁响应，实际上就是需要将电子-电子库伦相互作用纳入计算，而这就很自然地要求我们使用一种完整的凝聚态场论。