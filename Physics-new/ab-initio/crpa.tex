\documentclass{beamer}
\usepackage{physics}
\usepackage{amsmath}
\usepackage{tikz}
\usepackage{mathdots}
\usepackage{yhmath}
\usepackage{cancel}
\usepackage{color}
\usepackage{siunitx}
\usepackage{array}
\usepackage{multirow}
\usepackage[version=4]{mhchem}
\usepackage{amssymb}
\usepackage{textcomp, gensymb}
\usepackage{pifont}
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%
\usepackage{tabularx}
\usepackage{extarrows}
\usepackage{booktabs}
\usetikzlibrary{fadings}
\usetikzlibrary{patterns}
\usetikzlibrary{shadows.blur}
\usetikzlibrary{shapes}
\usepackage[style=verbose,backend=bibtex]{biblatex}
\addbibresource{wannier.bib}
\addbibresource{hubbard.bib}
\addbibresource{pt.bib}
\renewcommand{\footnotesize}{\scriptsize}
\usepackage{listings}
\usepackage{hyperref}

\newcommand{\pair}[1]{\langle #1 \rangle}
\DeclareMathOperator{\ee}{e}
\DeclareMathOperator{\ii}{i}

\newcommand{\concept}[1]{\textbf{#1}}
\newcommand*{\abinitio}{\textit{ab initio}}
\newcommand{\shortcode}[1]{\texttt{#1}}

%Information to be included in the title page:
\title{Constrained RPA}
\author{Jinyuan Wu}

\usetheme{madrid}

\begin{document}

\frame{\titlepage}

\begin{frame}
\frametitle{Table of contents}

\tableofcontents    

\end{frame}

\section{Important papers}

\begin{frame}
\frametitle{Important papers about cRPA}

\begin{itemize}
    \item \cite{aryasetiawan2004frequency}
    \item \cite{aryasetiawan2011constrained}
\end{itemize}

\end{frame}

\section{General idea}

\begin{frame}
\frametitle{Motivation}

Strongly correlated electrons are \dots
\begin{itemize}
    \item Hard to treat \abinitio
    \item Should be described by a lattice model
\end{itemize}    

\begin{equation}
    H = - t \sum_{\pair{\vb*{i}, \vb*{j}}, \sigma}
        c^\dagger_{\vb*{i} \sigma} c_{\vb*{j} \sigma}
        + \text{h.c.}
        + U \sum_{\vb*{i}} n_{\vb*{i} \uparrow} n_{\vb*{i} \downarrow}.
\end{equation}

But should all electrons be included?

\begin{itemize}
    \item $d$ electron: correlated ones 
    \item $r$ electron: ``trivial'' ones
\end{itemize}

\end{frame}

\begin{frame}
\frametitle{Diagrammatics}

Screening by $d$ and $r$ = first screened by $r$ and then $d$

\begin{equation}
    W = (1 - v P)^{-1} v = (1 - W_r P_d)^{-1} W_r, \quad 
    W_r = (1 - v P_r)^{-1} v,
\end{equation}
\begin{itemize}
    \item $W$ is effective interaction 
    \item where $P_d$ is the polarization within $d$ subspace,
    \item and $P_r = P - P_d$
\end{itemize}

\begin{center}
    \input{feyn/crpa-1.tex}
\end{center}

\end{frame}

\begin{frame}
\frametitle{Diagrammatics}

\begin{itemize}
    \item $P_d$ hard to obtain $\Rightarrow$ we left it to an effective interaction 
    without doing resummation for it
    \item $P_r$ can be done by \shortcode{epsilon} $\Rightarrow$
        $W_r$ can be obtained by \shortcode{epsilon}
    \item But 
    \begin{center}
        \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-0.6,xscale=0.6]
            %uncomment if require: \path (0,300); %set diagram left start at 0, and has height of 300
            
            %Straight Lines [id:da24436922749346324] 
            \draw    (347.33,149.91) -- (359.75,149.91) ;
            %Straight Lines [id:da2754743780079656] 
            \draw    (419.75,150.66) -- (432.16,150.66) ;
            %Shape: Arc [id:dp8646599824167052] 
            \draw  [draw opacity=0][line width=1.5]  (359.75,149.91) .. controls (359.92,133.49) and (373.29,120.23) .. (389.75,120.23) .. controls (406.32,120.23) and (419.75,133.66) .. (419.75,150.23) .. controls (419.75,150.37) and (419.75,150.52) .. (419.75,150.66) -- (389.75,150.23) -- cycle ; \draw  [color={rgb, 255:red, 208; green, 2; blue, 27 }  ,draw opacity=1 ][line width=1.5]  (359.75,149.91) .. controls (359.92,133.49) and (373.29,120.23) .. (389.75,120.23) .. controls (406.32,120.23) and (419.75,133.66) .. (419.75,150.23) .. controls (419.75,150.37) and (419.75,150.52) .. (419.75,150.66) ;  
            %Shape: Arc [id:dp0010091790996433758] 
            \draw  [draw opacity=0][line width=1.5]  (419.72,150) .. controls (419.73,150.32) and (419.73,150.64) .. (419.73,150.96) .. controls (419.73,167.53) and (406.3,180.96) .. (389.73,180.96) .. controls (373.17,180.96) and (359.73,167.53) .. (359.73,150.96) .. controls (359.73,150.61) and (359.74,150.26) .. (359.75,149.91) -- (389.73,150.96) -- cycle ; \draw  [color={rgb, 255:red, 208; green, 2; blue, 27 }  ,draw opacity=1 ][line width=1.5]  (419.72,150) .. controls (419.73,150.32) and (419.73,150.64) .. (419.73,150.96) .. controls (419.73,167.53) and (406.3,180.96) .. (389.73,180.96) .. controls (373.17,180.96) and (359.73,167.53) .. (359.73,150.96) .. controls (359.73,150.61) and (359.74,150.26) .. (359.75,149.91) ;  
            %Straight Lines [id:da4499744987871399] 
            \draw [color={rgb, 255:red, 208; green, 2; blue, 27 }  ,draw opacity=1 ]   (390.21,120.5) -- (391.75,120.49) ;
            \draw [shift={(394.75,120.48)}, rotate = 179.74] [fill={rgb, 255:red, 208; green, 2; blue, 27 }  ,fill opacity=1 ][line width=0.08]  [draw opacity=0] (9.82,-4.72) -- (0,0) -- (9.82,4.72) -- (6.52,0) -- cycle    ;
            %Straight Lines [id:da7286267028918754] 
            \draw [color={rgb, 255:red, 208; green, 2; blue, 27 }  ,draw opacity=1 ]   (390.71,180.75) -- (387.25,180.74) ;
            \draw [shift={(384.25,180.73)}, rotate = 0.18] [fill={rgb, 255:red, 208; green, 2; blue, 27 }  ,fill opacity=1 ][line width=0.08]  [draw opacity=0] (9.82,-4.72) -- (0,0) -- (9.82,4.72) -- (6.52,0) -- cycle    ; 
            \end{tikzpicture}            
    \end{center}
    is not in $P_r$, or otherwise we have double counting
    \item That's what we call \concept{constrained RPA (cRPA)}
    \item A program to calculate a single ring diagram is needed
\end{itemize}

\end{frame}

\begin{frame}
\frametitle{Band part}

In $GW$:

\begin{equation}
    \begin{aligned}
        \varepsilon^{GW} &= \varepsilon^0 + \Sigma^{\text{Hartree}} + \Sigma^{GW} \\
        &= \underbrace{\varepsilon^0 + \Sigma^{\text{Hartree}} + V^{\text{xc}}}_{\text{\shortcode{WFN}}} 
        + \underbrace{\Sigma^{GW}}_{\text{\shortcode{sigma}}} 
        - \underbrace{V^{\text{xc}}}_{\text{\shortcode{vxc.dat}}}
    \end{aligned}
\end{equation}

In the effective model \dots
\begin{itemize}
    \item We want $\varepsilon^0$ 
    \item So the same $-V^{\text{xc}}$ procedure is needed(?)
\end{itemize}

\end{frame}

\begin{frame}
\frametitle{Risks in accuracy}

Uncontrolled approximation: does RPA work for 
\begin{center}
    \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-0.6,xscale=0.6]
        %uncomment if require: \path (0,300); %set diagram left start at 0, and has height of 300
        
        %Straight Lines [id:da24436922749346324] 
        \draw    (347.33,149.91) -- (359.75,149.91) ;
        %Straight Lines [id:da2754743780079656] 
        \draw    (419.75,150.66) -- (432.16,150.66) ;
        %Shape: Arc [id:dp8646599824167052] 
        \draw  [draw opacity=0][line width=1.5]  (359.75,149.91) .. controls (359.92,133.49) and (373.29,120.23) .. (389.75,120.23) .. controls (406.32,120.23) and (419.75,133.66) .. (419.75,150.23) .. controls (419.75,150.37) and (419.75,150.52) .. (419.75,150.66) -- (389.75,150.23) -- cycle ; \draw  [color={rgb, 255:red, 208; green, 2; blue, 27 }  ,draw opacity=1 ][line width=1.5]  (359.75,149.91) .. controls (359.92,133.49) and (373.29,120.23) .. (389.75,120.23) .. controls (406.32,120.23) and (419.75,133.66) .. (419.75,150.23) .. controls (419.75,150.37) and (419.75,150.52) .. (419.75,150.66) ;  
        %Shape: Arc [id:dp0010091790996433758] 
        \draw  [draw opacity=0][line width=1.5]  (419.72,150) .. controls (419.73,150.32) and (419.73,150.64) .. (419.73,150.96) .. controls (419.73,167.53) and (406.3,180.96) .. (389.73,180.96) .. controls (373.17,180.96) and (359.73,167.53) .. (359.73,150.96) .. controls (359.73,150.61) and (359.74,150.26) .. (359.75,149.91) -- (389.73,150.96) -- cycle ; \draw  [color={rgb, 255:red, 74; green, 144; blue, 226 }  ,draw opacity=1 ][line width=1.5]  (419.72,150) .. controls (419.73,150.32) and (419.73,150.64) .. (419.73,150.96) .. controls (419.73,167.53) and (406.3,180.96) .. (389.73,180.96) .. controls (373.17,180.96) and (359.73,167.53) .. (359.73,150.96) .. controls (359.73,150.61) and (359.74,150.26) .. (359.75,149.91) ;  
        %Straight Lines [id:da4499744987871399] 
        \draw [color={rgb, 255:red, 208; green, 2; blue, 27 }  ,draw opacity=1 ]   (390.21,120.5) -- (391.75,120.49) ;
        \draw [shift={(394.75,120.48)}, rotate = 179.74] [fill={rgb, 255:red, 208; green, 2; blue, 27 }  ,fill opacity=1 ][line width=0.08]  [draw opacity=0] (9.82,-4.72) -- (0,0) -- (9.82,4.72) -- (6.52,0) -- cycle    ;
        %Straight Lines [id:da7286267028918754] 
        \draw [color={rgb, 255:red, 74; green, 144; blue, 226 }  ,draw opacity=1 ]   (390.71,180.75) -- (387.25,180.74) ;
        \draw [shift={(384.25,180.73)}, rotate = 0.18] [fill={rgb, 255:red, 74; green, 144; blue, 226 }  ,fill opacity=1 ][line width=0.08]  [draw opacity=0] (9.82,-4.72) -- (0,0) -- (9.82,4.72) -- (6.52,0) -- cycle    ;
        \end{tikzpicture}        
\end{center}

The hopping between $d$ electrons is small $\Rightarrow$ it's safe to do so 
\footcite{aryasetiawan2004frequency}

\end{frame}

\section{The problem of dynamic Hubbard model}

\begin{frame}
\frametitle{Dynamic interaction in Hubbard model}

Recall that $W = W(\vb*{r}, \vb*{r}, \textcolor{red}{\omega} )$
$\Rightarrow$ 
$U_{\vb*{i} \vb*{j} \vb*{k} \vb*{l}}(\omega)$
$\Rightarrow$
retarded interaction! 

\begin{itemize}
    \item Hamiltonian form: interactions are always immediate 
    (bosonic auxiliary field required to create retardation)
    \item \dots or path integral formalism is to be used 
    \item In either cases, it's slow!!! 
\end{itemize}

\end{frame}

\begin{frame}
\frametitle{Comment: frequency dependence in effective models}

This actually reflects something deep about downfolding \dots 

\begin{itemize}
    \item \concept{Hamiltonian effective theory; Rayleigh-Schrodinger perturbation theory.}
        In $1 / (E - H)$, 
        $E$ is unperturbed energy 
    \item \concept{Feynman diagram resummation}.  
        After splitting $G$ into $G^+$ and $G^-$,
        it's equivalent to Brillouin-Wigner perturbation theory;
        In $1 / (E - H)$, 
        $E$ is the \emph{perturbed} energy
    \item An item in BWPT splits into an infinite series in RSPT!\footcite{brueckner1955many}
        \begin{equation}
            \begin{aligned}
                E^{GW} &\simeq E^{\text{DFT}} + \ii W \frac{1}{E^{GW} - E^{\text{DFT}}} \\
                &= E^{\text{DFT}} + \ii W \frac{1}{E^{\text{DFT}} - E^{\text{DFT (other bands)}}}
                + \cdots
            \end{aligned}
        \end{equation}
        $\Rightarrow$ why we need eigenvalue self-consistency
\end{itemize}

\end{frame}

\begin{frame}
\frametitle{Dynamic interaction in Hubbard model}

Is it possible to just enforce $\omega = 0$ \dots
But it's not accurate!\footcite{aryasetiawan2004frequency}

\begin{center}
    \includegraphics[width=0.45\textwidth]{plots/ni-re-sigma-1.PNG}
    \includegraphics[width=0.45\textwidth]{plots/ni-im-sigma-1.PNG}
\end{center}

\ce{Ni} self-energy, from static Hubbard $U = W_r(\omega = 0)$,
and from full $W(\omega)$ 

\end{frame}

\begin{frame}
\frametitle{Dynamic interaction in Hubbard model}

\textbf{Why $\Im \Sigma$ is better captured by static $U$ than $\Re \Sigma$?}

Because $\Im \Sigma \propto \text{DOS}$ %TODO: why??

And then high-frequency electrons contribute to low-frequency $\Re \Sigma$ 

\end{frame}

\begin{frame}
\frametitle{Making the Hubbard model static: method 1}
    
Key point: correct the single-electron Hamiltonian using the retarded interaction

\begin{itemize}
    \item Find static non-interactive $\tilde{G}_d$ such that --
    \item With the same static $U$, $\tilde{G}_d$ leads to 
        an interactive Green function close enough 
        to the real one
\end{itemize}

\end{frame}

\begin{frame}
\frametitle{Making the Hubbard model static: method 1}

\textbf{Method 1: correct the single-electron Hamiltonian using the retarded interaction}

\begin{itemize}
    \item Def: $G_d$ = Green function for $d$ electrons; 
        $\tilde{G}_d$ = Green function for $d$ electrons corrected by $W - W_d$; 
        $W$ = RPA screened Coulomb interaction; 
        $W_d$ = static Hubbard $U$ screened by $G_d$; 
        $\tilde{W}_d$ = static Hubbard $U$ screened by $\tilde{G}_d$;
    \item Ignoring hopping between $d$ and $r$ subspaces caused by $W$
        (so the $\ii W (G - G_d)$ term is irrelevant for $d$ electrons), we have 
        \begin{equation}
            \tilde{G}_d^{-1} - \ii \tilde{G}_d \tilde{W}_d = 
            G_d^{-1} - \ii G_d W_d - \ii G_d (W - W_d).
        \end{equation}
    \item  From
    \begin{equation}
        W = (1 - UP)^{-1} U, \quad P = - \ii G G \Rightarrow
        G^{-1} - \ii GW = (1 - UP)^{-1} G^{-1} 
    \end{equation} 
    we get the final equation: 
    (here $\tilde{P}_d = - \ii \tilde{G}_d \tilde{G}_d$, 
    $P_d = - \ii G_d G_d$)
    \begin{equation}
            (1 - U \tilde{P}_d)^{-1} \tilde{G}_d^{-1}
            = (1 - U P_d^{-1})^{-1} G_d^{-1}
            - \ii G_d  (W -W_d).
        \end{equation}
\end{itemize}

\end{frame}

\begin{frame}
\frametitle{Making the Hubbard model static: method 2}

Key point: introducing a bosonic field 
to ``carry'' the frequency-dependent $W(\omega)$.\footcite{PhysRevLett.109.126408}

(Similar techniques are used in DMFT)

\end{frame}

\section{Entangled bands}

\begin{frame}
\frametitle{cRPA for entangled bands}

\textbf{Entangled band problem} 
A band consisting mostly of $s$ electrons 
and a band consisting mainly of $d$ electrons may cross each other 

\begin{center}
    \includegraphics[width=0.45\textwidth]{plots/ni-bands-1.PNG}
\end{center}

And an effective theory solely targeting $d$ electrons is not well-defined

\end{frame}

\begin{frame}
\frametitle{cRPA for entangled bands}

\textbf{Solution} Sacrifice some \textcolor{gray}{inter-orbital hopping terms} for disentangled band structure    

\begin{enumerate}
    \item Standard DFT+Wannier run.
    \item Wannier and fake Bloch functions for the $d$ subspace:
        \begin{equation}
            \textcolor{red}{\psi^d_{n \vb*{i}}} = \frac{1}{N} \sum_{\vb*{k}} 
                \ee^{- \vb*{k} \cdot \vb*{R}_{\vb*{i}}}
                \underbrace{\sum_m U_{mn}(\vb*{k}) \psi_{m \vb*{k}}}_{\textcolor{red}{\psi^{d}_{n \vb*{k}}}},
        \end{equation}
    \item Getting the $r$-subspace 
        \begin{equation}
            \textcolor{blue}{\psi^r_{n \vb*{k}}} = 
            \big(
                1 - \sum_m \dyad*{\psi^d_{m \vb*{k}}}
            \big) 
            \psi_{n \vb*{k}}.
        \end{equation}
    \item Calculating 
        \begin{equation}
            \textcolor{red}{H^{dd}} = [ \mel**{\psi^d_{m \vb*{k}}}{H(\vb*{k})}{\psi^d_{n \vb*{k}}} ], \quad 
            \textcolor{blue}{H^{rr}} = [ \mel**{\psi^r_{m \vb*{k}}}{H(\vb*{k})}{\psi^r_{n \vb*{k}}} ]
        \end{equation}
        $\textcolor{gray}{H^{dr}}$ is thrown away.
\end{enumerate}

\end{frame}

\begin{frame}
\frametitle{cRPA for entangled bands}

Left: original bands

\begin{center}
    \includegraphics[width=0.45\textwidth]{plots/ni-bands-1.PNG}
    \includegraphics[width=0.45\textwidth]{plots/ni-bands-no-entanble-1.PNG}
\end{center}

Right: $\textcolor{red}{H^{dd}}$ and $\textcolor{blue}{H^{rr}}$;
after throwing away some $s$-$d$ hopping 
(and \emph{closing} several band gaps), 
the energy of $\textcolor{red}{H^{dd}}$ is now bounded

\end{frame}

\section{Existing implementations}

\begin{frame}
\frametitle{Existing implementations}

\begin{itemize}
    \item \textbf{VASP}    
    \shortcode{ALGO=CRPA} selects constrained RPA calculations, 
    available as of VASP.6.4
    \item \textbf{ABINIT} 
    \shortcode{ucrpa} before version 9, 
    as an option in \href{https://docs.abinit.org/variables/gw/\#ucrpa}{the RPA module}
    \item \textbf{BerkeleyGW} \xmark Unfortunately \dots
    \item \textbf{RESPACK} \footcite{nakamura2021respack}: from Quantum ESPRESSO
\end{itemize}

\end{frame}

\section{Example: \ce{Fe}-based superconductor}


\begin{frame}
\frametitle{Example: \ce{Fe}-based superconductor}

The cRPA-to-Hubbard methodology has already been applied to \ce{Fe}-based SC\footcite{nakamura2008ab}\footcite{Miyake2010}

Some claim that they can obtain the correct doping concentration 
required for SC \footcite{misawa2014superconductivity}

\begin{center}
    \includegraphics[width=0.3\textwidth]{plots/fe-sc-hubbard-phase-1.png}
\end{center}

\end{frame}

\end{document}