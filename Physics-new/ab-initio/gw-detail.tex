\documentclass[t]{beamer}
\usepackage{physics}
\usepackage{amsmath}
\usepackage{tikz}
\usepackage{mathdots}
\usepackage{yhmath}
\usepackage{cancel}
\usepackage{color}
\usepackage{siunitx}
\usepackage{array}
\usepackage{multirow}
\usepackage[version=4]{mhchem}
\usepackage{amssymb}
\usepackage{textcomp, gensymb}
\usepackage{mathtools}
\usepackage{pifont}
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%
\usepackage{tabularx}
\usepackage{extarrows}
\usepackage{booktabs}
\usetikzlibrary{fadings}
\usetikzlibrary{patterns}
\usetikzlibrary{shadows.blur}
\usetikzlibrary{shapes}
\usepackage[style=verbose,backend=bibtex]{biblatex}
\addbibresource{wannier.bib}
\addbibresource{hubbard.bib}
\addbibresource{pt.bib}
\renewcommand{\footnotesize}{\scriptsize}
\usepackage{listings}
\usepackage{hyperref}

\newcommand{\pair}[1]{\langle #1 \rangle}
\DeclareMathOperator{\ee}{e}
\DeclareMathOperator{\ii}{i}
\DeclareMathOperator{\sgn}{sgn}

\newcommand{\concept}[1]{\textbf{#1}}
\newcommand*{\abinitio}{\textit{ab initio}}
\newcommand{\shortcode}[1]{\texttt{#1}}

%region Theme 

\usetheme{madrid}

% Show section in foot
\makeatletter
\setbeamertemplate{footline}
{
  \leavevmode%
  \hbox{%
  \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
    \usebeamerfont{author in head/foot}\insertauthor
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,center]{title in head/foot}%
    \usebeamerfont{title in head/foot}\insertsection
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,right]{date in head/foot}%
    \usebeamerfont{date in head/foot}\insertshortdate{}\hspace*{2em}
    \insertframenumber{} / \inserttotalframenumber\hspace*{2ex} 
  \end{beamercolorbox}}%
  \vskip0pt%
}
\makeatother

%endregion

%Information to be included in the title page:
\title{Details in $GW$-BSE}
\author{Jinyuan Wu}

\begin{document}

\maketitle

\begin{frame}
    \frametitle{Table of contents}

    \tableofcontents

\end{frame}

\section{The theory}

\begin{frame}
\frametitle{Infinitesimal}

We all know the word ``$GW$'' means that $\Sigma = \ii G W$ 
(of course we have Hartree term but it's already in DFT)

\begin{equation}
    \protect\input{feyn/gw-1.tex},
\end{equation}
where $W$ is the RPA-screened potential.

\vspace{0.25cm}
\textbf{Why some say $\Sigma(1, 2) = \ii G(1, 2) W(1^+, 2)$?}

\begin{itemize}
    \item $G(1, 2)$ is actually $G(1, 2^+)$ (so when $1=2$, $G = n_{\text{occ}}$: 
    the loop in the Hartree term above)
    \item $\Sigma(1, 2) = \ii G(1, 2^+) W(1, 2) = \ii G(1^-, 2) W(1, 2) = \ii G(1, 2) (1^+, 2)$.
    \item $1^+$ or $2^+$ $\Leftrightarrow$ $\ee^{\pm \ii \omega 0^+}$
        $\Leftrightarrow$ how to take contour 
\end{itemize}

\end{frame}

\begin{frame}
\frametitle{Other tricky details in diagrammatics}

\textbf{Time-reversal symmetry}

\begin{itemize}
    \item $W(- \vb*{p} , -\omega) = W(\vb*{p}, \omega)$ is always true 
        (or otherwise we can symmetrize the Lagrangian)
    \item The real symmetry: 
    \begin{equation}
        \begin{aligned}
            &W(\omega, -\vb*{k}) = W(\omega, \vb*{k}) \Leftrightarrow 
            W(- \omega, \vb*{k}) = W(\omega, \vb*{k})  \\
            \Leftrightarrow &W(\vb*{r}, \vb*{r}', \omega) = W(\vb*{r}', \vb*{r}, \omega) \Leftrightarrow
            W(\vb*{r}, \vb*{r}', \omega) = W(\vb*{r}, \vb*{r}', - \omega).
        \end{aligned}
    \end{equation}
\end{itemize}

\textbf{Imaginary unit} 
\begin{equation}
    \protect\input{feyn/self-energy-general-1.tex}
    \Rightarrow G = \frac{1}{\omega - E^0 - \Sigma}.
\end{equation}

\textbf{``Antiparticles''} You can treat holes as antiparticles 
(negative energy, $\ii \sgn(\xi_{n \vb*{k}})$ in time-ordered Green function)
but then corresponding electron modes have to be ignored. 

\end{frame}

\begin{frame}[allowframebreaks]
\frametitle{Feynman rules}

Recall that we are working in a crystal -- we need to talk about $\vb*{G}$ vectors

One set of rules that work: 
\begin{itemize}
    \item Propagator: \begin{equation}
        \begin{gathered}
            \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1, baseline=(XXXX.south) ]
                \path (0,57);\path (86,0);\draw    ($(current bounding box.center)+(0,0.3em)$) node [anchor=south] (XXXX) {};
                %Straight Lines [id:da8778734653821205] 
                \draw    (5,30) -- (76.5,30) ;
                \draw [shift={(44.55,30)}, rotate = 180] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (8.93,-4.29) -- (0,0) -- (8.93,4.29) -- (5.93,0) -- cycle    ;
                % Text Node
                \draw (40.75,23.5) node [anchor=south] [inner sep=0.75pt]    {$n,k$};
                \end{tikzpicture}
        \end{gathered} =
        \frac{\ii}{\omega - \xi_{n\vb*{k}} + \ii 0^+ \sgn(\omega)} \eqqcolon \ii G^0_{n \vb*{k}}(\omega).
    \end{equation}
    \item Interaction: 
    \begin{equation}
        \begin{gathered}
            \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1, baseline=(XXXX.south) ]
                \path (0,57);\path (86,0);\draw    ($(current bounding box.center)+(0,0.3em)$) node [anchor=south] (XXXX) {};
                %Straight Lines [id:da7824913889732596] 
                \draw  [dash pattern={on 0.84pt off 2.51pt}]  (5,30) -- (76.5,30) ;
                % Text Node
                \draw (40.75,23.5) node [anchor=south] [inner sep=0.75pt]    {$q,\vb*{G}$};
            \end{tikzpicture}
        \end{gathered} =
        - \ii \frac{1}{V} v(\vb*{q} + \vb*{G}).
    \end{equation}
    But the prefactor of the interaction Hamiltonian is still $1/2V$, and 
    \begin{equation}
        v(\vb*{q}) = \int \dd[3]{\vb*{r}} \ee^{- \ii \vb*{q} \cdot \vb*{r}} v(\vb*{r}).
    \end{equation}
    \item For vertex, 
    \begin{equation}
        \begin{gathered}
            \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-0.6,xscale=0.6]
                %uncomment if require: \path (0,162); %set diagram left start at 0, and has height of 162
                
                %Straight Lines [id:da200203398607687] 
                \draw    (45.5,27.33) -- (65.5,72.17) ;
                \draw [shift={(57.05,53.22)}, rotate = 245.96] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (8.93,-4.29) -- (0,0) -- (8.93,4.29) -- (5.93,0) -- cycle    ;
                %Straight Lines [id:da642061936562244] 
                \draw    (65.5,72.17) -- (45.5,117) ;
                \draw [shift={(53.95,98.05)}, rotate = 294.04] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (8.93,-4.29) -- (0,0) -- (8.93,4.29) -- (5.93,0) -- cycle    ;
                %Straight Lines [id:da4169224489697443] 
                \draw  [dash pattern={on 0.84pt off 2.51pt}]  (65.5,72.17) -- (105.5,72.17) ;
                %Straight Lines [id:da035273687574558066] 
                \draw    (76,63) -- (96.5,63) ;
                \draw [shift={(73,63)}, rotate = 0] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (8.93,-4.29) -- (0,0) -- (8.93,4.29) -- (5.93,0) -- cycle    ;
                
                % Text Node
                \draw (84.75,60) node [anchor=south] [inner sep=0.75pt]    {$q, \vb*{G}$};
                % Text Node
                \draw (43.5,27.33) node [anchor=east] [inner sep=0.75pt]    {$n', \vb*{k}$};
                % Text Node
                \draw (43.5,117) node [anchor=east] [inner sep=0.75pt]    {$n, \vb*{k}+\vb*{q}$};
                \end{tikzpicture}                
        \end{gathered} = 
        \mel{n, \vb*{k} + \vb*{q}}{\ee^{\ii (\vb*{q} + \vb*{G}) \cdot \vb*{r}}}{n' \vb*{k}}
        \eqqcolon M_{n n'} (\vb*{k}, \vb*{q}, \vb*{G}) .
    \end{equation}
    Note that the momentum arrow attached to the interaction line only controls 
    the sign before $\vb*{q}$ and $\vb*{G}$; 
    we don't sum over possible directions of the arrow. 
    Thus 
    \begin{equation}
        \begin{gathered}
            \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-0.6,xscale=0.6]
                %uncomment if require: \path (0,162); %set diagram left start at 0, and has height of 162
                
                %Straight Lines [id:da200203398607687] 
                \draw    (45.5,27.33) -- (65.5,72.17) ;
                \draw [shift={(57.05,53.22)}, rotate = 245.96] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (8.93,-4.29) -- (0,0) -- (8.93,4.29) -- (5.93,0) -- cycle    ;
                %Straight Lines [id:da642061936562244] 
                \draw    (65.5,72.17) -- (45.5,117) ;
                \draw [shift={(53.95,98.05)}, rotate = 294.04] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (8.93,-4.29) -- (0,0) -- (8.93,4.29) -- (5.93,0) -- cycle    ;
                %Straight Lines [id:da4169224489697443] 
                \draw  [dash pattern={on 0.84pt off 2.51pt}]  (65.5,72.17) -- (105.5,72.17) ;
                %Straight Lines [id:da035273687574558066] 
                \draw    (73,63) -- (93.5,63) ;
                \draw [shift={(96.5,63)}, rotate = 180] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (8.93,-4.29) -- (0,0) -- (8.93,4.29) -- (5.93,0) -- cycle    ;
                
                % Text Node
                \draw (84.75,60) node [anchor=south] [inner sep=0.75pt]    {$q, \vb*{G}$};
                % Text Node
                \draw (43.5,27.33) node [anchor=east] [inner sep=0.75pt]    {$n, \vb*{k} + \vb*{q}$};
                % Text Node
                \draw (43.5,117) node [anchor=east] [inner sep=0.75pt]    {$n', \vb*{k}$};
                \end{tikzpicture}
        \end{gathered} = \mel{n' \vb*{k}}{\ee^{- \ii (\vb*{q} + \vb*{G}) \cdot \vb*{r}}}{n, \vb*{k} + \vb*{q}}
        \eqqcolon M_{n n'}(\vb*{k}, \vb*{q}, \vb*{G})^* .
    \end{equation}

    Here is where the phase factor of each $\phi_{n \vb*{k}}$ enters the calculation: 
    
    \item Momentum conservation is enforced by 
    $\delta_{\vb*{k}_1 + \vb*{k}_2 + \vb*{k}_3 + \vb*{k}_4, 0}$:
    no $(2\pi)^3$ factor is needed. 

    \item For internal lines, 
    sum over $\vb*{k}, n, \vb*{G}$; no additional normalization factors are needed. 
    \item For external lines:
        $
        \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-0.6,xscale=0.6, baseline=(XXXX.south) ]
            \path (0,49);\path (95,0);\draw    ($(current bounding box.center)+(0,0.3em)$) node [anchor=south] (XXXX) {};
            %Straight Lines [id:da6811482684267909] 
            \draw    (18.33,24.33) -- (49.17,24.33) ;
            \draw [shift={(28.45,24.33)}, rotate = 0] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (8.93,-4.29) -- (0,0) -- (8.93,4.29) -- (5.93,0) -- cycle    ;
            %Shape: Circle [id:dp1659562467053013] 
            \draw  [fill={rgb, 255:red, 155; green, 155; blue, 155 }  ,fill opacity=1 ] (49.17,24.33) .. controls (49.17,14.94) and (56.78,7.33) .. (66.17,7.33) .. controls (75.56,7.33) and (83.17,14.94) .. (83.17,24.33) .. controls (83.17,33.72) and (75.56,41.33) .. (66.17,41.33) .. controls (56.78,41.33) and (49.17,33.72) .. (49.17,24.33) -- cycle ;
            % Text Node
            \draw (16.33,24.33) node [anchor=east] [inner sep=0.75pt]    {$\boldsymbol{r}$};
            \end{tikzpicture}$ is $\phi_{n \vb*{k}}(\vb*{r})$, and 
        $
        \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-0.6,xscale=0.6, baseline=(XXXX.south) ]
        \path (0,49);\path (95,0);\draw    ($(current bounding box.center)+(0,0.3em)$) node [anchor=south] (XXXX) {};
        %Straight Lines [id:da7875336501425136] 
        \draw    (42.17,24.33) -- (73,24.33) ;
        \draw [shift={(52.28,24.33)}, rotate = 0] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (8.93,-4.29) -- (0,0) -- (8.93,4.29) -- (5.93,0) -- cycle    ;
        %Shape: Circle [id:dp7005939415994358] 
        \draw  [fill={rgb, 255:red, 155; green, 155; blue, 155 }  ,fill opacity=1 ] (8.17,24.33) .. controls (8.17,14.94) and (15.78,7.33) .. (25.17,7.33) .. controls (34.56,7.33) and (42.17,14.94) .. (42.17,24.33) .. controls (42.17,33.72) and (34.56,41.33) .. (25.17,41.33) .. controls (15.78,41.33) and (8.17,33.72) .. (8.17,24.33) -- cycle ;
        % Text Node
        \draw (75,24.33) node [anchor=west] [inner sep=0.75pt]    {$\boldsymbol{r} '$};
        \end{tikzpicture}$ is $\phi^*_{n \vb*{k}}(\vb*{r})$, as in: 
        \begin{equation}
            G(\vb*{r}, \vb*{r}', \omega) = \sum_{n, \vb*{k}}
            \frac{\phi_{n \vb*{k}}(\vb*{r}) \phi_{n \vb*{k}}(\vb*{r})^*}{\omega - \xi_{n \vb*{k}} 
            + \ii \sgn(\xi_{n \vb*{k}})} ,
        \end{equation}
        where $\vb*{r}$ is the outgoing index and $\vb*{r}'$ is the incoming index.
        (When going from $G(\vb*{r}, \vb*{r}')$ to $G_{\vb*{k}, nn'}$, 
        outgoing external line becomes $\phi^*_{n\vb*{k}}(\vb*{r})^*$
        and incoming external line becomes $\phi_{n' \vb*{k}}(\vb*{r}')$)

        The normalization condition is 
        \begin{equation}
            \int \dd[3]{\vb*{r}} \psi^*_{n \vb*{k}} (\vb*{r}) \psi_{n' \vb*{k}'}(\vb*{r})
            = \delta_{n n'} \delta_{\vb*{k} \vb*{k}'}, \quad 
            \psi_{n \vb*{k}} \simeq \frac{1}{\sqrt{V}} \ee^{\ii (\vb*{k} + \vb*{G}) \cdot \vb*{r}}.
        \end{equation}
\end{itemize}

\end{frame}

\section{$GW$ without $G$}

\begin{frame}
\frametitle{$GW$ without $G$}

To avoid directly dealing with poles, 
we choose to 

\end{frame}

\section{Dealing with frequency dependence}

\begin{frame}
\frametitle{Overview}

Three levels of frequency dependence:
\begin{enumerate}
    \item Static COHSEX 
    \item Generalized plasmon-pole model (GPP)
    \item Full frequency
\end{enumerate}    

\end{frame}

\section{Partial sum}

\section{Building the kernel}

\begin{frame}
\frametitle{Interpolation}

\textbf{Two sources of errors} \begin{itemize}
    \item $\vb*{k}$-grid sampling 
    \item Finite number of bands
    (this can be systematically reduced: 
    for \emph{each} $\vb*{k}$, 
    $\{u_{n \vb*{k}}\}_n$ is a complete basis of 
    the space of possible $u_{n \vb*{k}}$.)
\end{itemize}

\end{frame}

\section{Calculating absorption}

\begin{frame}
\frametitle{The expression of $\epsilon_2$}

    

\end{frame}

\end{document}