\chapter{电子能带}\label{sec:electron-band-structure}

本章分析\concept{能带电子}，所谓能带电子通常是在两个假设下计算出来的：首先是\concept{静态近似}，即暂时不考虑晶格振动，只是将晶格当成提供了周期性势场的一个背景；其次是\concept{近独立近似}，由于很难一上手就处理带有复杂相互作用的电子气，因此我们首先处理\concept{近独立电子气}，也就是电子之间近似没有相互作用的电子气。
近独立假设下单电子哈密顿量为
\begin{equation}
    {H} = \frac{{\vb*{p}}^2}{2m_\text{e}} + V(\vb*{r}),
    \label{eq:single-electron-hamiltonian}
\end{equation}
整团电子气的哈密顿量是关于各个电子的哈密顿量之和。

静态近似需要使用电子-声子相互作用修正。
至于近独立近似，虽然在很多系统中相互作用的影响不能忽略，但能带理论仍然提供了一个很好的“自由理论”，可以在此之上讨论相互作用带来的影响。
例如，\eqref{eq:single-electron-hamiltonian}中的$V(\vb*{r})$可以不是物理意义明确（比如由原子核施加的库伦能）的势能，而有可能是相互作用电子气在一定情况下产生的等效势能。
实际上，对任何一个相互作用系统，都可以找到势$V(\vb*{r})$使得其能量近似可以写成\eqref{eq:single-electron-hamiltonian}的形式（见\eqref{eq:dyson-wave-eq}），因为总是可以将相互作用用电子自能体现，从而自洽求解一个单电子问题，这个单电子问题中的一些条件是由整个晶体中的所有电子确定的。
如果相互作用很强，即使往系统中放入一个电子，势$V(\vb*{r})$的形式也会发生很大改变。
电子之间的库伦相互作用的作用是不确定的，如果它不会产生全新的准粒子，那么它主要提供电子自能修正，如朗道费米液体理论，其中可以保留单电子图像，而将相互作用的影响当成体系总能量的一个修正。
总之，在很大一类情况下，经过重整化的电子仍然可以近似看成能带电子，其能谱为一条条分离的能带，并且有时可以近似认为不存在相互作用，有时可以认为仅存在较弱的密度-密度相互作用。
但也有可能会得到强关联系统，此时将系统看成近独立电子气并无意义。
例如在一维情况下能带结构是不稳定的，此时可以做\concept{玻色化}而得到一类非常不同的准粒子。

\begin{back}{电子自能和多体系统中的“单电子波函数”}{electron-self-energy}
    对电子-电子两点松原格林函数，我们有如下Dyson方程
    \begin{equation}
        G  = G^{0} + G^0 \Sigma G,
    \end{equation}
    其中$-\Sigma$是1PI自能图之和，或者说是正规自能图之和。通过求和我们认为有必要考虑的那些正规自能图，可以计算出了$\Sigma$，然后即可计算出两点格林函数
    \[
        G(\omega) = \frac{1}{\omega - \Sigma(\omega) - H_0},
    \]
    其中$H_0$表示单粒子哈密顿量，同时包括电子动能和周期势场。
    这里我们为了和单电子非相对论性量子力学的记号保持一致，使用实时理论，用$\omega$而非$\ii \omega_n$；这样的定义和$- \ii \timeorder \expval*{\psi \psi^\dagger}$是一致的。

    一个一般的费米子两点格林函数具有如下谱结构：
    \begin{equation}
        G(\vb*{r}, \vb*{r}', E) = \sum_{j} \varphi_j(\vb*{r}) \varphi_j^*(\vb*{r}') \left( \frac{\theta(\epsilon_j - \mu)}{\omega - \epsilon_j + \ii 0^+} + \frac{\theta(\mu - \epsilon_j)}{\omega - \epsilon_j - \ii 0^+} \right),
        \label{eq:two-point-fermion-green-function-spectrum}
    \end{equation}
    对自由系统，$\varphi_j(\vb*{r})$就是哈密顿量对角化之后给出的单电子波函数，而$\epsilon_j$是单电子能量，而即使对相互作用系统，把$\varphi_j(\vb*{r})$当成单电子波函数计算单体算符的期望值是不会出错的。
    在极点附近，有
    \[
        (\epsilon_j - \Sigma(E) - H_0) \ket{\varphi_j} = 0, 
    \]
    于是通过求解
    \begin{equation}
        \left( - \frac{\laplacian}{2m} + V_\text{ion}(\vb*{r}) \right) \varphi(\vb*{r}) + \int \dd[3]{\vb*{r}'} \Sigma(\vb*{r}, \vb*{r}', \epsilon) \varphi(\vb*{r}') = \epsilon \varphi(\vb*{r})
        \label{eq:dyson-wave-eq}
    \end{equation}
    能够得到各个$\varphi_j$和对应的$\epsilon_j$。
    这个改头换面的Dyson方程看起来和普通的薛定谔方程非常类似，不同之处在于$\Sigma(\vb*{r}', \vb*{r}, E)$可以是非常复杂的，并且由于它显含$E$，且和诸如系统中的电子总数等量有关，需要自洽求解\eqref{eq:dyson-wave-eq}和\eqref{eq:two-point-fermion-green-function-spectrum}。
    对单电子近似适用的系统，以上步骤给出了重整化后的单电子能谱。

    这种写出电子自能然后自洽求解的方法不仅仅适用于单电子波函数和能谱的求解。
    我们也可以在选定一个自能之后通过格林函数的时间演化方程求解格林函数，或者将格林函数约化到一些近似的动理学方程上。
\end{back}

\section{周期势场中的自由电子气模型}

\subsection{自由电子气}

现在我们讨论最为简单的近独立电子气，也就是$V(\vb*{r})$在物体内部为常数（可以看成零）的情况。

\subsubsection{能谱和本征态} 

我们在坐标表象下处理问题。计算单个电子的波函数：
\[
    - \frac{\laplacian}{2m_\text{e}} \psi(\vb*{r}) = \epsilon \psi(\vb*{r}),
\]
这种方程的解当然是平面波解的线性组合。一个这样的平面波解形如
\[
    \psi(\vb*{r}) \propto \ee^{\ii \vb*{k} \cdot \vb*{r}}.
\]
只能保证这个式子在物体内部成立，因为物体边界处$V(\vb*{r})$不可能是常数。
然后我们归一化这些平面波。电子可以自发地溢出物体，但是这样的概率并不大，所以我们可以简单地认为电子只会出现在物体内部（也即，物体被放置在一个无限深势陷当中）。设物体体积为$V$，以下我们均使用记号\eqref{eq:integrate-ouver-whole-space}，就有
\[
    \int \dd[3]{\vb*{r}} \abs{\psi(\vb*{r})}^2 = 1,
\]
于是
\[
    \psi (\vb*{r}) = \frac{1}{\sqrt{V}} \ee^{\ii \vb*{k} \cdot \vb*{r}}, \quad \epsilon = \frac{k^2}{2m_\text{e}}.
\]
很容易看出这些波函数实际上是动量算符的本征态，$\vb*{k}$实际上就是动量。另一方面，这些波函数定义在坐标空间中，坐标空间中的一切都和自旋算符对易，因此这些波函数也是自旋本征态。于是动量和自旋的一组共同正交本征函数为
\begin{equation}
    \psi_{\vb*{k},\sigma} (\vb*{r}) = \frac{1}{\sqrt{V}} \ee^{\ii \vb*{k} \cdot \vb*{r}}, \quad \epsilon_{\vb*{k},\sigma} = \frac{k^2}{2m_\text{e}}.
\end{equation}
$\vb*{k}$能够取什么值取决于边界条件。由于物体通常比较大，具体取什么样的边界条件对物体内部的过程毫无影响。

\subsubsection{零温状态} 

自由电子气的费米面是球状的（即\concept{费米球}）。对三维系统，动量空间中大小为$\dd[3]{\vb*{k}}$的区域内的状态数为
\begin{equation}
    \dd{N} = 2 \frac{V}{(2\pi)^3} \dd[3]{\vb*{k}},
\end{equation}
因子$2$是因为电子有两个自旋。积掉无用的动量分布角自由度就得到
\begin{equation}
    \dd{N} = \frac{V k^2 \dd{k}}{\pi^2}.
\end{equation}
在本问题中，使用“相空间仍然由动量和坐标确定，只不过被划分为相格”的假设也可以推导出正确的$\dd{N}$：我们有
\[
    \dd{N} = 2 \frac{\dd[3]{\vb*{r}} \dd[3]{\vb*{k}}}{(2\pi)^3},
\]
而积掉无用的坐标自由度和动量角自由度之后得到
\[
    \dd{N} = \frac{V k^2 \dd{k}}{\pi^2}.
\]

我们根据能谱计算态密度。由于
\[
    \epsilon = \frac{k^2}{2m},
\]
可以推导出
\[
    \dd{N} = \frac{V (2m)^{3/2} \sqrt{\epsilon} \dd{\epsilon}}{2 \pi^2},
\]
即单位能量间隔中的态有
\begin{equation}
    D(\epsilon) = \frac{V (2m)^{3/2} \sqrt{\epsilon} }{2 \pi^2}
\end{equation}
这么多。这样就可以计算出总粒子数和费米能（即零温化学势）之间的关系：
\begin{equation}
    N = \int_{\epsilon=0}^{\epsilon_{\text{F}}} \dd{N} = \frac{V (2m)^{3/2}}{3 \pi^2} \epsilon_\text{F}^{3/2},
\end{equation}
以及总能量
\begin{equation}
    E = \int_{\epsilon=0}^{\epsilon_{\text{F}}} \epsilon \dd{N} = \frac{V (2m)^{3/2}}{5 \pi^2} \epsilon_\text{F}^{5/2} = \frac{3}{5} N \epsilon_{\text{F}}.
\end{equation}
对二维或者一维的自由电子气也可以使用类似的方法得到系数不同的结论。

\subsubsection{热力学性质} 

我们现在计算有限温下自由电子气的一些热力学性质。
设$Q(\epsilon)$为$\epsilon$下方的所有状态数，即
\begin{equation}
    Q(\epsilon) = \int_0^\epsilon \dd{\epsilon'} D(\epsilon'),
\end{equation}
于是总电子数为
\[
    N = \int_0^\infty \dd{\epsilon} D(\epsilon) f(\epsilon) = \int_0^\infty \dd{\epsilon} Q(\epsilon) \left( - \pdv{f}{\epsilon} \right).
\]
我们有
\[
    - \pdv{f}{\epsilon} = \frac{\beta}{(\ee^{\beta (\epsilon - \mu)} + 1) (\ee^{- \beta (\epsilon - \mu)} + 1)},
\]
它在温度不高时是$\epsilon = \mu$附近的一个尖峰，并且相对于$\epsilon - \mu$是偶函数，从而可以当成一个经过某些修正的$\delta$函数。
这样，我们可以将$N$中的积分下限拓展到$-\infty$而对结果没有太大影响。这样我们有
\[
    \begin{aligned}
        N &= \int_{-\infty}^\infty \dd{\epsilon} Q(\epsilon) \left(-\pdv{f}{\epsilon}\right) \\
        &= \int_{-\infty}^\infty \dd{\epsilon} \left( Q(\mu) + Q'(\mu) (\epsilon - \mu) + \frac{1}{2} Q''(\mu) (\epsilon - \mu)^2 + \cdots \right) \left(-\pdv{f}{\epsilon}\right) .
    \end{aligned}
\]
这其中，第二项一定是零，因为它关于$\epsilon - \mu$是奇函数。
第一项就是
\[
    - \int_{-\infty}^\infty \dd{\epsilon} Q(\mu) \pdv{f}{\epsilon} = Q(\mu) (f(-\infty) - f(\infty)) = Q(\mu), 
\]
而第三项是
\[
    \begin{aligned}
        &\quad \frac{1}{2} Q''(\mu) \int_{-\infty}^\infty \dd{\epsilon} (\epsilon - \mu)^2 \frac{\beta}{(\ee^{\beta (\epsilon - \mu)} + 1) (\ee^{- \beta (\epsilon - \mu)} + 1)} \\
        &= \frac{1}{2 \beta^2} Q''(\mu) \int_{-\infty}^\infty \dd{\xi} \frac{\xi^2}{(\ee^{-\xi} + 1) (\ee^{\xi} + 1)} \\
        &= \frac{\pi^2}{6} Q''(\mu) T^2.
    \end{aligned}
\]
因此在$T^2$精度下我们有
\begin{equation}
    N = Q(\mu) + \frac{\pi^6}{6} Q''(\mu) T^2.
\end{equation}
我们现在尝试写出$\mu$的一个显式表达式。首先$Q(\mu)$和$N$其实是很接近的，可以做展开
\[
    \begin{aligned}
        Q(\mu) - N &= Q(\epsilon_\text{F}) + Q'(\epsilon_\text{F}) (\mu - \epsilon_\text{F}) - N \\
        &= D(\epsilon_\text{F}) (\mu - \epsilon_\text{F}),
    \end{aligned}
\]
因此我们有
\[
    \mu - \epsilon_\text{F} \sim \frac{Q''(\mu)}{D(\epsilon_\text{F})} T^2.
\]
这又意味着展开式
\[
    \frac{\pi^6}{6} Q''(\mu) T^2 = \frac{\pi^6}{6} \left( Q''(\epsilon_\text{F}) + Q'''(\epsilon_\text{F}) (\epsilon_\text{F} - \mu) + \cdots \right) T^2
\]
中的第一项就达到了$T^2$的精度，从而如果我们只需要计算到$T^2$精度，只需要求解
\[
    D(\epsilon_\text{F}) (\mu - \epsilon_\text{F}) + \frac{\pi^2}{6} Q''(\epsilon_\text{F}) T^2 = 0
\]
即可，最终计算得到
\begin{equation}
    \mu = \epsilon_\text{F} \left( 1 - \frac{\pi^2}{12} \left( \frac{T}{\epsilon_\text{F}} \right)^2 + \cdots \right).
\end{equation}

类似地计算热容，电子贡献的内能为
\[
    U = \int_0^\infty \dd{\epsilon} \epsilon f(\epsilon) D(\epsilon),
\]
类似地引入
\[
    R(\epsilon) = \int_0^\infty \dd{\epsilon} \epsilon D(\epsilon),
\]
做分部积分，泰勒展开，
\begin{equation}
    C_V = \frac{n \pi^2}{2} \frac{T}{T_\text{F}},
    \label{eq:free-electron-special-heat}
\end{equation}
与经典Drude模型非常不一样。直观地看，这是因为只有费米面附近的电子才会被激发。

\subsection{周期势}\label{sec:periodic-potential-electron}

在Bloch定理中我们没有看到周期势场具体是怎样让能带产生的，以及能带编号$n$到底标记了哪些自由度。
下面我们将自由电子放在周期势场中做微扰计算，来更清楚地看到能带如何形成。
本节开始给出自由电子放在周期势场中而形成能带这一事实的具体计算。

\begin{back}{定态微扰论}{perturbation}
    设$\{\ket{n}\}$是$H_0$的一组能量本征态。
    非简并微扰论中外加哈密顿量$V$导致的一阶波函数修正为：
    \[
        \ket*{n^{(1)}} = \sum_{m \neq n} \frac{\ket*{m^{(0)}} \mel*{m^{(0)}}{V}{n^{(0)}}}{E_n^{(0)} - E_m^{(0)}},
    \]
    能量修正为
    \[
        E^{(1)}_n = \mel*{n^{(0)}}{V}{n^{(0)}},
    \]
    二阶能量修正为
    \[
        E^{(2)}_n = \sum_{m \neq n} \frac{\abs*{\mel*{n}{V}{m}}^2}{E_n^{(0)} - E_m^{(0)}}.
    \]
    上述修正发散或接近发散（例如：能量修正比原本的能级差还要大）时，需要使用（近）简并微扰，它倾向于让本来能量相近的两个态分开。
\end{back}

设周期势场为$V(\vb*{r})$，它导致的一阶能量修正为
\begin{equation}
    \epsilon_{\vb*{k}}^{(1)} = \mel{\vb*{k}}{V}{\vb*{k}} = \bar{V},
    \label{eq:first-order-energy-perturbation}
\end{equation}
就是周期势的空间平均。因此如下我们将$\bar{V}$归入$\epsilon_{\vb*{k}}^{(0)}$中，或者也可以归入化学势中，而认为周期势场的空间平均是零。
二阶非简并微扰论给出
\begin{equation}
    \epsilon_{\vb*{k}}^{(2)} = \sum_{\vb*{k} \neq \vb*{k}'} \frac{\abs{\mel*{\vb*{k}'}{V}{\vb*{k}}}^2}{\epsilon_{\vb*{k}}^{(0)} - \epsilon_{\vb*{k}'}^{(0)}},
\end{equation}
由于周期性，有（我们其实是在使用\eqref{eq:sqrt-v-rep}，但是由于是在展开算符，归一化常数为$(1/\sqrt{V})^2 = 1 / V$）
\begin{equation}
    \begin{aligned}
        \mel*{\vb*{k}'}{V}{\vb*{k}} &= \frac{1}{V} \int \dd[3]{\vb*{r}} V(\vb*{r}) \ee^{\ii (\vb*{k} - \vb*{k}') \cdot \vb*{r}} \\
        &= \frac{1}{V_\text{u.c.}} \int_\text{u.c.} \dd[3]{\vb*{r}} V(\vb*{r}) \ee^{\ii (\vb*{k} - \vb*{k}') \cdot \vb*{r}} \frac{1}{N} \sum_m \ee^{\ii (\vb*{k} - \vb*{k}') \cdot \vb*{R}_i} \\
        &= \frac{1}{V_\text{u.c.}} \sum_n \delta_{\vb*{k} - \vb*{k}' + \vb*{G}_n} \int_\text{u.c.} \dd[3]{\vb*{r}} V(\vb*{r}) \ee^{- \ii \vb*{G}_n \cdot \vb*{r}} \eqqcolon \sum_n \delta_{\vb*{k} - \vb*{k}' + \vb*{G}_n} V_n,
    \end{aligned}
\end{equation}
这里我们定义了
\begin{equation}
    V_n = \frac{1}{V_\text{u.c.}} \int_\text{u.c.} \dd[3]{\vb*{r}} V(\vb*{r}) \ee^{- \ii \vb*{G}_n \cdot \vb*{r}}.
\end{equation}
于是计算得到
\begin{equation}
    \epsilon_{\vb*{k}}^{(2)} = \sum_{n} \delta_{\vb*{k} - \vb*{k}' + \vb*{G}_n} \frac{\abs{V_n}^2}{\epsilon_{\vb*{k}}^{(0)} - \epsilon_{\vb*{k}'}^{(0)}} .
\end{equation}
因此，只要非简并微扰论适用，周期势场做的就是修正一下单电子能级。
修正了的波函数为
\begin{equation}
    \psi_{\vb*{k}}^{(1)} = \sum_{\vb*{G}_n} \ee^{\ii (\vb*{k} + \vb*{G}_n) \cdot \vb*{r}} \frac{V_n}{\epsilon_{\vb*{k}}^{(0)} - \epsilon_{\vb*{k} + \vb*{G}_n}^{(0)}}.
    .
    \label{eq:non-degenerate-wave-function} 
\end{equation}

然而，在
\begin{equation}
    \abs{\vb*{k}}^2 = \abs*{\vb*{k} + \vb*{G}_n}^2
    \label{eq:brillouin-condition}
\end{equation}
时，非简并微扰论发散。此时应当使用简并微扰。由于满足这一条件的$\vb*{k}$和$\vb*{k} + \vb*{G}_n$在三维情况下很多，我们此处不做一般的计算。
\eqref{eq:brillouin-condition}的几何意义是$\vb*{k}$在起点位于原点的$-\vb*{G}_n$的垂直平分面上。
回顾布里渊区的概念，我们发现此时$\vb*{k}$一定在某两个布里渊区的交界面上。
我们现在将每个电子模式的$\vb*{k}$适当地加上或者减去一个倒格矢，将动量在第一布里渊区以外的所有模式都移动到第一布里渊区以内，即于将单电子能谱平移任意一个倒格矢，然后将第一布里渊区以外的部分全部抹除掉，则彼此之间存在能量简并，并且只相差一个倒格矢的电子模式具有非常直观的特点：它们是第一布里渊区边界上的简并。
现在加上周期势，在第一布里渊区内部，能级只是发生小的修正，在边界处，简并微扰导致交叉点“退开”，自我交叉的单一能带分离成一系列不相交的波浪线，这就得到了一系列不同的能带。
此时我们说，能带之间\concept{打开了能隙}或者说\concept{回避交叉}，让原本交叉的能带之间出现了间隙。

因此，布里渊区的概念在能带论中是一定会出现的：只有在布里渊区边界上，会出现必须使用简并微扰论、在自由电子情况下简并的能级打开能隙（从而连续的能谱断开）等现象。
在远离布里渊区边界的地方，周期势场只会修正能级能量，不会改变能带的连续性。
我们通过一个具体例子看到了为什么通常将第一布里渊区作为倒空间原胞。

以上使用的$\vb*{k}$都对应着某个平面波的真正的波矢（我们称它为\concept{广延波矢}，和约束在某个倒空间原胞中的晶格波矢相区分）。
在周期势场下第一布里渊区边界上简并解除，原本连续的自由电子能谱分离成若干条能带，从而我们可以使用能带编号$n$和通过加减特定倒格矢回到第一布里渊区中的$\vb*{k}$标记各个电子模式。
\concept{晶格动量}就是把自由电子的广延动量加减特定倒格矢挪到第一布里渊区中，因此也可以称为\concept{简约动量}。
波函数的微扰论（非简并微扰有\eqref{eq:non-degenerate-wave-function}，简并微扰发生在彼此差一个倒格矢的模式之间）显示一个Bloch波函数的简约动量和构成它的各个自由电子波函数分量的广延动量之间只差一个倒格矢，因此，在相差一个倒格矢的意义上，可以认为电子的简约动量和广延动量是一回事。
同时，无论是非简并微扰的微扰后波函数\eqref{eq:non-degenerate-wave-function}还是简并微扰的微扰后波函数都满足
\[
    \psi(\vb*{r} + \vb*{R}_i) = \ee^{\ii \vb*{k} \cdot \vb*{R}_i} \psi(\vb*{r}),
\]
因此简约波矢$\vb*{k}$实际上就是Bloch定理中的那个$\vb*{k}$，即晶格动量。

\begin{figure}
    \centering
    \subfigure[自由空间中的单电子能谱]{
        \begin{tikzpicture}
        
            % 动量横轴
            \draw[->] (-3,0) -- (3,0) node[right] {$\vb*{k}$};
            % 动能纵轴
            \draw[->] (0,-0.25) -- (0,6) node[above] {$\epsilon_{\vb*{k}}$};
            
            % 画出$\epsilon_{\vb*{k}}$曲线
            \draw[samples=50, smooth, domain=-3:3] plot(\x,{0.5*(\x*\x)});
    
        \end{tikzpicture}
    }
    \subfigure[由于晶格的周期性，出现第一布里渊区折叠，能谱在第一布里渊区外的部分移动回到第一布里渊区中，在简并微扰中彼此会有影响的态体现为第一布里渊区边界上的简并]{
        \begin{tikzpicture}
        
            % 动量横轴
            \draw[->] (-3,0) -- (3,0) node[right] {$\vb*{k}$};
            % 动能纵轴
            \draw[->] (0,-0.25) -- (0,6) node[above] {$\epsilon_{\vb*{k}}$};

            % 布里渊区边界
            \draw[dash pattern=on5pt off3pt, thick] (-1, 0) -- (-1, 6);
            \draw[dash pattern=on5pt off3pt, thick] (1, 0) -- (1, 6);
            
            % 画出布里渊区以外的能谱
            
            \draw[dash pattern=on5pt off3pt,samples=50, smooth, domain=-3:1.46] plot(\x,{0.5*((\x+2)*(\x+2))});
            \draw[dash pattern=on5pt off3pt,samples=50, smooth, domain=-3:3] plot(\x,{0.5*((\x)*(\x))});
            \draw[dash pattern=on5pt off3pt,samples=50, smooth, domain=-1.46:3] plot(\x,{0.5*((\x-2)*(\x-2))});
            \draw[dash pattern=on5pt off3pt,samples=50, smooth, domain=0.52:3] plot(\x,{0.5*((\x-4)*(\x-4))});
            \draw[dash pattern=on5pt off3pt,samples=50, smooth, domain=-3:-0.52] plot(\x,{0.5*((\x+4)*(\x+4))});

            % 画出布里渊区内部的$\epsilon_{\vb*{k}}$曲线，以及由于晶格周期性而导致的能谱平移
            \draw[samples=50, smooth, domain=-1:1] plot(\x,{0.5*(\x*\x)});
            \draw[samples=50, smooth, domain=-1:1] plot(\x,{0.5*((\x-2)*(\x-2))});
            \draw[samples=50, smooth, domain=-1:1] plot(\x,{0.5*((\x+2)*(\x+2))});
            \draw[samples=50, smooth, domain=0.52:1] plot(\x,{0.5*((\x-4)*(\x-4))});
            \draw[samples=50, smooth, domain=-1:-0.52] plot(\x,{0.5*((\x+4)*(\x+4))});
    
        \end{tikzpicture}
        
    }
    \subfigure[相互作用打开能隙，形成分离的能带]{
        \tikzset{every picture/.style={line width=0.75pt}} %set default line width to 0.75pt        

        \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
        %uncomment if require: \path (0,419); %set diagram left start at 0, and has height of 419
        
        %Straight Lines [id:da08007999422317735] 
        \draw    (241,378.33) -- (424,378.33) -- (492,378.33) ;
        \draw [shift={(494,378.33)}, rotate = 180] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (12,-3) -- (0,0) -- (12,3) -- cycle    ;
        %Straight Lines [id:da14542076195177844] 
        \draw    (370,392) -- (370,48.33) ;
        \draw [shift={(370,46.33)}, rotate = 450] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (12,-3) -- (0,0) -- (12,3) -- cycle    ;
        %Straight Lines [id:da21706633188496327] 
        \draw  [dash pattern={on 4.5pt off 4.5pt}]  (311,53.33) -- (311,378.33) ;
        %Straight Lines [id:da010943491501953284] 
        \draw  [dash pattern={on 4.5pt off 4.5pt}]  (430,53.33) -- (430,378.33) ;
        %Curve Lines [id:da7601767287685084] 
        \draw    (311,348) .. controls (334,347.67) and (354,379) .. (370,378.33) ;
        %Curve Lines [id:da7714867177526292] 
        \draw    (429,348) .. controls (406,347.67) and (386,379) .. (370,378.33) ;
        %Curve Lines [id:da295042466286602] 
        \draw    (311,329) .. controls (345,328) and (358,249) .. (370,249) ;
        %Curve Lines [id:da04705148565499395] 
        \draw    (429,329) .. controls (395,328) and (382,249) .. (370,249) ;
        %Curve Lines [id:da3411641649050148] 
        \draw    (311,152) .. controls (345,153) and (361,235) .. (370,237) ;
        %Curve Lines [id:da029058562157771473] 
        \draw    (429,152) .. controls (395,153) and (378,237) .. (370,237) ;
        %Curve Lines [id:da258083133455941] 
        \draw    (311,130) .. controls (330,131) and (336,91) .. (346,49) ;
        %Curve Lines [id:da5337325730240392] 
        \draw    (430,130) .. controls (411,131) and (405,91) .. (395,49) ;

        % Text Node
        \draw (496,378.33) node [anchor=west] [inner sep=0.75pt]    {$\boldsymbol{k}$};
        % Text Node
        \draw (369,42.33) node [anchor=south] [inner sep=0.75pt]    {$\epsilon _{\boldsymbol{k}}$};
                
        % \draw   (370, 378.33) circle [x radius= 5, y radius= 5]   ;
        \end{tikzpicture}

        
    }
    \caption{能带结构}
    \label{fig:bloch-energy-band}
\end{figure}

\subsection{赝势}\label{sec:pseudopotential}

前述的周期势场$V(\vb*{r})$的来源没有明确指出。如果我们将它取为原子核提供的库伦势场，能量最低的那些能带对应的电子状态通常都是非常局域化的原子内层电子，它们的行为和没有形成晶体时的原子的内层电子应该不会有太大区别。
这些电子和原子核就形成了所谓离子实。电子是费米子，因此外层电子不会占据这些轨道，这就产生了一个等效的排斥力。
实际上，这个等效的排斥反而能够简化计算，因为这意味着外层电子感受不到原子核的势场最为奇异的那部分，从而外层电子波函数在接近原子核的区域的高频振荡可以忽略，从而使用几个平面波就能够足够精确地描写它，微扰论总是适用，等等。
这个等效的排斥力是泡利不相容原理的一个例子——即使不考虑电子-电子库伦排斥，内层电子的存在本身就能够导致一个等效排斥力。

本节给出一种比较系统的考虑内层电子轨道对外层电子的影响，但是又不需要真的计算内层电子轨道的作用的方法。
离子实中的核心电子轨道和价电子轨道同时都是单电子哈密顿量的本征态：
\begin{equation}
    H \ket{\psi_c} = E_c \ket{\psi_c}, \quad H \ket{\psi_\text{v}} = E_\text{v} \ket{\psi_\text{v}},
\end{equation}
这里$c$标记了各个内层电子轨道。定义
\begin{equation}
    \ket{\psi_\text{v}^\text{PS}} = \ket{\psi_\text{v}} + \sum_c \ket{\psi_c} \braket*{\psi_c}{\psi_\text{v}^\text{PS}},
\end{equation}
则计算得到
\[
    (H - E_\text{v}) \ket{\psi_\text{v}^\text{PS}} = \sum_c (E_c - E_\text{v}) \ket{\psi_c} \braket*{\psi_c}{\psi_\text{v}^\text{PS}},
\]
从而
\begin{equation}
    \left(H - \sum_c (E_c - E_\text{v}) \dyad*{\psi_c}\right) \ket{\psi_\text{v}^\text{PS}} = E_\text{v} \ket{\psi_\text{v}^\text{PS}}.
    \label{eq:original-pseudopotential}
\end{equation}
这意味着可以定义一个等效的“势”
\begin{equation}
    V^\text{PS} = V - \sum_c (E_c - E_\text{v}) \dyad*{\psi_c},
\end{equation}
从这个势出发做计算能够得到正确的能谱，而价电子波函数则和实际情况不同。
在$\vb*{r}$比较大的地方，$\psi_c(\vb*{r})$很小，从而$V^\text{PS}$和$V$没有差别，在相应的位置上$\psi_\text{v}^\text{PS}(\vb*{r})$和$\psi_\text{v}(\vb*{r})$也没有区别。

到这里我们都没有做任何近似。内层电子的行为的复杂性体现在$V^\text{PS}$显含$E_\text{v}$这件事上。
然而，$E_\text{v}$完全由$\ket{\psi_\text{v}}$的标签确定，单单依靠对称性分析我们就能够知道这些标签是什么：主量子数、角量子数、磁量子数和自旋量子数。
因此，\eqref{eq:original-pseudopotential}左边完全可以写成一个不显含$E_\text{v}$的形式，因此看起来似乎不像本征值问题的\eqref{eq:original-pseudopotential}实际上真的就是一个本征值问题
\begin{equation}
    \left( \frac{\vb*{p}^2}{2m} + V^\text{PS} \right) \ket{\psi_\text{v}^\text{PS}} = E_\text{v} \ket{\psi_\text{v}^\text{PS}}.
\end{equation}
然而，和通常的定态薛定谔方程不同，以上方程中$V^\text{PS}$是依赖于$\ket{\psi_\text{v}^\text{PS}}$的诸如晶格动量（在计算能带时）或是$l$（在求解单原子问题时）的标签的。
实际上这也意味着$V^\text{PS}$在坐标表象下的矩阵元一般来说是$V(\vb*{r}, \vb*{r}')$，而不是局域的$V(\vb*{r})$。

更一般的，可以先计算得到电子能级$E^\text{AE}$和波函数$\psi^\text{AE}(\vb*{r})$，然后将单电子轨道波函数$\psi^\text{AE}(\vb*{r})$对球谐函数基底展开，做截断，即只取前几个球谐波，得到$\psi^\text{PS}(\vb*{r})$，然后拟合出一个$V^\text{PS}$使得
\begin{equation}
    - \frac{\laplacian}{2m} \psi^\text{PS}(\vb*{r}) + V^\text{PS}(\vb*{r}) \psi^\text{PS}(\vb*{r}) = E^\text{AE} \psi^\text{PS}(\vb*{r}),
\end{equation}
就得到了一个赝势。在远离原子核的地方$l$较低的球谐函数占据主导地位，因此在那里$\psi^\text{PS}$和$\psi^\text{AE}$是一样的，从而$V^\text{PS}$和$V^\text{AE}$是一样的。
在接近原子核的地方由于$\psi^\text{PS}$含有更少的球谐波，有更少的振荡，相应的，$V^\text{PS}$相较于实际的$V^\text{AE}$要平滑得多。

由于远离原子核时势场快速下降，在晶体中，非常接近一个原子核处的波函数的形式对另一个原子的势场导致的能级修正而言是不重要的。
因此可以预期，只要赝势和实际的势场不相符合的区域相比于原子间距充分小，就不会出现内层电子行为由于其它原子的存在发生很大改变的情况，用从单原子全电子计算中获得的赝势做晶体的能带计算就能够得到正确的结果；这实际上就是“只有价电子才是重要的”这一假设。

\subsection{$\vb*{k} \cdot \vb*{p}$模型和有效质量}

设$\vb*{k}_0$是某一条能带$\epsilon_{n \vb*{k}}$的极值点。我们总是可以在它附近做泰勒展开，以有效质量张量（显然它是对称的实张量）
\begin{equation}
    \left(\frac{1}{m^*}\right)_{\alpha \beta} = \pdv[2]{\epsilon_{n \vb*{k}}}{k_\alpha}{k_\beta}
    \label{eq:effective-mass}
\end{equation}
的主轴为坐标轴，有
\begin{equation}
    \epsilon_{n \vb*{k}} = \epsilon_{n \vb*{k}_0} + \frac{(k_x - k_{0x})^2}{2 m^*_x} + \frac{(k_y - k_{0y})^2}{2 m^*_y} + \frac{(k_z - k_{0z})^2}{2 m^*_z},
\end{equation}
我们将在\autoref{sec:bloch-wave-pocket}中看到有效质量的应用。将Bloch波函数的形式\eqref{eq:bloch-wavefunction}代入单电子薛定谔方程
\[
    \left( - \frac{\laplacian}{2m} + V_\text{ion}(\vb*{r}) \right) \psi_{n \vb*{k}} = \epsilon_{n \vb*{k}} \psi_{n \vb*{k}},
\]
就得到
\begin{equation}
    \left( - \frac{\laplacian}{2m} + V_\text{ion}(\vb*{r}) \right) u_{n \vb*{k}} - \frac{\ii \vb*{k} \cdot \grad}{m} u_{n \vb*{k}} = \left( \epsilon_{n \vb*{k}} - \frac{{\vb*{k}}^2}{2m}  \right) u_{n \vb*{k}},
    \label{eq:k-p-u-eq}
\end{equation}
其边界条件为
\begin{equation}
    u(\vb*{r}) = u(\vb*{r} + \vb*{R}),
    \label{eq:k-p-boundary-u}
\end{equation}
其中$\vb*{R}$是任意一个正格矢。
注意到同一个$\vb*{k}$不同的$n$的电子模式是彼此正交的，从而
\[
    \int \dd[3]{\vb*{r}} \psi^*_{n 0}(\vb*{r}) \psi_{m 0} = \delta_{mn},
\]
即
\[
    \int \dd[3]{\vb*{r}} u^*_{n 0}(\vb*{r}) u_{m 0} = \delta_{mn}.
\]
因此$\{u_{n 0}\}$构成了边界条件\eqref{eq:k-p-boundary-u}下的一组正交归一化基底。
虽然$u_{n \vb*{k}}$不是真正的电子波函数，\eqref{eq:k-p-u-eq}意味着，实际上可以通过微扰论来从$u_{n0}$出发计算$\vb*{k}$不是很大的电子模式，只要$\vb*{k} = 0$是能带的一个极值点。
例如由于$\vb*{k}=0$是能量极值点，能量无一阶微扰，我们有
\[
    \epsilon_{n \vb*{k}} - \frac{\vb*{k}^2}{2m} = \sum_{n'} \frac{\mel{n 0}{\vb*{k} \cdot \vb*{p} / m}{n' 0} \mel{n' 0}{\vb*{k} \cdot \vb*{p} / m}{n 0}}{\epsilon_{n0} - \epsilon_{n' 0}},
\]
从而
\begin{equation}
    \epsilon_{n \vb*{k}} = \frac{\vb*{k}^2}{2m} + \frac{1}{m^2} \sum_{n'} \frac{\mel{n0}{p_i}{n'0} \mel{n'0}{p_j}{n0}}{\epsilon_{n0} - \epsilon_{n' 0}} k^i k^j,
\end{equation}
将$i, j$取到有效质量张量的主轴上，就有
\begin{equation}
    \frac{1}{m^*_i} = \frac{1}{m} + \frac{2}{m^2} \sum_{n', i} \frac{1}{m^2} \sum_{n'} \frac{\mel{n0}{p_i}{n'0} \mel{n'0}{p_i}{n0}}{\epsilon_{n0} - \epsilon_{n' 0}} .
\end{equation}
$u_{n \vb*{k}}$也可以类似地计算。

更一般的，对任意的一个能带极值点$\vb*{k}_0$，我们定义
\begin{equation}
    \chi_{n \vb*{k}}(\vb*{r}) = \ee^{\ii (\vb*{k} - \vb*{k}_0) \cdot \vb*{r}} \psi_{n \vb*{k}_0} = \ee^{\ii \vb*{k} \cdot \vb*{r}} u_{n \vb*{k}_0} (\vb*{r}),
\end{equation}
我们来验证正交性和完备性均成立。首先
\[
    \begin{aligned}
        \int \dd[3]{\vb*{r}} \chi^*_{n \vb*{k}}(\vb*{r}) \chi_{m \vb*{k}'}(\vb*{r}) &= \sum_{\vb*{i}} \int_\text{u.c.} \dd[3]{\vb*{r}} \ee^{\ii (\vb*{k}' - \vb*{k}) \cdot (\vb*{r} + \vb*{R}_i)} u^*_{n \vb*{k}_0}(\vb*{r}) u_{m \vb*{k}_0}(\vb*{r}) \\
        &= N \delta_{\vb*{k} \vb*{k}'} \int_\text{u.c.} \dd[3]{\vb*{r}} \ee^{\ii (\vb*{k}' - \vb*{k}) \cdot \vb*{r}} u^*_{n \vb*{k}_0}(\vb*{r}) u_{m \vb*{k}_0}(\vb*{r}) \\
        &= N \delta_{\vb*{k} \vb*{k}'} \int_\text{u.c.} \dd[3]{\vb*{r}} u^*_{n \vb*{k}_0}(\vb*{r}) u_{m \vb*{k}_0}(\vb*{r}) \\
        &= \delta_{\vb*{k} \vb*{k}'} \delta_{mn},
    \end{aligned}
\]
即正交性成立。另一方面通过数自由度也可以发现完备性应该成立。
因此，$\chi_{n \vb*{k}}$构成晶体中电子的一组正交完备基底。
现在设
\begin{equation}
    \psi_{n \vb*{k}}(\vb*{r}) = \ee^{\ii (\vb*{k} - \vb*{k}_0) \cdot \vb*{r}} \varphi_{n \vb*{k}}(\vb*{r}),
\end{equation}
则薛定谔方程会转化为
\begin{equation}
    \left( - \frac{\laplacian}{2m} + V_\text{ion}(\vb*{r}) \right) \varphi_{n \vb*{k}} - \frac{\ii (\vb*{k} - \vb*{k}_0) \cdot \grad}{m} \varphi_{n \vb*{k}} = \left( \epsilon_{n \vb*{k}} - \frac{(\vb*{k} - \vb*{k}_0)^2}{2m} \right) \varphi_{n \vb*{k}},
\end{equation}
边界条件为
\begin{equation}
    \varphi_{n \vb*{k}}(\vb*{r} + \vb*{R}) = \ee^{\ii \vb*{k}_0 \cdot \vb*{r}} \varphi_{n \vb*{k}}(\vb*{r}).
\end{equation}
因此，可以将$\varphi_{n \vb*{k}}$用$\{\chi_{n \vb*{k}_0}\}_n$做基底展开，然后后面微扰论的步骤是类似的。

以上做的微扰都是非简并微扰，有简并微扰时对$u_{n0}$或是$\varphi_{n \vb*{k}}$做简并微扰即可。

以上方法就称为\concept{$\vb*{k} \cdot \vb*{p}$模型}，这个名字的来源是显然的。
它可以在已经求出了某一晶格动量点的全套Bloch波函数之后用于计算相邻点的Bloch波函数，也可以用于获得有效质量张量，这有助于在不计算特别多的动量点的情况下就对体系的能带结构获得一个比较精确的估计。
能带越宽，有效质量越轻，能带越窄，有效质量越重。\concept{重费米子系统}指的是有效质量非常大的系统。这样的系统常常是强关联系统。

\section{Bloch波函数和Wannier波函数}

本节给出周期性势场中的近独立电子气的一些一般性质。我们将从对称性出发得到Bloch电子，并且展示一种“部分定域”的表象：Wannier波函数。

\subsection{Bloch电子}\label{sec:bloch-electron}

\subsubsection{Bloch定理和Bloch波函数}

\autoref{sec:transition-group-rep}中的Bloch定理当然适用于近独立电子气模型，因此这种模型中的电子的波函数自然服从\eqref{eq:bloch-wavefunction}。我们在处于这种状态的电子称为\concept{Bloch电子}。
能带电子总是可以认为是自由电子加入了足够多的微扰之后得到的，而我们在\autoref{sec:periodic-potential-electron}最后提到过，\eqref{eq:bloch-wavefunction}中的那个晶格动量$\vb*{k}$和组成Bloch电子的诸多平面波分量的波矢（即自由电子的真正的动量，或者说延展动量）最多差一个倒格矢。
因此，晶格动量为$\vb*{k}$的Bloch电子可以认为是携带了真实的动量，这动量是$\vb*{k}$，$\vb*{k}+\vb*{G}_i$，$\vb*{k} + \vb*{G}_j$等一系列延展动量的混合，而自由电子做了足够多的微扰之后得到的波函数其实就是这种系统的Bloch波函数。

我们现在来看$n$代表什么。Bloch电子显然满足一个周期性边界条件，因此它是某个等效单电子哈密顿量的周期性解。
将\eqref{eq:bloch-wavefunction}代入
\[
    -\frac{\laplacian}{2m_\text{e}} \psi(\vb*{r}) + V(\vb*{r}) \psi(\vb*{r}) = \epsilon \psi(\vb*{r}),
\]
得到
\begin{equation}
    \left( - \frac{(\grad+ \ii \vb*{k})^2}{2m_\text{e}} + V(\vb*{r}) \right) u_{\vb*{k}}(\vb*{r}) = \epsilon u_{\vb*{k}}(\vb*{r}).
    \label{eq:block-energy-problem}
\end{equation}
在$\vb*{k}$已知的情况下求解该本征值问题，可以得到一组$u$以及对应的$E$。由于先前要求$u(\vb*{r})$是周期函数，该本征值问题必定给出离散谱，也即，我们会获得一组$(\psi_{n \vb*{k}}, \epsilon_{n \vb*{k}})$，使得
\begin{equation}
    \left( - \frac{(\grad+\ii \vb*{k})^2}{2m_\text{e}} + V(\vb*{r}) \right) u_{n \vb*{k}}(\vb*{r}) = \epsilon_{n \vb*{k}} u_{n \vb*{k}}(\vb*{r}),
    \label{eq:eigen-function-bloch-u}
\end{equation}
$n$是另一个（离散的）好量子数，我们现在看到它是单个晶胞中的离散谱的能级标记。

通过数自由度我们还可以看出$n$的另一个意义：$\vb*{k}$对应着晶格，从而$n$对应着一个晶胞中不同的原子以及每个原子周围的电子轨道。
当然，原则上原子周围有无数个电子轨道，从而$n$可以任意的大，但是实际上我们通常会在某一个能量尺度上截断，物理上，这是因为特别高的空轨道对低能过程没有什么影响。
一旦$\vb*{k}$和$n$给定，Bloch波函数及其时间演化就完全求解出来了，从而$\vb*{k}$和$n$是坐标空间中的Bloch波函数的全部好量子数。我们称取不同$n$值的电子处于不同的\concept{能带}上，$n$为能带标记。%
\footnote{注意到，能带的导出实际上并未用到太多晶体的性质（空间周期性等），因此非晶体很多时候也有能带。}%
能带中的电子在空间上非常不定域，它们实际上是一系列格点上的定域态叠加而成的结果。也可以这么理解这一点：写出一个格点上的哈密顿量之后为了计算能带能量肯定要做对角化，对角化得到的本征向量肯定是把一系列格点上的定域态都线性组合起来了。
总之，能带中的Bloch电子常常称为\concept{巡游电子}。

由于晶体近似在一个无限深势阱中，波函数在晶体边界处快速衰减为零。这就意味着$\vb*{k}$实际上是离散的。然而，由于晶体的尺度通常远大于原子的尺度，$\vb*{k}$近似可认为是连续的。于是可以写出函数
\[
    \epsilon = \epsilon_n(\vb*{k}),
\]
由于$\vb*{k}$加上任何一个倒格矢之后给出同样的Bloch波函数，$E$相对于$\vb*{k}$应该具有周期性，那么它必定是有界的。
这就是“能带”这个名称的来源：穷举一个倒空间原胞内部的所有$\vb*{k}$，得到的所有能量组成一条有限宽的条带。

两条不同的能带之间的间隙提供了一个自然的能量截断，因此在我们已经知道了系统的能带之后，如果需要一个低能有效理论，可以只考虑能量较低的能带，而将粒子跃迁到能量较高的能带再跃迁回来作为微扰，进行能量修正，即可以很自然地将高能能带积掉。

最后我们指定波函数的归一化方式。我们这里做的内积操作是\autoref{sec:momentum-space-inner-product}中的第一种情况，即对全空间积分。
可以使用约定\eqref{eq:integrate-ouver-whole-space}。
此时由
\begin{equation}
    \int \dd[3]{\vb*{r}} \psi_{n \vb*{k}}^*(\vb*{r}) \psi_{m \vb*{k}'}(\vb*{r}) = \delta_{mn} \delta_{\vb*{k} \vb*{k}'}
\end{equation}
可以得出
\[
    \begin{aligned}
        \delta_{mn} \delta_{\vb*{k} \vb*{k}'} &= \sum_{\vb*{i}} \int_\text{u.c.} \dd[3]{\vb*{r}} \ee^{- \ii (\vb*{R}_i + \vb*{r}) \cdot \vb*{k}} u_{n \vb*{k}}^*(\vb*{r}) \ee^{\ii (\vb*{R}_i + \vb*{r}) \cdot \vb*{k}'} u_{m \vb*{k}'}(\vb*{r}) \\
        &= N \delta_{\vb*{k} \vb*{k}'} \int_\text{u.c.} \dd[3]{\vb*{r}} \ee^{- \ii (\vb*{k} - \vb*{k}') \cdot \vb*{r}} u_{n \vb*{k}}^*(\vb*{r}) u_{m \vb*{k}'}(\vb*{r}) \\
        &= N \delta_{\vb*{k} \vb*{k}'} \int_\text{u.c.} \dd[3]{\vb*{r}} u_{n \vb*{k}}^*(\vb*{r}) u_{m \vb*{k}'}(\vb*{r}),
    \end{aligned}
\]
于是
\[
    \int_\text{u.c.} \dd[3]{\vb*{r}} u^*_{n \vb*{k}}(\vb*{r}) u_{m \vb*{k}}(\vb*{r}) = \frac{1}{N},
\]
或者考虑$u_{n \vb*{k}}$的周期性，有
\begin{equation}
    \int \dd[3]{\vb*{r}} u^*_{n \vb*{k}}(\vb*{r}) u_{m \vb*{k}}(\vb*{r}) = \delta_{mn}. 
\end{equation}

如果使用\eqref{eq:integrate-ouver-whole-space-divided}，则
\begin{equation}
    \frac{1}{V} \int \dd[3]{\vb*{r}} \psi_{n\vb*{k}}^*(\vb*{r}) \psi_{m\vb*{k}'}(\vb*{r}) = \delta_{mn} \delta_{\vb*{k} - \vb*{k}'},
    \label{eq:bloch-is-basis}
\end{equation}
从而让简单的平面波$\exp(\ii \vb*{k} \cdot \vb*{r})$不需要乘上归一化因子就能够成为归一化本征态。
设$V_\text{u.c.}$是单个晶胞的大小，则
\[
    V = N V_\text{u.c.},
\]
从而可以得到
\begin{equation}
    \frac{1}{V_\text{u.c.}} \int_\text{u.c.} \dd[3]{\vb*{r}} u_{m\vb*{k}}^*(\vb*{r}) u_{n\vb*{k}}(\vb*{r}) = \delta_{mn}.
\end{equation}
只需要求解出一组满足以上条件的$\{u_{n\vb*{k}}\}$，就得到了一组正交归一化波函数$\{\psi_{n\vb*{k}}\}$。
归一化系数使用$V_\text{u.c.}$是非常合理的，因为如\eqref{eq:normalization-periodic}所示这正是具有正格子的周期性的函数通常使用的归一化系数，这里$u_{n \vb*{k}}$的地位和$\ee^{\ii \vb*{k} \cdot \vb*{r}}$相同。

\eqref{eq:bloch-is-basis}意味着Bloch波函数是正交归一化波函数且对应的积分测度为
\[
    \frac{1}{\sqrt{V}} \int \dd[3]{\vb*{r}},
\]
记${c}_{n\vb*{k}}^\dagger$为位于能带$n$、晶格动量为$\vb*{k}$的Bloch电子的产生算符，那么%
\footnote{其中的$1/\sqrt{V}$的因子是因为二次量子化场算符通常使用全空间的积分为内积的定义，在此定义下，归一化的波函数是$\psi_{n\vb*{k}} / \sqrt{V}$而不是$\psi_{n\vb*{k}}$。
换句话说，在归一化\emph{波函数}$\psi_{n \vb*{k}}$时我们使用了约定\eqref{eq:v-rep}，而归一化\emph{场算符}时我们使用了约定\eqref{eq:sqrt-v-rep}。
}%
\begin{equation}
    {c}_{n \vb*{k}}^\dagger = \frac{1}{\sqrt{V}} \int \dd[3]{\vb*{r}} \psi_{n \vb*{k}}(\vb*{r}) {\psi}^\dagger(\vb*{r}), \quad \psi^\dagger(\vb*{r}) = \frac{1}{\sqrt{V}} \sum_{\vb*{k}} \psi_{n \vb*{k}}(\vb*{r})^* c_{n \vb*{k}}.
    \label{eq:bloch-transformation}
\end{equation}
这和\eqref{eq:sqrt-v-rep}非常类似，不同之处在于此时的积分变换核中多了一个周期性的$u_{n \vb*{k}}$，并且除了$\vb*{k}$以外还有离散的标签$n$。
哈密顿量在这一组基下是对角化的，于是写出二次量子化哈密顿量（已经加入化学势项）
\begin{equation}
    {H} = \sum_{n, \vb*{k}} (\epsilon_{n\vb*{k}} - \mu) {c}^\dagger_{n\vb*{k}} {c}_{n\vb*{k}}.
    \label{eq:bloch-band-hamiltonian}
\end{equation}
$\vb*{k}$的取值局限在第一布里渊区内部，作为对比，不考虑周期势的边长为$L$的正方体势阱中的电子的$\vb*{k}$可以取遍所有位于那个边长为$2\pi / L$的格点。
但实际上两者的自由度是一样的，因为我们还有$n$标记各个能带，也即，我们相当于把所有能带中的动量都移动到了第一布里渊区内部。

以上讨论并没有说明我们应该将$\vb*{k}$约束在\emph{哪一个}倒格子原胞中。
随着晶胞数$N$增大，$\vb*{k}$在原胞中的取值会变得非常密集，从而$\vb*{k}$可以认为是连续变化的。
但是，这并不能保证$\epsilon_{n \vb*{k}}$也是连续变化的。我们希望$n$固定后$\epsilon_{n \vb*{k}}$随着$\vb*{k}$连续变化，从而可以将能量的不连续变化完全归入$n$跳变中，让能带真的成为连续的“带”，其数目就是$n$可能的取值的数目。
前面的对称性分析告诉我们应该将$\vb*{k}$约束在第一布里渊区内，而在做近自由电子在周期势场下的微扰时我们非常直接地看到了原因。

\subsubsection{基态} 

\begin{back}{近独立费米气体}{free-fermi-gas}
    使用巨正则系综（当然，我们认为系统能够达到统计平衡，就意味着电子之间不可能真的完全没有相互作用，否则能量无法传递）
    ，对很大的近独立费米子系统，处在能量本征态$\ket{n}$上的粒子数的平均值为（以下使用$\epsilon$表示单个电子的能量而使用$E$表示系统总能量）
    \begin{equation}
        \expval*{{n}_n} = f(\epsilon_n) = \frac{1}{\ee^{\beta (\epsilon_n-\mu)} + 1}.
        \label{eq:fermi-dirac-distribution}
    \end{equation}
    我们让能量尽可能低，那就是要让$T\to 0$，也就是让$\beta\to \infty$，此时就有
    \begin{equation}
        \expval*{{n}_n} = \begin{cases}
            1, \quad \epsilon_i \leq \mu, \\
            0, \quad \epsilon_i > \mu.
        \end{cases}
    \end{equation}
    这意味着，$T=0$时电子占据的所有状态就是
    \begin{equation}
        \epsilon_i = \mu
    \end{equation}
    以内的所有能量本征态。

    化学势是多少需要根据
    \begin{equation}
        \mu_i = \pdv{U}{n_i}
    \end{equation}
    计算。当然，化学势和粒子数、温度等因素都有关系。在$T=0$且电子数$N$给定时，常用的做法是显式地写出所有能量本征态，从小到大排列$N$个电子，从而计算出费米能量，然后我们就知道了$T=0$时的化学势。
    能量正好为化学势的所有能量本征态共同组成的能级称为\concept{费米能级}，其能量称为\concept{费米能量}。
    能量在费米能级以上的态无占据，能量在费米能级以下的态有占据。

    不同粒子数对应的费米能量是不同的；并且，在分析有限温问题时，化学势不再是费米能量。
    温度不很高、粒子数很大时，不同粒子数对应的费米能量相差不大，并且化学势和费米能量（也就是$T=0$时的化学势）相差不大，因此有时会使用费米能量近似作为化学势。
\end{back}

由于能量本征态可以使用晶格动量标记，Bloch电子组成的近独立电子气的基态中所有电子有确定的动量空间，即动量空间中有确定的粒子占据。
由于能量和晶格动量之间的关系是连续的，动量空间中被电子占据的态形成连续的几何体，即存在\concept{费米海}或者说\concept{费米球}，其表面称为\concept{费米面}，其上的态即为费米能级态，与这些态对应的动量称为\concept{费米动量}。
基态的表达式就是一个乘积态，为
\begin{equation}
    \ket{\Psi} = \prod_{\abs{\vb*{k}} < k_\text{F}} {c}^\dagger_{\vb*{k}} \ket{0}.
    \label{eq:ground-state}
\end{equation}

关于本节的论述要着重指出一点：虽然我们采用了统计物理的论证来表明必然存在着一个费米面，从而有对应的费米能量，但统计物理的论证仅仅为我们提供了系统基态的性质，而无论系统是不是需要使用平衡态系综描述，它一定有一个基态。因此，费米面、费米能级等概念在任何情况下——无论是平衡态还是非平衡态、纯态还是混合态——全部是适用的。这些概念并不依赖统计物理的框架。

大部分材料的费米能都远高于室温，因此在正常的温度下，费米分布函数$f$可以就认为是阶跃函数。
然而，对诸如电子比热之类的强烈依赖费米面性质的物理量（因为只有费米面附近的电子会被激发），费米分布函数一点对阶跃函数的偏离就会产生很大的影响。

化学势的大小由系统中的电子数决定，或者也可以反过来说，化学势的高度决定了系统基态中哪些位置被电子填充。这个对应关系形象地展示如\autoref{fig:chemical-potential}，化学势越高，被描黑的态——也就是基态有电子填充的态——就越多。
再次强调，这个“电子能量形式固定，改变化学势往系统中填充电子”的物理图像不适用于强关联系统，因为在那里等效的电子能量形式\eqref{eq:single-electron-hamiltonian}随着电子填入会发生剧烈变化；相应的，从这个物理图像衍生出来的理论，如能带理论也不再适用。

没有什么保证费米面一定是第一布里渊区中的一个封闭曲面。它可以和第一布里渊区边界相交，从而和另一侧的边界上的自己相连。
甚至可以有不连通的费米面，这出现在三维空间中，由于适当的能带形状，费米面附近的能带均没有完全被填充，此时可以出现多个彼此不连通的费米面。
那些同时为多个费米面包裹的动量空间区域中有动量相同，能带编号不同的多个被占据的电子模式。
所谓“费米面包裹的动量空间区域”的说法本身也需要评注，因为完全可以是费米面\emph{以外}的那些动量模式被填充；这仍然可以视为“包裹”，因为第一布里渊区两侧实际上是连通的。

\begin{figure}
    \centering
    \subfigure[$\xi_{\vb*{k}}$和$\vb*{k}$的关系]{
        \begin{tikzpicture}
        
            % 动量横轴
            \draw[->] (-3,0) -- (3,0) node[right] {$\vb*{k}$};
            % 动能纵轴
            \draw[->] (0,-1.5) -- (0,2.5) node[above] {$\xi_{\vb*{k}}$};
            
            % 画出$\xi_{\vb*{k}}$曲线
            \draw[samples=50, smooth, domain=-3:3] plot(\x,{0.25*(\x*\x)-1});
            % 描黑被占据的部分
            \draw[samples=50, smooth, thick, domain=-2:2] plot(\x,{0.25*(\x*\x)-1});
    
            % 标出带底
            \draw[dash pattern=on5pt off3pt] (-2.5, -1) -- (2.5,-1) node[right] {$-\mu$};
    
            % 标出费米点
            \node[dot, label=above:$\vb*{k}_\text{F}$] at (2, 0) {};
            \node[dot, label=above:$-\vb*{k}_\text{F}$] at (-2, 0) {};
    
        \end{tikzpicture}
    }
    \subfigure[$\epsilon_{\vb*{k}}$和$\vb*{k}$的关系]{
        \begin{tikzpicture}
        
            % 动量横轴
            \draw[->] (-3,0) -- (3,0) node[right] {$\vb*{k}$};
            % 动能纵轴
            \draw[->] (0,-1.5) -- (0,2.5) node[above] {$\epsilon_{\vb*{k}}$};
            
            % 画出$\epsilon_{\vb*{k}}$曲线
            \draw[samples=50, smooth, domain=-3:3] plot(\x,{0.25*(\x*\x)});
            % 描黑被占据的部分
            \draw[samples=50, smooth, thick, domain=-2:2] plot(\x,{0.25*(\x*\x)});
    
            % 标出费米面
            \draw[dash pattern=on5pt off3pt] (-2.5, 1) -- (2.5,1) node[right] {$\mu$};

            % 标出满带
            \draw[dash pattern=on5pt off3pt] (2, 0) -- (2,1);
            \draw[dash pattern=on5pt off3pt] (-2, 0) -- (-2,1);
    
            % 标出费米点
            \node[dot, label=below:$\vb*{k}_\text{F}$] at (2, 0) {};
            \node[dot, label=below:$-\vb*{k}_\text{F}$] at (-2, 0) {};
    
        \end{tikzpicture}
    }
    \caption{化学势和电子填充，描黑的态有电子填充}
    \label{fig:chemical-potential}
\end{figure}

\subsubsection{空穴} 

虽然多电子态是将场算符作用在真空态上得到的，但由于本文讨论的电子都由薛定谔场描述，在任何一个物理过程中电子数都是守恒的。
换而言之，设有一个$N$电子的系统，这个系统实际可能具有的波函数只是态空间的一小部分，即保持电子数为$N$的部分。
这个$N$电子空间$\mathcal{H}_N$当然可以使用一次量子化理论来描述，但能否使用二次量子化的语言描述？
费米子的特性让这一点成为可能。请注意由于泡利不相容原理，
\[
    {c}^\dagger_{\vb*{k}} \ket{\Psi} = 0, \quad \epsilon_{\vb*{k}} < \epsilon_\text{F},
\]
而由产生湮灭算符的性质显然有
\[
    {c}_{\vb*{k}} \ket{\Psi} = 0, \quad k > k_\text{F},
\]
因此如果定义%
\footnote{费米面上的态相对来说非常少，因此忽略。$b$的记号只是临时性的，因为它和声子的记号冲突。}%
\begin{equation}
    {b}^\dagger_{\vb*{k}} = \begin{cases}
        {c}_{-\vb*{k}}, \quad k < k_\text{F}, \\
        {c}_{\vb*{k}}^\dagger, \quad k > k_\text{F},
    \end{cases}
\end{equation}
那么基态$\ket{\Psi}$实际上是${b}^\dagger$产生的准粒子的真空态。${b}^\dagger$产生的是什么？当$k>k_\text{F}$时它产生的就是费米面以上的电子，而$k<k_\text{F}$时它产生的是费米海之内的空穴。
空穴的动量就是它占据的态如果有电子的话，这个电子的动量的相反数。% TODO：能量和化学势
这样，我们可以将空穴看成电子的反粒子，虽然这种“反粒子”并不像高能物理中那样，来自洛伦兹群的表示。
使用${b}^\dagger$写出的哈密顿量在省略一个无关紧要的常数之后为
\begin{equation}
    {H} = \sum_{k > k_\text{F}} \xi_{\vb*{k}} {b}^\dagger_{\vb*{k}} {b}_{\vb*{k}} - \sum_{k < k_\text{F}} \xi_{\vb*{k}} {b}^\dagger_{\vb*{k}} {b}_{\vb*{k}},
    \label{eq:particle-and-hole-hamiltonian}
\end{equation}
因此一个空穴的能量为$-\xi_{\vb*{k}}$。以上的哈密顿量不是正定的，但这不会导致负能量疑难，因为费米海虽然很大，但大小有限，因此不会出现能量无限下降的问题。

使用${b}^\dagger$的结果是，保持电子数不变的相互作用需要被看成粒子数可变的，例如一个费米海中的电子被激发到费米海之上就意味着产生了一个电子-空穴对。

值得注意的是，使用$c^\dagger$和$b^\dagger$时的“单粒子能谱”是不同的：$c^\dagger$表象下低于费米面的那部分模式的能谱在$b^\dagger$表象下被加了一个负号，翻到了费米面上方。
在$c^\dagger$表象下，低于费米面的那部分模式是被占据的能带，基态里面已经有一些粒子占据了，将低于费米面的某个模式中的电子移除会让能量上升；而在$b^\dagger$表象下，没有什么已经占据了的低于费米面的模式，基态是“空”的，但是在费米面上方有两种能带，一种是电子能带，一种是空穴能带，在这两种能带中填充粒子都会让能量上升。
这两种描述是等价的，因为“在空穴能带中填充一个空穴”和“在已被占据的能带中填充一个空穴”显然是一回事。

这里的构造不仅适用于能带电子，实际上适用于固体中任何看起来比较像电子的准粒子，对这些准粒子我们都可以定义“空穴”和“空穴能带”。

表面上看这里有一个矛盾之处：我们从费米海中移除一个电子，按理说系统能量应该降低，因为系统能量是所有电子的能量之和；然而按照\eqref{eq:particle-and-hole-hamiltonian}，从费米海中移除一个电子，即在费米面以下的电子能带中产生了一个空穴，即在费米面\emph{以上}的\emph{空穴能带}中填充了一个空穴，系统能量应该升高。
这个佯谬是由于两种说法中的能量是不同的：前一种说法中的能量是指$\epsilon_{\vb*{k}}$，而后一种说法中的能量是指$\xi_{\vb*{k}}$。
从费米海中移除一个电子确实让晶体内部的电子的能量降低了，但是由于系统和环境的接触和化学势的存在，环境中的电子会获得向系统中跃迁的势能，因此晶体内部电子的能量加上与晶体接触的那部分电子的能量反而升高了。
我们讨论\emph{系统能量}时通常是把两部分能量放在一起讨论的，因为这样系统才能够看成是一个孤立的系统。

我们会看到，如果以$\xi_{\vb*{k}}$为能量衡量基准，那么空穴实际上是电子的反粒子（见\autoref{back:anti-particles}）。
历史上，正电子的存在曾经就用这样的方式解释过：在高能物理中，假定真空态中实际上已经有一个电子组成的费米海，那么从中拿一个电子扔掉，就得到一个电荷为正、动量相反的“粒子”，这当然就是正电子，即电子的反粒子。
后来的高能物理学家弄清楚了场的量子化必然导致粒子和反粒子，因此无需构造一个不自然的充满电子的费米海，就能够接受正电子的存在。
凝聚态物理中的情况正好相反：费米海是真的存在的，我们考虑它附近的态，发现基本自由度是电子激发和空穴激发，如果以费米海为基态，以它为能量零点，那么空穴就是电子的反粒子（而反之，以“真正的”真空态为基态，那么正电子才是电子的反粒子）。

\subsection{Wannier波函数}

\subsubsection{定义}

前面看到，我们使用了两个标签来标记一个电子模式：一个是“晶格动量”$\vb*{k}$，一个是能带编号。
前者的可能取值的数量有多少？晶格动量加上一个倒格矢之后与之前等价，因此晶格动量的取值数目为
\[
    \frac{2\pi / V}{2\pi / V_\text{u.c.}} = N,
\]
$N$为晶胞数目。当然这就是第一布里渊区中的动量数目。
一个晶格内可以有多种原子，但是这个信息已经被能带编号考虑在内了，因为电子“看到”原子种类的方式就是原子施加的势场，而周期势导致能带出现。

任何一种非Bloch波函数的电子波函数基底也应该有同样的数目，例如，它们可以用一个“坐标”和一个类似于能带编号的离散标签标记。
在正交归一化条件成立时这种电子状态称为\concept{Wannier波函数}。
我们使用$\vb*{i}, \vb*{j}, \ldots$表示电子位置，$m, n, \ldots$用于区分定域在$\vb*{i}$号晶胞附近的电子的电子云的“形状”。
这是一个比较模糊的说法，例如定域在某个格点附近的电子可以非常定域，也可以比较定域，有两种模式。
在没有自旋-轨道耦合时，自旋取向也可以计入$m, n, \ldots$中，此时自旋起到的唯一作用就是让系统中的电子模式的数目是轨道模式的数目的两倍。
而有自旋-轨道耦合时自旋取向肯定会计入$m, n, \ldots$中），且此时波函数的形式不再是$\psi(\vb*{r})$而是$\psi(\vb*{r} \sigma)$了。
下面为了书写方便我们还是将波函数记作$\psi(\vb*{r})$，或者说把波函数表示成由$\psi(\vb*{r}, \uparrow)$和$\psi(\vb*{r}, \downarrow)$排成的列向量。
$\vb*{R}_{\vb*{i}}$表示$\vb*{i}$处的格点的位矢，则定域在$\vb*{i}$号晶胞附近的Wannier电子的波函数可以用$w_{n\vb*{i}}(\vb*{r})$表示，可以写成如下形式：
\begin{equation}
    w_{n \vb*{i}}(\vb*{r}) = w_{n}(\vb*{r} - \vb*{R}_{\vb*{i}}), \quad \int \dd[3]{\vb*{r}} w_n(\vb*{r})^* w_m(\vb*{r}) \propto \delta_{mn}.
    \label{eq:wannier-general-form}
\end{equation}
此外，由于Wannier波函数的定域性，有
\begin{equation}
    \int \dd[3]{\vb*{r}} w_m(\vb*{r} - \vb*{R}_{\vb*{i}})^* w_m(\vb*{r} - \vb*{R}_{\vb*{j}}) \propto \delta_{\vb*{i} \vb*{j}},
    \label{eq:wannier-localization}
\end{equation}
因为Wannier波函数足够局域，因此不同的格点附近的Wannier波函数可认为没有交叠。
\eqref{eq:wannier-general-form}和\eqref{eq:wannier-localization}实际上构成了Wannier波函数这一概念的\emph{定义}，符合它们的$\{w_{n \vb*{i}}(\vb*{r})\}$即可称为Wannier波函数。
通常我们会要求
\begin{equation}
    \frac{1}{V_\text{u.c.}} \int \dd[3]{\vb*{r}} \abs{w_{n \vb*{i}}(\vb*{r})}^2 = 1,
    \label{eq:wannier-function-normalization-uc}
\end{equation}
这样归一化常数是一个局域的晶胞体积，符合我们的要求。这样的约定满足\eqref{eq:sum-over-lattice}，其中Wannier波函数的地位和约束在晶胞中的$\ee^{\ii \vb*{k} \cdot \vb*{r}}$一样。
在归一化Bloch波函数时我们使用了积分测度
\[
    \frac{1}{V} \int \dd[3]{\vb*{r}},
\]
从而导致归一化条件中出现了关于整块晶体的参数$V$。对Bloch波函数这是合理的，因为它的好量子数是动量，因此是非常不定域的波函数，但Wannier波函数使用格点坐标标记，因此是非常定域的波包，因此我们希望Wannier波函数的归一化因子应该是一个常数而不包含任何关于系统大小的信息。
Wannier波函数既然是一组正交归一化基底，就可以定义对应的二次量子化算符，即
\begin{equation}
    {c}^\dagger_{n \vb*{i}} = \frac{1}{\sqrt{V_\text{u.c.}}} \int \dd[3]{\vb*{r}} w_{n \vb*{i}}^*(\vb*{r}) {\psi}^\dagger(\vb*{r}).
    \label{eq:wannier-and-free}
\end{equation}

实际上“位置”和“形状”这两个词都不是非常良定义的，比如说$\vb*{i}, \vb*{j}$等可以仅仅标记\emph{晶胞位置}，也可以标记\emph{原子位置}，后者相比前者，需要区分一个晶胞中的不同类型的原子。
“形状”一词的含义也不是非常确定，它可以和能带编号一致也可以就是单原子周围轨道的编号，或者介于两者之间；此外如果$i$仅仅标记了晶胞位置，那么电子在一个晶胞中的哪一个原子附近这件事也需要被当成“形状”信息。

在$\vb*{i}$仅仅区分不同晶胞时，$\vb*{i}$的取值个数也是$N$，因此我们可以猜测，$\vb*{i}$与Bloch电子的晶格动量标记了同样的自由度，而$n$与能带编号标记了同样的自由度。
我们后面在分析Wannier表象下的哈密顿量的对角化时会看到这是正确的。

\subsubsection{Wannier表象下的哈密顿量}

之前我们用\eqref{eq:bloch-band-hamiltonian}给出了Bloch基下的能带理论哈密顿量。现在来看同样的理论在Wannier基下会呈现什么形式。
设能带理论下单电子哈密顿量为$\hat{h}$，则可以做表象变换
\[
    {H} = \sum_{m\vb*{i}, n\vb*{j}} {c}^\dagger_{m\vb*{i}} \mel{m\vb*{i}}{\hat{h}}{n\vb*{j}} {c}_{n\vb*{j}},
\]
其中我们令
\begin{equation}
    - t_{m\vb*{i}, n\vb*{j}} = \mel{m\vb*{i}}{\hat{h}}{n\vb*{j}} = \frac{1}{V_\text{u.c.}} \int \dd[3]{\vb*{r}} w_m^*(\vb*{r} - \vb*{R}_{\vb*{i}} + \vb*{R}_{\vb*{j}}) \hat{h} w_n(\vb*{r}),
    \label{eq:wannier-hopping-term}
\end{equation}
则
\[
    {H} = - \sum_{m\vb*{i}, n\vb*{j}} t_{m\vb*{i}, n\vb*{j}} {c}^\dagger_{m\vb*{i}} {c}_{n\vb*{j}}.
\]
记号$\{m\vb*{i}, n\vb*{j}\}$表示对一组顺序不限的$\{m\vb*{i}, n\vb*{j}\}$组合只求和一次，就得到
\begin{equation}
    {H} = - \sum_{\{m\vb*{i}, n\vb*{j}\}} (t_{m\vb*{i}, n\vb*{j}} {c}_{m\vb*{i}}^\dagger {c}_{n\vb*{j}} + \text{h.c.}).
    \label{eq:hamiltonian-in-wannier}
\end{equation}
我们得到了一个非对角化的哈密顿量，这当然是正确的，因为系统显然应该在动量基——即Bloch基——下对角化。
但\eqref{eq:hamiltonian-in-wannier}提供了非常清晰的物理图像：电子会从一个格点跃迁到另一个格点；$t_{m\vb*{i}, n\vb*{j}}$为所谓\concept{跃迁系数}。

现在我们有两种表示能带的方法，一种是Bloch基底下，用$\vb*{k}$做标签的表示法，一种是Wannier基底下用\eqref{eq:hamiltonian-in-wannier}表示的。
\eqref{eq:hamiltonian-in-wannier}中的跃迁系数$t_{m\vb*{i}, n\vb*{j}}$具体是什么实际上是没有一种唯一的诠释方式的，因为\eqref{eq:hamiltonian-in-wannier}中的$\vb*{i}, \vb*{j}$等只需要取值范围正好是晶格中全部格点，并且满足空间平移不变性就可以。
实际上，在有电磁场或是杂质时，空间平移不变性也可以不满足。
具体两种表述之间的关系我们将在下一节分析。

\section{Wannier波函数的获得和跃迁系数的计算}

本节讨论如何选定Wannier波函数，以及选定了一种Wannier波函数之后要如何计算\eqref{eq:hamiltonian-in-wannier}中的跃迁系数。

\subsection{Bloch波函数诱导出的Wannier波函数}

\subsubsection{对Bloch波函数做傅里叶变换}

现在我们考虑一种特殊的Wannier波函数定义，是直接从系统的正确的Bloch波函数出发做傅里叶变换得到的：
\[
    w_{n\vb*{i}}(\vb*{r}) \propto \sum_{\vb*{k}} \psi_{n\vb*{k}}(\vb*{r}) \ee^{- \ii \vb*{k} \cdot \vb*{R}_{\vb*{i}}},
\]
这里，$n$直接对应于能带编号（如果是复式晶格，那么一个晶胞中的不同原子周围的电子会被重新组合而成为不同能带，体现在能带标签中），而$\vb*{R}_{\vb*{i}}$对应晶格格点。
上式前面的归一化系数尚未选定，但容易计算出
\[
    \frac{1}{V} \int \dd[3]{\vb*{r}} \frac{1}{N} \left( \sum_{\vb*{k}} \psi^*_{n\vb*{k}}(\vb*{r}) \ee^{\ii \vb*{k} \cdot \vb*{R}_{\vb*{i}}} \right) \left( \sum_{\vb*{k}} \psi_{m\vb*{k}}(\vb*{r}) \ee^{- \ii \vb*{k} \cdot \vb*{R}_{\vb*{j}}} \right) = \delta_{mn} \delta_{\vb*{i} \vb*{j}},
\]
取
\begin{equation}
    w_{n\vb*{i}}(\vb*{r}) = \frac{1}{\sqrt{N}} \sum_{\vb*{k}} \psi_{n\vb*{k}}(\vb*{r}) \ee^{-\ii \vb*{k} \cdot \vb*{R}_{\vb*{i}}}, \quad \psi_{n\vb*{k}} = \frac{1}{\sqrt{N}} \sum_{\vb*{R}_{\vb*{i}}} \ee^{\ii \vb*{k} \cdot \vb*{R}_{\vb*{i}}} w_{n \vb*{i}}(\vb*{r}),
    \label{eq:wannier-from-bloch}
\end{equation}
这样归一化条件就是
\begin{equation}
    \frac{1}{V_\text{u.c.}} \int \dd[3]{\vb*{r}} \abs{w_{n \vb*{i}}(\vb*{r})}^2 = 1,
\end{equation}
符合我们的要求。

现在来分析Wannier波函数在实空间中的具体形状。考虑到$u_{n\vb*{k}}$的周期性，我们有
\[
    u_{n\vb*{k}} (\vb*{r}) = u_{n\vb*{k}} (\vb*{r} - \vb*{R}_{\vb*{i}}),
\]
于是
\begin{equation}
    w_{n \vb*{i}}(\vb*{r}) = \frac{1}{\sqrt{N}} \sum_{\vb*{k}} u_{n\vb*{k}} (\vb*{r} - \vb*{R}_{\vb*{i}}) \ee^{\ii \vb*{k} (\vb*{r} - \vb*{R}_{\vb*{i}})},
\end{equation}
这表明Wannier波函数实际上是$\vb*{r} - \vb*{R}_{\vb*{i}}$的函数，可以写成
\begin{equation}
    w_{n\vb*{i}}(\vb*{r}) = w_{n}(\vb*{r} - \vb*{R}_{\vb*{i}}),
\end{equation}
遵从条件\eqref{eq:wannier-general-form}。
在$\vb*{r}$远离$\vb*{R}_{\vb*{i}}$时，指数因子快速振荡，导致整个求和基本上为零，因此Wannier函数只在$\vb*{R}_{\vb*{i}}$附加有较明显的值，因此它确实定域在格点$\vb*{R}_{\vb*{i}}$附近。

\subsubsection{无能带间跃迁的哈密顿量} 

Bloch波函数下的哈密顿量为\eqref{eq:bloch-band-hamiltonian}，不同能带之间没有跃迁。
\eqref{eq:wannier-from-bloch}没有混合不同能带，因此\eqref{eq:wannier-from-bloch}中的不同$n$之间也没有跃迁。
于是在$t_{m\vb*{i}, n\vb*{j}}$中我们取$m = n$，此时有
\begin{equation}
    {H} = - \sum_{n, \{\vb*{i}, \vb*{j}\}} t_{n, \vb*{i} \vb*{j}} {c}_{ni}^\dagger {c}_{n \vb*{j}} + \text{h.c.} ,
    \label{eq:multi-band-tight-binding}
\end{equation}
显然我们对格点坐标$\vb*{i}, \vb*{j}$做了傅里叶变换之后得到的就是以$n$为能带编号的能带，即$n$是能带编号，不同能带之间没有跃迁。

既然不同能带之间没有跃迁，我们暂时略去能带标签$n$。\eqref{eq:multi-band-tight-binding}是最为一般的，原则上可以描述一切晶体中的电子能带。
例如，原则上，自由电子气可以通过引入非常远的跃迁矩阵元来实现。
如果晶格的吸引作用是如此之强，以至于电子是高度定域的，这样只有最近邻的格点之间才会跃迁，即
\[
    \sum_{\vb*{i}, \vb*{j}, \sigma} c^\dagger_{\vb*{i} \sigma} t_{\vb*{i} \vb*{j}} c_{\vb*{j} \sigma} = \sum_{\pair{\vb*{i}, \vb*{j}}, \sigma} t_{\vb*{i} \vb*{j}} c^\dagger_{\vb*{i} \sigma} c_{\vb*{j} \sigma},
\]
从而
\begin{equation}
    {H} = - \sum_{\pair{\vb*{i}, \vb*{j}}} t_{\vb*{i} \vb*{j}} {c}^\dagger_{\vb*{i}} {c}_{\vb*{j}} + \text{h.c.}.
\end{equation}
这称为\concept{紧束缚模型}。在没有耦合磁场或者杂质等时，平移不变性意味着
\begin{equation}
    {H} = - \sum_{\pair{\vb*{i}, \vb*{j}}} t {c}^\dagger_{\vb*{i}} {c}_{\vb*{j}} + \text{h.c.}.
\end{equation}
我们当然还可以引入次近邻跃迁等来修正紧束缚模型。
在空间平移对称性成立，但是紧束缚近似未必成立时，我们用$t_{\vb*{l}}$表示从格点$\vb*{R}_{\vb*{i}}$到$\vb*{R}_{\vb*{i}} + \vb*{R}_{\vb*{l}}$的跃迁系数，此时
\begin{equation}
    H = - \sum_{\vb*{i}, \vb*{l}} t_{\vb*{l}} c^\dagger_{\vb*{i}+\vb*{l}} c_{\vb*{i}} + \text{h.c.},
\end{equation}
厄米性要求
\begin{equation}
    t_{\vb*{l}} = t_{-\vb*{l}}^*.
\end{equation}
请注意$\vb*{i}+\vb*{l}$是正格矢$\vb*{R}_{\vb*{i}} + \vb*{R}_{\vb*{l}}$的编号。

从坐标表象到晶格动量表象的变换是\eqref{eq:bloch-transformation}，而\eqref{eq:multi-band-tight-binding}相当于是\eqref{eq:bloch-transformation}的一个中间结果：\eqref{eq:bloch-transformation}中从$\vb*{r}$表象到$\vb*{k}$表象的积分可以写成
\[
    \frac{1}{\sqrt{V}} \int \dd[3]{\vb*{r}} \psi_{n \vb*{k}}(\vb*{r})^* = \frac{1}{\sqrt{N}} \sum_{\vb*{i}} \ee^{- \ii \vb*{k} \cdot \vb*{R}_{\vb*{i}}} \frac{1}{\sqrt{V_\text{u.c.}}} \int_\text{u.c.} \dd[3]{\vb*{r}} u_{n \vb*{k}}(\vb*{r})^* ,
\]
从坐标表象切换到Wannier波函数相当于首先完成了在晶胞内的积分，然后从Wannier波函数的表象（即\eqref{eq:multi-band-tight-binding}）计算能带就是完成了剩下的对$\vb*{i}$的求和，即\eqref{eq:lattice-fourier}。
从坐标表象切换到$\vb*{i}$表象相当于对哈密顿量做了一点对角化但没有完成，从$\vb*{i}$表象切换到$\vb*{k}$表象（这是一个傅里叶变换，我们将这个过程称为\concept{计算Bloch和}）则完成了对角化。
这意味着给定一个形如\eqref{eq:hamiltonian-in-wannier}的哈密顿量，对$c_{m \vb*{i}}^\dagger$做傅里叶变换\eqref{eq:lattice-fourier}，\eqref{eq:hamiltonian-in-wannier}对角化，这个过程产生的傅里叶变换中的$\vb*{k}$实际上就是直接从周期势计算Bloch波函数而产生的那个简约波矢$\vb*{k}$。%
\footnote{
    这个结论并不是平凡的，因为存在这样的可能：对同一个能量本征态，用傅里叶变换得到的$\vb*{k}$表象的那个$\vb*{k}$和直接从自由电子受到周期势场扰动出发计算得到的$\vb*{k}$不一样。例如，它们是否可能差一个正负号？
    但仔细检查我们此处的计算过程，这种可能性是不存在的。

    在解析计算时基本上我们写下来的每个式子都非常“连续”，从而不会有“$\vb*{k}$的值被缩放、顺序被打乱”这种情况，但是在做数值计算时这些是需要考虑到。
    一个新手在编写对角化近独立电子哈密顿量的程序时就有可能用错误的$\vb*{k}$标记各个本征态，从而产生莫名其妙的错误。
}%
对角化结果是
\begin{equation}
    H = \sum_{\vb*{k}} \epsilon_{\vb*{k}} c^\dagger_{\vb*{k}} c_{\vb*{k}}, \quad \epsilon_{\vb*{k}} = - \sum_{\vb*{R}_{\vb*{l}}} t_{\vb*{l}} \ee^{- \ii \vb*{k} \cdot \vb*{R}_{\vb*{l}}} .
\end{equation}
显然，这意味着，如果我们\emph{已经}有了一个单电子能谱，可以通过傅里叶变换
\begin{equation}
    t_{\vb*{l}} = - \frac{1}{N} \sum_{\vb*{k}} \ee^{\ii \vb*{k} \cdot \vb*{R}_{\vb*{l}}} \epsilon_{\vb*{k}} = - V_\text{u.c.} \int \frac{\dd[3]{\vb*{k}}}{(2\pi)^3} \ee^{\ii \vb*{k} \cdot \vb*{R}_{\vb*{l}}} \epsilon_{\vb*{k}}
    \label{eq:from-spectrum-to-tight-binding}
\end{equation}
得到对应的跃迁系数；因子$V_\text{u.c.}$是必要的，因为
\[
    V_\text{u.c.} \sum_{\vb*{R}_{\vb*{l}}} \cdots \propto V.
\]
因此，给定一个能带之后，我们其实总是可以写出一个\eqref{eq:hamiltonian-in-wannier}形式的哈密顿量来复刻这个能带，只要引入足够多的$t_{\vb*{l}}$，就能够得到\emph{任何}能谱。
反过来，将电子的产生湮灭算符$c_{m \vb*{i}}^\dagger$做傅里叶变换\eqref{eq:lattice-fourier}，\eqref{eq:hamiltonian-in-wannier}即可写成对角化的，立刻可以看出能带。

根据\autoref{sec:momentum-space-inner-product}中的论证，\eqref{eq:hamiltonian-in-wannier}做完傅里叶变换后不会有$1/N$或是$1/V$之类的因子出现——直接从自由电子气出发加入周期势场计算得到的对角化哈密顿量中也没有这样的因子。
因此两种$\vb*{k}$表象的归一化也是一致的。
总之，\eqref{eq:lattice-fourier}给出的$\vb*{k}$表象和从自由电子出发得到的限制在第一布里渊区中的简约波矢标记的Bloch电子是完全一样的表象。

请注意上面的推导完全没有用到一个晶胞里面有几种原子之类的条件：$\vb*{i}, \vb*{j}$等都是\emph{晶格格点}，而不是具体的原子的位置。
对简单晶格，这是非常合理的，而对复式晶格，我们的推导给出了一种把它近似地看成简单晶格的方法。

\subsection{一般的Wannier波函数}

在\eqref{eq:multi-band-tight-binding}中我们让$n=m$，现在则讨论一般的不同的$m$和$n$之间存在跃迁的模型。
在这样的模型中我们指派了一个其实并非我们的体系的能量本征态的Wannier波函数，然后以此为表象写出一个修正后的紧束缚模型，这样就会有带间跃迁了。
这种含有带间跃迁的紧束缚模型在对角化之后能带标签将会重新设定。

\begin{figure}
    \centering
    \subfigure[对单带简单晶格模型给定一组波函数$v(\vb*{r} - \vb*{R}_{\vb*{i}})$，不同$\vb*{i}$的波函数之间有很强的交叠，即并不正交；不同的颜色用于区分不同原子]{
        \includegraphics[width=0.4\textwidth]{band/hopping/overlap.png}
        \label{fig:simple-lattice-ortibal}
    }
    \subfigure[根据$v(\vb*{r} - \vb*{R}_{\vb*{i}})$做正交化，得到一组Wannier波函数，以此为基底时，波函数本身的空间分布的细节部分被抹去，只留下“电子在哪个格点附近”的粗略信息；一些Wannier态之间容易发生跃迁（用较深的颜色表示），另一些Wannier态之间的跃迁不容易发生（用较浅的颜色表示）]{
        \input{band/hopping/hopping.tex}
        \label{fig:simple-lattice-hopping}
    }
    \subfigure[晶格中可以有不止一种原子（此图中有两种），每种原子周围可以不止一种轨道]{
        \includegraphics[width=0.5\textwidth]{band/hopping/lattice-multi-atoms.png}
        \label{fig:complex-lattice-ortibal}
    }
    \subfigure[最终的模型形如\eqref{eq:hamiltonian-in-wannier}，其中的电子可以用两个标签标记，一个表示Wannier波函数，不同状态的电子之间的跃迁有强有弱，用颜色深浅表示]{
        \input{band/hopping/multiple-hopping.tex}
        \label{fig:complex-lattice-hopping}
    }
    \caption{从给定的局域波函数获得Wannier波函数并在此表象下计算哈密顿量}
    \label{fig:obtain-wannier-compute-hamiltonian}
\end{figure}

我们要做的事情大体上是\autoref{fig:obtain-wannier-compute-hamiltonian}展示的那样。
首先设我们有一组大体上定域在各个原子附近的波函数（对简单晶格如\autoref{fig:simple-lattice-ortibal}所示，对复式晶格如\autoref{fig:complex-lattice-ortibal}所示），记作$v_{n}(\vb*{r} - \vb*{R}_{\vb*{i}})$，这里$\vb*{i}$标记它定域在的晶胞的位置，$n$提供进一步的信息，如它是一个晶胞中的哪一种原子附近的哪一个轨道，或者是哪两个原子之间的成键轨道或是反键轨道，等等。
同一个$\vb*{i}$，不同$n$的$v_n(\vb*{r} - \vb*{R}_{\vb*{i}})$之间的内积通常是零，但是不同$\vb*{i}$的$v_{n}(\vb*{r} - \vb*{R}_{\vb*{i}})$内积通常不是零（\autoref{fig:simple-lattice-ortibal}直观地展示了这一点），需要对不同$\vb*{i}$的$v_{n}(\vb*{r} - \vb*{R}_{\vb*{i}})$做正交化，让它们变得更加尖锐，这就得到了Wannier波函数（如\autoref{fig:simple-lattice-hopping}和\autoref{fig:complex-lattice-hopping}中的圆点所示），据此可以将哈密顿量写成\eqref{eq:hamiltonian-in-wannier}的形式（见\autoref{fig:simple-lattice-hopping}和\autoref{fig:complex-lattice-hopping}中的跃迁箭头）。
正交化不会混合不同的$n$，因此大体上可以认为标签$\vb*{i}$和$n$在正交化前后没有变。

总之我们要做的事情就是获得一组相比于用Bloch波函数算出来的Wannier波函数稍微劣质一些的Wannier波函数。
这种稍微劣质一些的Wannier波函数可以通过将不同原子附近的轨道波函数正交化得到，也可以通过线性组合单原子的几个不同的轨道波函数然后再将不同原子附近的这些轨道波函数正交化得到，需要线性组合是因为原子中的电子受其它原子作用而发生能级重组，即轨道杂化。
甚至还可以计算单个晶胞内的成键轨道和反键轨道，然后把成键轨道和反键轨道正交化之后当作Wannier波函数。
这和坐标表象、$i$表象和晶格动量表象之间的关系很像：从坐标表象到单原子轨道相当于稍稍对哈密顿量做了对角化，从单原子轨道到有杂化的轨道相当于又做了一些对角化，到最后得到正确的能带编号，就是完成了能带标签部分的对角化。

\subsubsection{正交化：从任意的局域波函数获得Wannier波函数}

在给定一组$v_n(\vb*{r} - \vb*{R}_{\vb*{i}})$之后我们尝试做正交化。由于不同$n$的$v_{n}(\vb*{r} - \vb*{R}_{\vb*{i}})$已经是正交的，不需要变动这个标签；我们下面暂时略去$n$。
首先定义
\begin{equation}
    \phi_{\vb*{k}}(\vb*{r}) = \frac{A_{\vb*{k}}}{\sqrt{N}} \sum_{\vb*{i}} \ee^{\ii \vb*{k} \cdot \vb*{R}_{\vb*{i}}} v(\vb*{r} - \vb*{R}_{\vb*{i}}),
\end{equation}
根据归一化条件
\[
    1 = \int \dd[3]{\vb*{r}} \abs{\phi_{\vb*{k}}(\vb*{r})}^2,
\]
可以计算得到
\begin{equation}
    \frac{1}{\abs*{A_{\vb*{k}}}^2} = \sum_{\vb*{i}} \ee^{\ii \vb*{k} \cdot \vb*{R}_{\vb*{i}}} \int \dd[3]{\vb*{r}} v(\vb*{r})^* v(\vb*{r} - \vb*{R}_{\vb*{i}}).
\end{equation}
我们会发现$\{\phi_{\vb*{k}}(\vb*{r})\}$是正交归一化的，因此对它们做反向的傅里叶变换得到的
\begin{equation}
    w_{\vb*{i}}(\vb*{r}) = \frac{1}{\sqrt{N}} \sum_{\vb*{k}} \ee^{- \ii \vb*{k} \cdot \vb*{R}_{\vb*{i}}} \phi_{\vb*{k}}(\vb*{r}) 
\end{equation}
也是正交归一化的；不过此时我们有
\begin{equation}
    \delta_{\vb*{i} \vb*{j}} = \int \dd[3]{\vb*{r}} w_{\vb*{i}}(\vb*{r})^* w_{\vb*{j}}(\vb*{r}),
\end{equation}
和\eqref{eq:wannier-function-normalization-uc}有所不同，在本节的习惯下面应有
\begin{equation}
    - t_{m\vb*{i}, n\vb*{j}} = \mel{m\vb*{i}}{\hat{h}}{n\vb*{j}} = \int \dd[3]{\vb*{r}} w_m^*(\vb*{r} - \vb*{R}_{\vb*{i}} + \vb*{R}_{\vb*{j}}) \hat{h} w_n(\vb*{r}).
\end{equation}

由于$A_{\vb*{k}}$存在动量依赖，$w_{\vb*{i}}(\vb*{r})$和$v(\vb*{r} - \vb*{R}_{\vb*{i}})$未必是一样的——数学上可以证明$w_{\vb*{i}}(\vb*{r})$比$v(\vb*{r} - \vb*{R}_{\vb*{i}})$更加局域。
在$v(\vb*{r})$已经足够局域的时候，
\begin{equation}
    \int \dd[3]{\vb*{r}} v(\vb*{r} - \vb*{R}_{\vb*{i}})^* v(\vb*{r} - \vb*{R}_{\vb*{j}}) = \delta_{\vb*{i} \vb*{j}},
\end{equation}
此时$w_{\vb*{i}}(\vb*{r})$就是$v(\vb*{r} - \vb*{R}_{\vb*{i}})$。

\subsubsection{一般的Wannier表象下的哈密顿量及其对角化} 

现在我们考虑基底$\{w_{n \vb*{i}}(\vb*{r}) \}$下的哈密顿量及其对角化。形式地我们总是可以写出
\begin{equation}
    - \frac{\laplacian}{2m} w_{n \vb*{i}} + U(\vb*{r} - \vb*{R}_{\vb*{i}}) w_{n \vb*{i}} = \epsilon_{n} w_{n \vb*{i}},
\end{equation}
不过要注意此时$U$未必在坐标表象下是对角化的；$U$与晶体的周期势场$V(\vb*{r})$需要区分。
由于此时有不同的$n$之间的跃迁，我们使用记号$t_{mn, \vb*{l}}$表示$t_{m(\vb*{i}+\vb*{l}), n\vb*{i}}$。
跃迁系数计算为
\[
    \begin{aligned}
        - t_{mn, \vb*{l}} &= \int \dd[3]{\vb*{r}} w_{m(\vb*{i}+\vb*{l})}(\vb*{r})^* \left( - \frac{\laplacian}{2m} + V(\vb*{r}) \right) w_{n \vb*{i}}(\vb*{r}) \\
        &= \int \dd[3]{\vb*{r}} w_{m(\vb*{i}+\vb*{l})}(\vb*{r})^* \left( \epsilon_n - U(\vb*{r} - \vb*{R}_{\vb*{i}}) + V(\vb*{r}) \right) w_{n\vb*{i}}(\vb*{r}),
    \end{aligned}
\]
第一项只有在$\vb*{l}=0$时才有非零值，是$\epsilon_n$；第二项和第三项可以使用周期性写成
\[
    \begin{aligned}
        &\quad \int \dd[3]{\vb*{r}} w_{m (\vb*{i}+\vb*{l})}(\vb*{r})^* \left( - U(\vb*{r} - \vb*{R}_{\vb*{i}}) + V(\vb*{r}) \right) w_{n \vb*{i}}(\vb*{r}) \\
        &= \int \dd[3]{\vb*{r}} w_{m}(\vb*{r} - \vb*{R}_{\vb*{l}})^* \left( - U(\vb*{r}) + V(\vb*{r}) \right) w_{n}(\vb*{r}),
    \end{aligned}
\]
因此我们有
\begin{equation}
    - t_{nn, 0} = \epsilon_n + \underbrace{\int \dd[3]{\vb*{r}} w_{n}(\vb*{r})^* \left(V(\vb*{r}) - U(\vb*{r}) \right) w_{n}(\vb*{r})}_{- J_{n, 0}},
\end{equation}
而
\begin{equation}
    - t_{mn, \vb*{l}} = \int \dd[3]{\vb*{r}} w_{m}(\vb*{r} - \vb*{R}_{\vb*{l}})^* \left( V(\vb*{r}) - U(\vb*{r}) \right) w_{n}(\vb*{r}), \quad \text{$m \neq n$ or $\vb*{l} \neq 0$}.
    \label{eq:off-diagnoal-hopping}
\end{equation}

我们下面要求$i$仅仅标记晶胞位置，晶胞内部有不同原子，每个原子周围有不同形状的Wannier波函数等事实全部使用$n$标记；这样$\vb*{i}$的自由度数目和$\vb*{k}$一致，这里的对角化过程相比直接从Bloch波函数获得的Wannier波函数表象下的对角化过程，唯一多出来的就是重新安排能带编号。
因此，如果我们采用这样的方案对角化哈密顿量：对$c_{m\vb*{i}}^\dagger$做傅里叶变换\eqref{eq:lattice-fourier}，然后对$\vb*{k}$相同，$n$不同的不变子空间做对角化，那么得到的$\vb*{k}$表象同样就是Bloch波函数表象。
将$i$表象切换到$\vb*{k}$表象，给出
\begin{equation}
    H = \sum_{\vb*{k}} \sum_{m, n} \sum_{\vb*{l}} t_{mn, \vb*{l}} \ee^{- \ii \vb*{k} \cdot \vb*{R}_{\vb*{l}}} c^\dagger_{m \vb*{k}} c_{n \vb*{k}} ,
    \label{eq:k-points-with-hopping-bands}
\end{equation}
因此只需要对角化以上哈密顿量——这只不过是线性组合一下不同$m, n$而已——就得到了电子能带。

\subsubsection{跃迁系数大小和能带形态}\label{sec:hopping-and-band-shape}

我们现在来分析跃迁系数的大小受什么因素影响。有两种参数可以影响跃迁系数，一种是晶格常数，一种是$V(\vb*{r})$。
由于Wannier波函数非常局域，$U(\vb*{r} - \vb*{R}_{\vb*{i}})$总是非常“深”的，即其各个矩阵元基本上是负的且绝对值很大；$V(\vb*{r})$的“尖锐”与否从而影响了$V(\vb*{r}) - U(\vb*{r})$的大小。
% TODO

跃迁系数会显著影响能带形态。能带形态对电子行为显然有很大的影响。例如，能带更窄的系统态密度更大，从而库伦散射更明显，从而也更加容易在相互作用加入之后变成强关联系统（但实际上有没有强关联系统，或是强关联效应是否有趣，则是说不好的，例如强烈的库伦散射也可能让电子就定域在本地，低能下看就像一个自旋自由度，或者干脆就是离子实的一部分）。

% \eqref{eq:k-points-with-hopping-bands}中固定$\vb*{k}$，我们对角化矩阵
% \[
%     \left[ \sum_l t_{mn, l} \ee^{- \ii \vb*{k} \cdot \vb*{R}_l} \right]_{mn}
% \]
% 即可。这个矩阵的对角元为诸$t_{nn, 0}$，非对角元是\eqref{eq:off-diagnoal-hopping}。

对只有最近邻或是次近邻的跃迁的系统，我们有一个非常直观的物理图像：似乎可以用“某个电子正在某个格点附近”来标记一个电子，即电子似乎被紧紧地束缚在晶格上，无法长距离移动，这就是“紧束缚”一词的来历。
或者，也有可能电子并不是特别局域，但是原子间距很大，以至于在系统中电子通常具有的动能下，非常远距离的跃迁似乎无法一次完成。
这就是说，紧束缚模型中，只要$t$不是很大，电子的动能不应该能够到达特别大，从而也不应该有太大的能带带宽（的确应该考虑带宽而不是能量的绝对大小，因为总是可以通过化学势来任意增减能量，而上面的物理图像和化学势毫无关系）。
还可以从另一个角度看这个现象：我们知道自由电子的动能项在动量表象下是对角化的，这意味着它在坐标表象下是非常不对角化的，体现在$\vb*{i}$表象中就是有非常远的跃迁。
另一方面，晶格势能项在坐标表象下是对角化的，体现在$i$表象中就是$\epsilon_{\vb*{i}} c^\dagger_{\vb*{i}} c_{\vb*{i}}$型的项占据压倒性优势。
因此，单电子越是被束缚，其哈密顿量就越像晶格势能项，只涉及很近邻的跃迁，而越是自由，其哈密顿量就越像自由电子的哈密顿量，涉及很远的跃迁。
也可以从傅里叶变换的角度看这个问题：此时\eqref{eq:from-spectrum-to-tight-binding}中只有一个$\vb*{l}$分量，而自由电子则有很多相长干涉的$l$分量，从而紧束缚模型通常能带带宽不宽。
总之，以下几个说法基本上是等价的：
\begin{enumerate}
    \item 系统可以用紧束缚模型或者考虑了次近邻、再次近邻的紧束缚模型加上一个相互作用项描述；
    \item 系统中的电子跃迁能力不大；
    \item 系统中电子动能有较低的上限。
\end{enumerate}
满足以上等价条件的电子系统具有较窄的能带。
然而并非窄的能带一定意味着较差的跃迁能力，因为\eqref{eq:from-spectrum-to-tight-binding}中的各个$l$分量可以特意设计成具有特定的相位，使得它们的峰值总是互相错开。

应注意窄带电子未必一定形成强关联系统。
这方面的一个例子是原子的内层电子，它们基本上不跃迁，因此能带也非常窄。
然而原子的内层电子是离子实的一部分，并无有趣的强关联效应。

\subsection{原子轨道线性组合和紧束缚模型}\label{sec:tight-binding-hopping}

设$w_{s}(\vb*{r} - \vb*{R}_{\vb*{i}})$为我们选定的Wannier波函数，其中标签$s$标记轨道而
我们用$s$而不是$n$做标签，因为不能确定在$\{w_{s}(\vb*{r} - \vb*{R}_{\vb*{i}})\}$下不同$s$之间是否有很强的跃迁，从而不能确定$s$标签是不是足够精确地标记了不同的能带。

\subsubsection{简单晶格的原子轨道线性组合（LCAO）} 

在简单晶格中，如果不同原子的轨道基本上没有重叠，那实际上单原子轨道波函数就是Wannier波函数。
设不同原子的轨道没有什么重叠，则有
\begin{equation}
    \int \dd[3]{\vb*{r}} \varphi_n^*(\vb*{r} - \vb*{R}_{\vb*{i}}) \varphi_n(\vb*{r} - \vb*{R}_{\vb*{j}}) = \delta_{\vb*{i} \vb*{j}},
    \label{eq:no-overlap-atom-orbital}
\end{equation}
$\vb*{i}=\vb*{j}$时上式显然是$1$，$\vb*{i} \neq \vb*{j}$时由于两个波函数没有重叠，就是零，因此上式的确是成立的。
$\varphi_n(\vb*{r} - \vb*{R}_{\vb*{i}})$满足
\begin{equation}
    \left( - \frac{\laplacian}{2m} + V_\text{atom} (\vb*{r} - \vb*{R}_{\vb*{i}}) \right) \varphi_n(\vb*{r} - \vb*{R}_{\vb*{i}}) = \epsilon_n \varphi_n(\vb*{r} - \vb*{R}_{\vb*{i}}),
\end{equation}
而能带电子的波函数满足
\begin{equation}
    \left( - \frac{\laplacian}{2m} + V (\vb*{r}) \right) \psi_{n \vb*{k}} = \epsilon_{n \vb*{k}} \psi_{n \vb*{k}},
\end{equation}
我们现在做展开
\begin{equation}
    \psi_{n \vb*{k}}(\vb*{r}) = \sum_{\vb*{i}} a_{\vb*{i}} \varphi_n(\vb*{r} - \vb*{R}_{\vb*{i}}),
\end{equation}
就得到
\[
    \sum_{\vb*{i}} a_{\vb*{i}} (\epsilon_n + V(\vb*{r}) - V_\text{atom}(\vb*{r} - \vb*{R}_{\vb*{i}})) \varphi_n(\vb*{r} - \vb*{R}_{\vb*{i}}) = \epsilon_{n \vb*{k}} \sum_{\vb*{i}} a_{\vb*{i}} \varphi_{\vb*{i}}(\vb*{r} - \vb*{R}_{\vb*{i}}),
\]
两边作用\eqref{eq:no-overlap-atom-orbital}，就得到
\begin{equation}
    (\epsilon_{n \vb*{k}} - \epsilon_n) a_{\vb*{i}} = \sum_{\vb*{j}} a_{\vb*{j}} \int \dd[3]{\vb*{r}} \varphi_n(\vb*{r} - \vb*{R}_{\vb*{i}})^* ( V(\vb*{r}) - V_\text{atom}(\vb*{r} - \vb*{R}_{\vb*{i}})) \varphi_n(\vb*{r} - \vb*{R}_{\vb*{j}}).
\end{equation}

总之，在原子轨道波函数之间真的没有什么交叠的情况下，原子轨道波函数就是Wannier波函数。
然而，在大多数情况下，原子轨道波函数还是比较不局域的，我们需要先从原子轨道波函数出发计算得到Bloch波函数，然后做傅里叶变换得到比原子轨道波函数更加局域的Wannier波函数。

\subsubsection{复式晶格的LCAO} 

可以先假装轨道波函数真的是Wannier波函数，然后做杂化


\subsection{坐标表象作为一种Wannier表象} 

如果用以自行设定的用不同电子轨道线性组合得到的Wannier波函数为表象，这个表象下的波函数只能够展示电子在不同晶胞上的概率振幅分布，保留了一些“一个电子是哪些轨道的混合”的信息，能带编号比较清晰。
以自行设定的用不同电子轨道线性组合得到的Bloch波函数为表象。波函数不显示任何电子的空间分布信息，但是保留了一些“一个电子是哪些轨道的混合”的信息。

\subsection{表象变换总结} 

总结一下，形如\eqref{eq:hamiltonian-in-wannier}的近独立电子模型最大的好处在于提供了介于哈密顿量完全对角化的Bloch波函数表象（或者说晶格动量表象）和完全没有做过任何处理的坐标表象之间的许多表象。
我们上面提到过的表象从坐标表象到晶格动量表象形成如下序列：
\begin{enumerate}
    \item \eqref{eq:electron-gas-hamiltonian}，完全就是“自由电子气动能加势能”，没有做任何处理。最容易写下哈密顿量，最难以理解其物理。这种表象下的波函数清楚地展示了电子在空间各点的概率振幅分布，但是没有提供关于$\vb*{k}$和$n$的任何信息。
    \item 以单原子轨道为表象。相对容易写下来哈密顿量。这种表象下的波函数无法展示每个轨道具体长什么样的信息（因为轨道编号只是一个抽象的量子数），但电子出现在不同原子附近的概率振幅的信息保留了。第一次出现了和能带编号有关的标签（轨道编号）。
    \item 以单原子内部的杂化轨道为表象。电子出现在不同原子附近的概率振幅的信息保留了。杂化轨道的编号是能带编号的更好的近似，即能带编号开始清晰起来。
    \item 以原子间的成键和反键轨道为表象。电子出现在不同原子附近的概率振幅的信息被模糊化了，但是能带编号变得更清晰了。
    \item \eqref{eq:multi-band-tight-binding}，离完全对角化的$\epsilon = \epsilon_{\vb*{k}}$只有一步之遥。这个表象下的波函数只能够展示电子在不同晶胞上的概率振幅分布，能带编号非常清晰，而原来的单原子轨道完全模糊了。
    \item 能带$\epsilon = \epsilon_{n\vb*{k}}$。波函数不展示任何电子的空间分布信息，也没有任何关于单原子轨道的信息，只有确定的晶格动量和能带编号。
\end{enumerate}

从上到下，坐标变得模糊而动量变得清晰：先是单原子波函数的细节模糊了，然后是电子在晶格内的哪个原子附近（或者说，复式晶格中在哪套子格子附近）变得模糊了，最后电子在哪个晶胞附近也模糊了，而$\vb*{k}$变得清晰了。
单电子轨道标签先是出现（作为单原子波函数的细节模糊的补偿），然后变得模糊了：先是杂化，然后是成键、反键，单原子轨道的信息逐步丢失，而越来越像正确的能带标签。
凝聚态理论研究中通常不会采取这个序列两端的表象，因为它们过于复杂而难以做近似。
这就是紧束缚模型的重要之处，虽然当代已经没人用它做任何第一性原理计算了。

到目前为止，所谓“保留一些信息，丢弃另一些”只不过是普通的表象变换：总的信息量都是守恒的。
然而一些时候，一种表象下的哈密顿量比另一种更加对角化，从而在这种表象下舍弃或者更加精确的，“积掉”一些自由度，能够获得良好的近似，因此表象变换确实和基于哈密顿量的重整化有着密切的关系。
我们将在讨论张量网络方法时用到这个想法。

\section{电磁场耦合}

% TODO

\begin{equation}
    t_{\vb*{i}, \vb*{j}} = \exp(- \ii e \int_{\vb*{i}}^{\vb*{j}} \dd{\vb*{r}} \cdot \vb*{A}),
\end{equation}

\section{相互作用通道}

\subsection{Bloch表象下的相互作用通道}\label{sec:interaction-bloch}

本节讨论从自由电子模型出发如何加入相互作用。在自由电子模型中
\begin{equation}
    c^\dagger_{\vb*{k}} = \frac{1}{\sqrt{V}} \int \dd[3]{\vb*{r}} \ee^{\ii \vb*{k} \cdot \vb*{r}} \psi^\dagger(\vb*{r}).
\end{equation}
对库伦相互作用，有
\[
    \begin{aligned}
        H_{\vb*{k}_4 \vb*{k}_3 \vb*{k}_2 \vb*{k}_1} &= \frac{1}{2} \int \dd[3]{\vb*{r}} \int \dd[3]{\vb*{r}'} \braket*{\vb*{k}_4}{\vb*{r}} \braket*{\vb*{k}_3}{\vb*{r}'} V(\vb*{r} - \vb*{r}') \braket*{\vb*{r}'}{\vb*{k}_2} \braket*{\vb*{r}}{\vb*{k}_1}  \\
        &= \frac{1}{2 V^2} \int \dd[3]{\vb*{r}} \int \dd[3]{\vb*{r}'} \ee^{\ii (\vb*{k}_2 - \vb*{k}_3) \cdot \vb*{r}'} \ee^{\ii (\vb*{k}_1 - \vb*{k}_4) \cdot \vb*{r}} V(\vb*{r} - \vb*{r}') \\
        &= \frac{1}{2V^2} \int \dd[3]{\vb*{r}} \int \dd[3]{\vb*{r}'} \ee^{- \ii (\vb*{k}_3 + \vb*{k}_4 - \vb*{k}_1 - \vb*{k}_2) \cdot \vb*{r}'} \ee^{- \ii(\vb*{k}_2 - \vb*{k}_3) \cdot \vb*{r}} V(\vb*{r}) \\
        &= \frac{1}{2V} \delta_{\vb*{k}_3 + \vb*{k}_4, \vb*{k}_1 + \vb*{k}_2} \int \dd[3]{\vb*{r}} \ee^{- \ii (\vb*{k}_2 - \vb*{k}_3) \cdot \vb*{r}} V(\vb*{r}),
    \end{aligned}
\]
我们定义
\[
    \vb*{q} = \vb*{k}_2 - \vb*{k}_3,
\]
就得到
\begin{equation}
    H_{\vb*{k}_1 + \vb*{q}, \vb*{k}_2 - \vb*{q}, \vb*{k}_2, \vb*{k}_1} = \frac{1}{2V} \int \dd[3]{\vb*{r}} \ee^{- \ii \vb*{q} \cdot \vb*{r}} V(\vb*{r}),
\end{equation}
或者说
\begin{equation}
    H_\text{int} = \frac{1}{2V} \sum_{\vb*{k}_1, \vb*{k}_2, \vb*{q}} V_{\vb*{q}} c^\dagger_{\vb*{k}_1 + \vb*{q}} c^\dagger_{\vb*{k}_2 - \vb*{q}} c_{\vb*{k}_2} c_{\vb*{k}_1} , \quad V_{\vb*{q}} = \int \dd[3]{\vb*{r}} \ee^{- \ii \vb*{q} \cdot \vb*{r}} V(\vb*{r}).
\end{equation}
如果考虑自旋，就有
\begin{equation}
    H_\text{int} = \frac{1}{2V} \sum_{\alpha, \beta} \sum_{\vb*{k}_1, \vb*{k}_2, \vb*{q}} V_{\vb*{q}} c^\dagger_{\vb*{k}_1 + \vb*{q}, \alpha} c^\dagger_{\vb*{k}_2 - \vb*{q}, \beta} c_{\vb*{k}_2 \beta} c_{\vb*{k}_1 \alpha}.
\end{equation}

\begin{equation}
    V(\vb*{q}) = \frac{4\pi e^2}{\abs*{\vb*{q}}^2}.
\end{equation}

\subsection{单能带系统的相互作用哈密顿量}

对单带模型，在Wannier表象下，库仑相互作用可以表示成如下矩阵元形式：
\begin{equation}
    \begin{aligned}
        V_{\vb*{i} \vb*{i}' \vb*{j} \vb*{j}'} &= \frac{1}{2} \int \dd[3]{\vb*{r}} \int \dd[3]{\vb*{r}'} \braket{\vb*{i}}{\vb*{r}} \braket{\vb*{i}'}{\vb*{r}'} V(\vb*{r} - \vb*{r}') \braket{\vb*{r}'}{\vb*{j}'} \braket{\vb*{r}}{\vb*{j}} \\
        &= \frac{1}{2} \int \dd[3]{\vb*{r}} \int \dd[3]{\vb*{r}'} w_{\vb*{i}}^*(\vb*{r}) w_{\vb*{i}'}^*(\vb*{r}') V(\vb*{r} - \vb*{r}') w_{\vb*{j}'}(\vb*{r}') w_{\vb*{j}}(\vb*{r}),
    \end{aligned}
    \label{eq:wannier-basis-interaction}
\end{equation}
于是总的哈密顿量为
\begin{equation}
    H = \sum_{\vb*{i}, \vb*{i}', \sigma} c^\dagger_{\vb*{i} \sigma} t_{\vb*{i} \vb*{i}'} c_{\vb*{i}' \sigma} + \sum_{\vb*{i}, \vb*{i}', \vb*{j}, \vb*{j}', \sigma, \sigma'} V_{\vb*{i} \vb*{i}' \vb*{j} \vb*{j}'} c^\dagger_{\vb*{i} \sigma} c^\dagger_{\vb*{i}' \sigma'} c_{\vb*{j}' \sigma'} c_{\vb*{j} \sigma}.
\end{equation}

对上式做傅里叶变换，使用\eqref{eq:lattice-fourier}会有$1/2N$的因子，然而\autoref{sec:momentum-space-inner-product}也论证了，从$\vb*{r}$表象切换到动量表象后，二体相互作用项会有$1/2V$的因子。
\autoref{sec:tight-binding-hopping}中已经论证了，无论是自由电子气模型加入周期势扰动，然后做傅里叶变换得到的$\vb*{k}$表象和对上式做傅里叶变换得到的$\vb*{k}$表象就是一个东西，所以看起来似乎有矛盾。
实际上两者没有矛盾，因为\autoref{sec:momentum-space-inner-product}中的二体相互作用的耦合常数直接就是$V_{\vb*{q}}$，但是本节中的二体相互作用的耦合常数是$V_{i i' j j'}$傅里叶变换而来，根据\eqref{eq:wannier-and-free}，两者的确应该差一个$V_\text{u.c.}$因子。

与自由电子气模型或凝胶模型不同，紧束缚模型对相互作用是非常敏感的，不能保证加入（即使比较弱的）相互作用后，系统能够用费米液体理论（见\autoref{sec:landau-fermi-liquid}）描述，甚至不能保证能带仍然是具有明确物理意义的。
这是因为紧束缚模型的能带通常更加窄，从而态密度更大；我们也可以如此理解紧束缚模型对相互作用的敏感性：由于电子动能不能取特别大的值，相比之下相互作用能量应该占据主导，从而系统容易具有强关联效应。（见\autoref{sec:hopping-and-band-shape}）
一些数值计算方法，如DMRG，需要将所有自由度都定义在晶格上，从而，它们可以毫无困难地用于模拟很大一类系统，无论它们有无强关联，但是却无法用于有效地模拟普通的费米液体系统。

需要注意，并非所有强关联系统都出现在紧束缚模型中。费米液体系统加入了适当的相互作用之后也可以出现强关联效应，此时使用基于格点的计算方法就不能获得很好的效果了。

\subsection{紧束缚近似成立时的单带相互作用通道}\label{sec:single-band-interaction-channel}

原则上$U_{\vb*{i} \vb*{i}' \vb*{j}' \vb*{j}}$对很多不同的$\vb*{i}, \vb*{i}', \vb*{j}', \vb*{j}$组合都有非零值。物理上这是很好理解的，因为库伦相互作用可以将任意原子附近的两个电子散射到任意的其它地方，由于高度定域的电子动量不确定，这里无所谓动量守恒的约束。
然而，在紧束缚模型成立时，足够大的矩阵元的$\vb*{i}, \vb*{i}', \vb*{j}', \vb*{j}$中，$\vb*{j}$和$\vb*{j}'$不是最近邻，就是完全一样（即所谓on-site repulsion）。
由于Wannier波函数高度定域，从\eqref{eq:wannier-basis-interaction}中可以看出，仅有的可能是$\vb*{i}=\vb*{i}'=\vb*{j}=\vb*{j}'$，或是$\vb*{i}=\vb*{j} \neq \vb*{i}'=\vb*{j}'$，或是$\vb*{i}=\vb*{j}' \neq \vb*{i}' = \vb*{j}$。
于是就有
\[
    \begin{aligned}
        &\quad \sum_{\vb*{i}, \vb*{i}', \vb*{j}, \vb*{j}', \sigma, \sigma'} V_{\vb*{i} \vb*{i}' \vb*{j} \vb*{j}'} c^\dagger_{\vb*{i} \sigma} c^\dagger_{\vb*{i}' \sigma'} c_{\vb*{j}' \sigma'} c_{\vb*{j} \sigma} \\
        &= \sum_{\vb*{i}, \sigma, \sigma'} V_{\vb*{i} \vb*{i} \vb*{i} \vb*{i}} c^\dagger_{\vb*{i} \sigma} c^\dagger_{\vb*{i} \sigma'} c_{\vb*{i} \sigma'} c_{\vb*{i} \sigma} 
        + \sum_{\vb*{i}, \vb*{j}, \sigma, \sigma'} V_{\vb*{i} \vb*{j} \vb*{j} \vb*{i}} c^\dagger_{\vb*{i} \sigma} c^\dagger_{\vb*{j} \sigma'} c_{\vb*{j} \sigma'} c_{\vb*{i} \sigma}
        + \sum_{\vb*{i}, \vb*{j}, \sigma, \sigma'} V_{\vb*{i} \vb*{j} \vb*{i} \vb*{j}} c^\dagger_{\vb*{i} \sigma} c^\dagger_{\vb*{j} \sigma'} c_{\vb*{i} \sigma'} c_{\vb*{j} \sigma},
    \end{aligned}
\]
第一项为
\[
    \begin{aligned}
        \sum_{\vb*{i}, \sigma, \sigma'} V_{\vb*{i} \vb*{i} \vb*{i} \vb*{i}} c^\dagger_{\vb*{i} \sigma} c^\dagger_{\vb*{i} \sigma'} c_{\vb*{i} \sigma'} c_{\vb*{i} \sigma} &= 2 \sum_{\vb*{i}} V_{\vb*{i} \vb*{i} \vb*{i} \vb*{i}} n_{\vb*{i} \uparrow} n_{\vb*{i} \downarrow} + \sum_{\vb*{i}} U_{\vb*{i} \vb*{i} \vb*{i} \vb*{i}} n_{\vb*{i}} \\
        &= \sum_{\vb*{i}} U_{\vb*{i}} n_{\vb*{i} \uparrow} n_{\vb*{i} \downarrow} + \frac{1}{2} \sum_{\vb*{i}} U_{\vb*{i}} n_{\vb*{i}},
    \end{aligned}
\]
这里我们重新定义
\begin{equation}
    U_{\vb*{i}} = 2 V_{\vb*{i} \vb*{i} \vb*{i} \vb*{i}}.
\end{equation}
第二项实际上是密度-密度相互作用，即为
\[
    \sum_{\vb*{i}, \vb*{j}, \sigma, \sigma'} V_{\vb*{i} \vb*{j} \vb*{j} \vb*{i}} c^\dagger_{\vb*{i} \sigma} c^\dagger_{\vb*{j} \sigma'} c_{\vb*{j} \sigma'} c_{\vb*{i} \sigma} = \sum_{\pair{\vb*{i}, \vb*{j}}} V_{\vb*{i} \vb*{j}}n_{\vb*{i}} n_{\vb*{j}},
\]
其中我们重新定义了$V_{\vb*{i} \vb*{j}} = V_{ijji}$。泡利矩阵的点乘有下面的有用结果：
\begin{equation}
    \vb*{\sigma}_{\alpha \beta} \cdot \vb*{\sigma}_{\alpha' \beta'} = 2 \delta_{\alpha \beta'} \delta_{\beta \alpha'} - \delta_{\alpha \beta} \delta_{\alpha' \beta'},
    \label{eq:pauli-dot-product}
\end{equation}
于是可以验证
\[
    \sum_{\vb*{i}, \vb*{j}, \sigma, \sigma'} V_{\vb*{i} \vb*{j} \vb*{i} \vb*{j}} c^\dagger_{\vb*{i} \sigma} c^\dagger_{\vb*{j} \sigma'} c_{\vb*{i} \sigma'} c_{\vb*{j} \sigma} = - 2 \sum_{\pair{\vb*{i}, \vb*{j}}} V_{\vb*{i} \vb*{j} \vb*{i} \vb*{j}} \left( \vb*{S}_{\vb*{i}} \cdot \vb*{S}_{\vb*{j}} + \frac{1}{4}n_{\vb*{i}} n_{\vb*{j}} \right).
\]
我们把上式右边的第二项吸收进$V_{\vb*{i} \vb*{j}}$中，并且重新定义$2V_{ijij}=J_{ij}$，于是总的相互作用哈密顿量就是
\[
    \sum_{\vb*{i}} U_{\vb*{i}} n_{\vb*{i} \uparrow} n_{\vb*{i} \downarrow} + \sum_{\pair{\vb*{i}, \vb*{j}}} V_{\vb*{i} \vb*{j}}n_{\vb*{i}} n_{\vb*{j}} - \sum_{\pair{\vb*{i}, \vb*{j}}} J_{\vb*{i} \vb*{j}} \vb*{S}_{\vb*{i}} \cdot \vb*{S}_{\vb*{j}} + \sum_{\vb*{i}} U_{\vb*{i}}n_{\vb*{i}}.
\]
由空间平移对称性，on-site repulsion肯定是均一的，这样我们可以将$\sum_{\vb*{i}} U_{\vb*{i}}n_{\vb*{i}}$丢进化学势中；而如果它不是均一的，就意味着系统实际上不具有完美的离散平移对称结构，即系统中存在无序，直观地看，就是散布的杂质对电子产生散射，这基本上是一个单体算符，于是我们就得到了紧束缚模型最一般的哈密顿量：
\begin{equation}
    H = - \sum_{\pair{\vb*{i}, \vb*{j}}, \sigma} t_{\vb*{i}, \vb*{j}} c^\dagger_{\vb*{i} \sigma} c_{\vb*{j} \sigma} 
    + \sum_{\vb*{i}} U_{\vb*{i}} n_{\vb*{i} \uparrow} n_{\vb*{i} \downarrow} 
    + \sum_{\pair{\vb*{i}, \vb*{j}}} V_{\vb*{i} \vb*{j}} n_{\vb*{i}} n_{\vb*{j}} - \sum_{\pair{\vb*{i}, \vb*{j}}} J_{\vb*{i} \vb*{j}} \vb*{S}_{\vb*{i}} \cdot \vb*{S}_{\vb*{j}} 
    - \mu \sum_{\vb*{i}} n_{\vb*{i}} + \sum_{\vb*{i}, \vb*{j}, \sigma, \sigma'} \epsilon_{\vb*{i} \vb*{j} \alpha \beta} c^\dagger_{\vb*{i} \alpha} c_{\vb*{j} \beta}.  
    \label{eq:tight-binding-single-band-interaction}
\end{equation}
这里的每一项都是有意义的，从左到右分别是：
\begin{enumerate}
    \item 动能项，衡量电子在格点之间跳跃的可能性；
    \item on-site repulsion，这一项是宏观经典模型中唯一重要的密度-密度库伦排斥，仅考虑这个相互作用得到的模型是所谓\concept{Hubbard模型}；
    \item 密度-密度相互作用项，可能导致系统中出现持续的、不能平息的电子密度涨落，即所谓电荷密度波；
    \item 自旋-自旋相互作用项，这一项来自所谓的交换相互作用（一个例子是做Hartree-Fock近似时的交换能，见\eqref{eq:hartree-fock-scf-with-spin}），可能导致出现自旋密度波，这一项意味着在有多个轨道的情况下，每个轨道上放置一个电子，且所有电子的自旋都平行时，系统能量最低，这是洪特规则的一个例子，不过通常说的“洪特相互作用”很多时候指的同个原子的各个壳层电子之间的相互作用；
    \item 化学势，调节系统中电子个数；
    \item 无序，可能来自杂质或是晶格的缺陷。
\end{enumerate}

\subsection{紧束缚近似成立时的多能带相互作用通道}

以上的讨论集中在单能带模型中。在有多个能带时，我们需要使用八个标签标记相互作用通道：有四个标签标记格点，四个标签标记能带编号。
对格点的标签，可以使用\autoref{sec:single-band-interaction-channel}开头的论证，仅有的可能是$\vb*{i}=\vb*{i}'=\vb*{j}=\vb*{j}'$，或是$\vb*{i}=\vb*{j} \neq \vb*{i}'=\vb*{j}'$，或是$\vb*{i}=\vb*{j}' \neq \vb*{i}' = \vb*{j}$，所以我们只需要讨论不同能带之间的相互作用情况。

对on-site repulsion项，即$i=i'=j=j'$的情况，容易看出其多能带版本是
\[
    \sum_{\vb*{i}, \sigma, \sigma'} \sum_{m, m', n, n'} V_{\vb*{i} \vb*{i} \vb*{i} \vb*{i},mm' nn'} c^\dagger_{\vb*{i} m \sigma} 
\]

实际的原子内部的洪特规则应该就是在这里能够拿到

\subsection{能带理论何时失效？}

基本自由度\emph{不能}写成经过相互作用修饰的能带电子的系统通常称为\concept{强关联系统}（电子间的相互作用导致一个电子受到扰动别的电子也会跟着发生变化就称为\concept{电子关联}），因为电子和电子之间的关系是如此剧烈，以至于单电子图像根本就是不可靠的。
本节给出一些能够暗示能带理论失效的判据，并且列举强关联系统通常会有什么性质。

如果能带计算出现平带，即非常窄的能带，则容易出现强关联系统。
可以从好几个角度看这个现象：态密度反比于群速度，从而能带越窄，态密度越大，自然相互作用也越大；能带窄也意味着电子动能低，因此相互作用能不需要太大就能够产生显著的效果。
如前所述，紧束缚模型通常具有这种特征，向紧束缚模型加入相互作用是容易产生强关联系统的。

即使是能带理论失效的情况下，能带的概念也是有意义的，因为它毕竟提供了一个合理的“自由理论”，我们可以向它加入各种相互作用来得到合适的强关联理论。