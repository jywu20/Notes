\documentclass[UTF8, a4paper]{ctexart}

\usepackage{geometry}
\usepackage{titling}
\usepackage{titlesec}
\usepackage{paralist}
\usepackage{footnote}
\usepackage{enumerate}
\usepackage{amsmath, amssymb, amsthm}
\usepackage{cite}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{physics}
\usepackage{siunitx}
\usepackage{tikz-feynhand}
\usepackage[colorlinks, linkcolor=black, anchorcolor=black, citecolor=black]{hyperref}
\usepackage{prettyref}

\geometry{left=3.28cm,right=3.28cm,top=2.54cm,bottom=2.54cm}
\titlespacing{\paragraph}{0pt}{1pt}{10pt}[20pt]
\setlength{\droptitle}{-5em}
\preauthor{\vspace{-10pt}\begin{center}}
\postauthor{\par\end{center}}

\newcommand*{\ee}{\mathrm{e}}
\newcommand*{\ii}{\mathrm{i}}
\newcommand*{\const}{\mathrm{const}}
\newcommand*{\natnums}{\mathbb{N}}
\newcommand*{\reals}{\mathbb{R}}
\newcommand*{\complexes}{\mathbb{C}}
\DeclareMathOperator{\timeorder}{T}
\newcommand*{\ogroup}[1]{\mathrm{O}(#1)}
\newcommand*{\sogroup}[1]{\mathrm{SO}(#1)}
\DeclareMathOperator{\legpoly}{P}

\newrefformat{sec}{第\ref{#1}节}
\newrefformat{note}{注\ref{#1}}
\newrefformat{fig}{图\ref{#1}}
\renewcommand{\autoref}{\prettyref}

\newcommand{\concept}[1]{\underline{#1}}
\renewcommand{\emph}{\textbf}

\tikzfeynhandset{
    every boldphoton@@/.style={
    /tikz/draw=none,
    /tikz/postaction={
            /tikz/draw,
            /tikz/double,
            /tikz/line width = \feynhandlinesize,
            /tikz/decoration={
                complete sines,
                amplitude=3\feynhandlinesize,
                segment length=7.5\feynhandlinesize,
            },
            /tikz/decorate=true,
        },
    },
    every boldphoton/.style={/tikzfeynhand/every boldphoton@@/.append style={#1}},
    boldphoton/.style={
    /tikzfeynhand/every boldphoton@@,
    }
}

\title{非线性光学}
\author{吴晋渊}

\begin{document}

\maketitle

\section{何时非线性效应出现？}

当一束光%
\footnote{
    本文中“一束光”通常指单频率的一束光，空间位置相近但是包含两个频率分量的光经常称为“两束光”。
}%
照射在介质上时，分子、原子中的电子会离开其原有位置，并受到一个回复力。
如果光照较弱，电子总是可以看成简谐振子，从而电子自己发出的电磁辐射的频率和入射光的频率是完全一样的，电磁辐射的幅度正比于入射光的幅度，于是可以写出外场和总场之间的线性关系，从而得到所谓的\concept{线性光学}。
但是，如果光照非常强，非线性效应就会出现。强激光光源的出现让对这一领域的实验研究成为可能。

\subsection{激光}

本节首先介绍强光如何能够产生。

如果我们能够有一个长期保持粒子数反转的系统（显然需要持续的能量输入），那么向这个系统入射一束光将会产生更强的出射光，因为会有受激发射，且受激发射出的光和入射光是非常相干的。
因此我们向粒子数反转的系统注入的能量可以用于增强入射光，并且如果入射光相干性非常好，那么出射光也保持非常好的相干性，并且比入射光更亮，这就是\concept{激光}。

最简单的方案——使用一个二能级系统，直接通过一次入射来得到激光——是不现实的，因为此时大量的能量会消耗在保持粒子数反转上，而为了 TODO
两个可能的改进：将粒子数反转的系统放在一个四壁强反射的腔体内，从而光束可以来回走，不断被增强，并且使用一个三能级系统，其中间能级是一个亚稳态，从而很容易制造粒子数反转。
可以在腔体的一个地方“开洞”——比如说让反射率稍微低一些——让一些光子泄露出来，激光就从这里被导出。

多光子过程：可以避免光学屏障，以及排除荧光本底

\section{非线性光学过程的经典模型}\label{sec:classical-models}

\subsection{非线性谐振子模型}\label{sec:classical-oscillator}

本节将材料当成一系列谐振子的组合，并且暂时不考虑谐振子之间的相互作用。
这是相对合理的，因为能够长距离传输光的介质一般不是金属，从而电子是相对定域的。
然而，这并不意味着我们的理论是自由的。
我们知道一个标准的经典谐振子可以用
\begin{equation}
    m \dv[2]{x}{t} + m \gamma \dv{x}{t} + m \omega_0^2 x = q E
\end{equation}
来描述，而如果我们加上诸如$x^3$这样的项，即让谐振子的回复力为非线性的，就可以造成谐振子模式发生自相互作用。
我们讨论的问题的能量都并不高，谐振子运动不会特别快，因此可以认为谐振子只产生电场，并且其方式为“电偶极子产生库伦场”。
用作用量表示，就是% TODO:有误，这里的关键在于qxE可以给出电场对电荷的作用，但是是否能够给出电荷对电场的作用？？或者说，电场和电荷的相互作用拉氏量或是哈密顿量要怎么写？？
\[
    S = \int \dd{t} \left( \frac{1}{2} m \dot{x}^2 - \frac{1}{2} k x^2 + \text{higher order $x^n$} + qxE \right).
\]
现在积掉谐振子，就能够得到非线性的光子-光子过程，即多个光子和一或是一个光子分裂为多个光子。

\subsubsection{二阶非线性极化}

我们现在在谐振子能量中加入一个三次项，即在运动方程中加入一个二次回复力：
\begin{equation}
    m \dv[2]{x}{t} + m \gamma \dv{x}{t} + m \omega_0^2 x + m a x^2 = q E.
    \label{eq:x3-eq}
\end{equation}
这相当于在能量中加入了一个$\frac{1}{3} m a x^3$项。这个项破坏了系统的中心反演对称性。
我们实际上是要从电场计算$x$（从$x$计算响应电场的公式是显然的，就是大量偶极子加总为$\vb*{P}$然后从$\vb*{P}$出发算电场）。

对这个问题的标准的处理是微扰求解微分方程，但是实际上可以使用费曼图分析这个问题。由于只考虑经典情况，无需计算圈图。
“经典情况”到底指的是什么需要进一步说明：在经典情况下我们没有二次量子化，粒子图景的经典理论和场的图景的经典理论还不一样。
粒子图景下运动方程是关于各个粒子的位置和动量的，入射和出射外线没有任何限制。
场的图景下，我们求解系统的基本自由度（在这里是电场和谐振子坐标）的运动方程，得到场变量随时间的变化情况，即实际上在求解$\expval*{\phi}$，因此只能有一条出射外线，入射外线应当被当成外源。
在经典极限下这两种图景不会造成太大差别：同一张图的外线数目是固定的，在场的图景下，出射外线多了外源就少，由于我们要求场强满足$\phi / \hbar \ll 1$（但与此同时能标又没有高到多顶角图非常重要，从而圈图修正有必要计算），外源较少的过程是非常不重要的。

我们采用后一种图景，因为我们实际上就是在微扰求解\eqref{eq:x3-eq}。
将电磁场和带有$x^3$形势能的非线性振子耦合，则费曼图中应该有\autoref{fig:x3-vertex}和\autoref{fig:light-osci-couple}两种基本元件。
应当注意这里的短直线代表的是$x$的某个频率的分量，如果做量子化，就是一个谐振子模式。
这里的传播子并不代表谐振子的状态本身。这也就是\autoref{fig:light-osci-couple}顶角中只有一条短直线而不是两条的原因：它代表一个入射光子激发出一个谐振子模式，而不是谐振子整体吸收一个光子之后变成另一个状态。
由于电场和谐振子的耦合是完全线性的（并且由于谐振子是一个没有空间分布的点，实际上耦合项就是电偶极子能量），且我们关心的是“非线性介质中有哪些光学过程”，可以将电场暂时当成背景场，于是\autoref{fig:light-osci-couple}应该被\autoref{fig:external-field}取代。
例如，我们只需要分析一阶过程\autoref{fig:first-order-x3-external}就能知道\autoref{fig:first-order-x3-photon}的来源——如果$E$让$x$产生非线性响应，那就有光子分裂和合并的过程。

费曼规则可以很容易地写出：（我们认为频率为$\omega$的成分携带$\ee^{- \ii \omega t}$因子）
\begin{itemize}
    \item 传播子为
    \[
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \propag [plain, mom={$\omega$}] (a) to (b); 
            \end{feynhand}
        \end{tikzpicture} = \frac{\ii}{m (\omega^2 + \ii \gamma \omega - \omega_0^2)}.
    \]
    \item 顶角为
    \[
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (-1,-1); \vertex (b) at (1,-1); \vertex (c) at (0,1);
                \vertex (o) at (0,0); 
                \propag [plain] (a) to (o);
                \propag [plain] (b) to (o); 
                \propag [plain] (c) to (o);    
            \end{feynhand}
        \end{tikzpicture} = - \ii 2 m a \cdot 2\pi \delta(\sum \omega).
    \]
    注意正常情况下$x^3$相互作用要配一个$1/3!$的因子但是这里只有$1/3$，因此顶角实际上是$2ma$而不是$ma$。
    \item 外源为
    \[
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex [crossdot] (a) at (0, 0){};
                \vertex (b) at (1, 0);
                \propag [plain, mom={$\omega$}] (a) to (b); 
            \end{feynhand}
        \end{tikzpicture} = \ii q E(\omega).
    \]
    请注意这里没有负号，而$x^3$是负号的，这是因为均匀电场会倾向于把谐振子拉向无穷远处而回复力则会将谐振子拉回来。
    本节采取的傅里叶变换约定为
    \[
        E(t) = \int \dd{\omega} E(\omega) \ee^{- \ii \omega t},
    \]
    没有加入$2\pi$是因为很多时候入射光并不是连续谱，而是离散的几个频域分量加起来。
\end{itemize}

\begin{figure}
    \centering
    \subfigure[$x^3$自相互作用顶角]{
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (-1,-1); \vertex (b) at (1,-1); \vertex (c) at (0,1);
                \vertex [dot] (o) at (0,0) {}; 
                \propag [plain] (a) to (o);
                \propag [plain] (b) to (o); 
                \propag [plain] (c) to (o);    
            \end{feynhand}
        \end{tikzpicture}
        \label{fig:x3-vertex}
    }
    \subfigure[光子激发出一个谐振子模式]{
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (-1, 1.5);
                \vertex (b) at (0, 1.5);
                \vertex (c) at (1, 1.5);
                \propag [photon] (a) to (b);
                \propag [plain] (b) to (c);
            \end{feynhand}
        \end{tikzpicture}
        \label{fig:light-osci-couple}
    }
    \subfigure[外源驱动谐振子，即\autoref{fig:light-osci-couple}中的光子被当成无动力学的外场后得到的图形]{
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex [crossdot] (a) at (0, 0) {};
                \vertex (b) at (1, 0);
                \propag [plain] (a) to (b);
            \end{feynhand}
        \end{tikzpicture}
        \label{fig:external-field}
    }
    \caption{加入$\frac{1}{3} m a x^3$势能之后的费曼图元件}
\end{figure}

\begin{figure}
    \centering
    \subfigure[外场导致的响应的一阶近似]{
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex [crossdot] (a) at (-1,-1) {};
                \vertex [crossdot] (b) at (1,-1) {}; 
                \vertex (c) at (0,1);
                \vertex (o) at (0,0) ; 
                \propag [plain, mom={$\omega_1$}] (a) to (o);
                \propag [plain, mom={$\omega_2$}] (b) to (o); 
                \propag [plain, mom={$\omega_1 + \omega_2$}] (o) to (c);
            \end{feynhand}
        \end{tikzpicture}
        \label{fig:first-order-x3-external}
    }
    \subfigure[\autoref{fig:first-order-x3-external}导致的非线性光学过程]{
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a0) at (-1.5, -1.5);
                \vertex (a) at (-0.5,-0.5);
                \vertex (b0) at (1.5, -1.5);
                \vertex (b) at (0.5,-0.5); 
                \vertex (c) at (0,0.5);
                \vertex (c0) at (0, 1.5);
                \vertex (o) at (0,0) ; 
                \propag [photon, mom={$\omega_1$}] (a0) to (a);
                \propag [plain] (a) to (o);
                \propag [photon, mom={$\omega_2$}] (b0) to (b);
                \propag [plain] (b) to (o); 
                \propag [plain] (o) to (c);
                \propag [photon, mom={$\omega_1 + \omega_2$}] (c) to (c0);
            \end{feynhand}
        \end{tikzpicture}
        \label{fig:first-order-x3-photon}
    }
    \caption{一阶过程}
    \label{fig:x3-first-order}
\end{figure}

据此，线性响应（零阶，没有发生任何非线性效应）为
\begin{equation}
    x_1(\omega) = \ii q E(\omega) \frac{\ii}{m (\omega^2 + \ii \gamma \omega - \omega_0^2)} = \frac{q / m}{\omega_0^2 - \omega^2 - \ii \gamma \omega} E(\omega).
\end{equation}
一阶过程（即\autoref{fig:first-order-x3-external}）给出如下修正：
\begin{equation}
    \begin{aligned}
        x_2(\omega) &= \frac{1}{2} \int \omega_1 \int \omega_2 (\ii q E(\omega_1)) (\ii q E(\omega_2)) \frac{\ii}{m(\omega_1^2 + \ii \gamma \omega_1 - \omega_0^2)} \frac{\ii}{m(\omega_2^2 + \ii \gamma \omega_2 - \omega_0^2)} \\ 
        &\quad \quad \times (-\ii 2 m a) \frac{\ii}{(m(\omega_1 + \omega_2)^2 + \ii \gamma (\omega_1 + \omega_2) - \omega_0^2)} 2\pi \delta(\omega_1 + \omega_2 - \omega) \\
        &= \int \dd{\omega_1} \int \dd{\omega_2} \frac{a (q / m)^2}{(\omega_1^2 + \ii \gamma \omega_1 - \omega_0^2) (\omega_2^2 + \ii \gamma \omega_2 - \omega_0^2) (\omega^2 + \ii \gamma \omega - \omega_0^2)}  \\
        &\quad \quad \times 2\pi \delta(\omega_1 + \omega_2 - \omega) \times E(\omega_1) E(\omega_2).
    \end{aligned} 
    \label{eq:continuous-x3-first-order}
\end{equation}
这里需要注意一点：\autoref{fig:first-order-x3-external}中外场出现了两次，而
\[
    E(t)^2 = \int \dd{\omega_1} \int \dd{\omega_2} E(\omega_1) E(\omega_2) \ee^{-\ii (\omega_1 + \omega_2) t},
\]
如果$\omega_1 \neq \omega_2$那么$E(\omega_1) E(\omega_2)$项实际上会被求和两次；同样，此时\eqref{eq:continuous-x3-first-order}中的$E(\omega_1) E(\omega_2)$项也会被求和两次。
直观地看，外场是给定的而不能随意交换，所以\autoref{fig:first-order-x3-external}中的两个外场从左到右为$\omega_1$和$\omega_2$的图和从左到右为$\omega_2$和$\omega_1$的图虽然给出一样的结果，但是是两张图，不能看成一张图，它们加起来会导致因子$2$出现。
如果我们令$E(t)$实际上只有两个频率分量，这一点会显得尤其明显。

现在我们采取更加常规的，微扰求解微分方程的做法。费曼图计算已经告诉我们主要的光学过程来自\autoref{fig:first-order-x3-external}。
因此，我们将输入的$E$设置为
\begin{equation}
    E = E_1 (\ee^{\ii \omega_1 t} + \ee^{-\ii \omega_1 t}) + E_2 (\ee^{\ii \omega_2 t} + \ee^{-\ii \omega_2 t}), 
    \label{eq:input-two-freq-e}
\end{equation}
做展开
\begin{equation}
    x = x_1 + x_2 + \ldots, \quad x_n \sim E^{n },
\end{equation}
并记
\begin{equation}
    x_i = \sum_n x_i(\omega_n) + \text{c.c.}.
\end{equation}
线性项$x_1$由
\[
    m \ddot{x}_1 + m \gamma \dot{x_1} +  m \omega_0^2 x_1 = q E
\]
给出，为
\begin{equation}
    x_1(\omega_1) = \frac{(q/m) E_i}{\omega_0^2 } \ee^{-\ii \omega_n t},
\end{equation}
二阶项由
% TODO:懒得写了
这些项分别称为：
\begin{itemize}
    \item \concept{和频（SFG, sum frequency generation）}，
    \item \concept{差频（DFG, difference frequency generation）}，
    \item \concept{倍频（SHG, second harmonic generation）}，
    \item \concept{光学整流（OR, optic rectification）}（因为输入交流波而得到直流波，那当然是整流了）。
\end{itemize}
倍频是和频的特殊情况，光学整流是差频的特殊情况。当然，直接将\eqref{eq:input-two-freq-e}代入\eqref{eq:continuous-x3-first-order}也能够得到这些过程。

乍一看，费曼图方法不仅能够得到两个光子合并为一个光子的过程，也能够得到一个光子分裂成两个光子的过程（所谓的\concept{SPDC过程（Spontaneous parametric down-conversion）}，也称为\concept{OPG过程（Optical parametric generation）}），但是我们后面将看到，微分方程方法似乎只能给出两个光子合并为一个光子的过程——如果我们在$E$中放入只有一个频率$\omega_0$的波，那么非线性效应似乎只会给出$\omega=0$和$\omega=2\omega_0$两种波。
但是其实这里并没有矛盾：SPDC过程需要两条出射外线；如前所述，我们采用场的图景，由于我们采用微分方程的写法，即从$E$求解$x$（其实是$\expval*{x}$），然后用“谐振子位置的偏离导致极化电场产生”计算总电场的变化，对$x$也要采用场的图景，所以的确只应该考虑只有一条外线的费曼图。
这暗示着SPDC过程实际上是非常弱的（本该如此，和频过程的振幅正比于$E^2$而SPDC过程的振幅正比于$E$），因此在经典图景下这个过程根本就不会出现。%
\footnote{
    从这里也可以看出光学中量子理论的重要性，即使我们讨论的能标自始至终都没有高到让只有QED才有的过程（如四光子等效相互作用）出现。
    经典理论对电磁波的描述是非常粗糙的：如果我们要描述一个物理状态中有两种不同频率的光子，应该怎么做？
    在经典理论中只有一种方法：设
    \[
        \vb*{E} = \vb*{E}_1 \ee^{\ii \omega_1 t} + \vb*{E}_2 \ee^{\ii \omega_2 t} + \text{c.c.}.
    \]
    现在如果要将从一个单频波到以上状态的过程画成费曼图，由于只能画一条外线的图，势必只能画出$\omega_0 \to \omega_1$和$\omega_0 \to \omega_2$两个图，然后能量就不守恒了。
}%

这并不是说SPDC过程——或者说OPG过程——在适用经典近似的体系中完全看不到，因为我们可以在OPG过程后面再放一个DFG过程。
DFG过程也可以称为\concept{OPA过程（Optical parametric amplification）}，因为它让入射的两束光的一束变弱而另一束变强。
例如，设我们希望将一束频率为$\omega_1$的光分裂成两束光，频率分别是$\omega_2$和$\omega_3$。
我们可以将一个有二阶非线性极化的光学晶体放在一个内壁对频率为$\omega_2$和$\omega_3$的反射率很高的谐振腔中。
按照后面会提到的\eqref{eq:sfg-intensity}，如果有相位匹配条件成立，那么$\omega_1 \to \omega_2 + \omega_3$的OPG过程转化效率很高（在那里是SFG过程效率很高，这里就是OPG过程转化效率很高），于是产生足够强的$\omega_2$光束和$\omega_3$光束，这些光束被谐振腔反射回来，回到非线性晶体内部，于是发生很强的OPA过程。
因此，我们仅仅通过一束单频入射光就得到了两束不同频率的出射光。
% TODO：怎么定量算？
在经典理论中OPA过程是允许的，因此时间反演对称性并没有丧失：的的确确可以有光子的分裂。
但是，经典理论中所有电磁波模式上的光子都是足够多的，因此从“完全没有光子”到“有一个光子”的过程在经典理论中无法被描述。这就是OPG过程看不到的原因。
换而言之，经典理论中的光子分裂，即OPA，不仅需要入射的泵浦光，还需要一个（直观上看，引导泵浦光分裂成哪些频率的光的）\concept{种子光}。
一旦种子光入射了，随着光的传播它会增强。

\begin{figure}
    \centering
    \subfigure[外场导致的响应的二阶近似]{
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex [crossdot] (a) at (-1,-1) {};
                \vertex [crossdot] (b) at (1,-1) {}; 
                \vertex (c) at (0,1);
                \vertex (o) at (0,0) ;
                \vertex [crossdot] (e) at (1, 2) {};
                \vertex  (f) at (-1, 2) ; 
                \propag [plain, mom={$\omega_1$}] (a) to (o);
                \propag [plain, mom={$\omega_2$}] (b) to (o); 
                \propag [plain, mom={$\omega_1 + \omega_2$}] (o) to (c);
                \propag [plain, mom={$\omega_3$}] (e) to (c);
                \propag [plain, mom={$\omega_1 + \omega_2 + \omega_3$}] (c) to (f);
            \end{feynhand}
        \end{tikzpicture}
        \label{fig:second-order-x3-external}
    }
    \subfigure[\autoref{fig:second-order-x3-external}导致的非线性光学过程]{
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a0) at (-1.5, -1.5);
                \vertex (a) at (-0.5,-0.5);
                \vertex (b0) at (1.5, -1.5);
                \vertex (b) at (0.5,-0.5); 
                \vertex (c) at (0,0.5);
                \vertex (o) at (0,0) ; 
                \vertex (d) at (0.5, 1);
                \vertex (e) at (-0.5, 1);
                \vertex (d0) at (1.5, 2);
                \vertex (e0) at (-1.5, 2);
                \propag [photon, mom={$\omega_1$}] (a0) to (a);
                \propag [plain] (a) to (o);
                \propag [photon, mom={$\omega_2$}] (b0) to (b);
                \propag [plain] (b) to (o); 
                \propag [plain] (o) to (c);
                \propag [plain] (c) to (e);
                \propag [plain] (c) to (d);
                \propag [photon, mom={$\omega_3$}] (d0) to (d);
                \propag [photon, mom={$\omega_1 + \omega_2 + \omega_3$}] (e) to (e0);
            \end{feynhand}
        \end{tikzpicture}
        \label{fig:second-order-x3-photon}
    }
    \caption{二阶过程}
    \label{fig:x3-second-order}
\end{figure}

还可以进一步往上计算微扰。例如，二阶微扰将给出\autoref{fig:x3-second-order}。
这里给出的四光子相互作用和\autoref{fig:first-order-x3-photon}产生的等效四光子相互作用不同，后者需要两个光子先合并，产生的光子传播一会，然后再和另一个光子合并。
\autoref{fig:second-order-x3-photon}给出的四光子相互作用是直截了当的。

我们来对各阶微扰的量级做一个估计。如果$\omega$和$\omega_0$比较接近，那么微扰论根本就不适用：此时共振发生，$x$是非常大的，可能高阶修正比低阶修正还大。
此时需要从头做光和物质耦合的计算而不能使用加入微弱非线性因素的振子模型。
如果$\omega$远大于$\omega_0$，我们将得到等离子体，此时彼此无关的、振幅不大的振子的图像更加失效了，可能晶格都已经被破坏了，电子的运动状况主要受电场控制。
在这两种情况下本节给出的非线性振子模型都不适用。（等离子体情况下有另一个非线性来源，即协变导数的输运项；见后文）
对$\omega \ll \omega_0$的情况，线性响应的振幅的量级为
\[
    x_1 \sim \frac{(q/m) E}{\omega_0^2},
\]
而
\[
    x_2 \sim \frac{a (q/m)^2 E^2}{\omega_0^6},
\]
因此
\begin{equation}
    \frac{x_2}{x_1} \sim \frac{a q E}{m \omega_0^4}.
\end{equation}
设原子对电子的束缚电场的量级为$E_\text{atom}$，则总位移$x$的振幅可以估计为
\[
    q E_\text{atom} \sim m \omega_0^2 x .
\]
$x$的量级具体有多大是不确定的，它包括没有外加电场时由$q E_\text{atom}$做回复力的内禀振荡，线性响应$x_1$和非线性响应$x_2$。
我们不妨采取一个非常极端的假设，认为线性回复力和非线性回复力已经一样大了（如果非线性回复力很小，那么当然只需要计算一阶图），此时
\[
    m \omega_0^2 x \sim m a x^2,
\]
于是
\[
    q E_\text{atom} \sim m \omega_0^2 \frac{\omega_0^2}{a},
\]
最后
\begin{equation}
    \frac{x_2}{x_1} \sim \frac{E}{E_\text{atom}}.
\end{equation}
通常原子内部电场的数量级为\SI{3e8}{V/m}，因此即使认为非线性回复力和线性回复力一样大，一般来说$x_2$也远小于$x_1$，即此时非线性极化相对于线性极化来说还是不大的。
介质的光学性能由极化给出，和回复力没有直接关系，因此非线性极化一般来说总是比非线性极化小得多的。
类似地实际上可以证明
\begin{equation}
    \frac{x_{n+1}}{x_n} \sim \frac{E}{E_\text{atom}}.
\end{equation}

\subsubsection{三阶非线性极化}

\subsection{自由电子气的输运项}

此时的非线性效应来自$(\vb*{v} \cdot \grad) \vb*{v}$

金属表面也能够产生二次谐波

\section{极化的量子理论}

\autoref{sec:classical-oscillator}中我们以光子和经典谐振子的振动模式为基本自由度，通过为谐振子引入一个非二次型的势来得到非线性效应。
这种做法在量子理论中当然也是成立的，并且此时谐振子的振动模式真的就像一个个粒子一样。
然而，应当注意，这种“光子和谐振子振动模式相互作用，谐振子的振动模式通过非简谐的势能相互作用”的理论并不是最方便的，因为无论为振子——在这里实际上就是原子中的电子——引入怎样的非线性势，我们有的都是一个单体问题，因此最终电子自身的能谱都可以被一系列能级完整描述，并且这些能级是比较容易算出来的。
光子与电子碰撞会让电子从一个能级跳到另一个能级，并且能量守恒条件——其中电子的能量由已经经过非二次型势能修正的能级给出——必须成立。
这意味着，首先考虑非简谐的势能的作用，计算出电子能级，然后考虑光子让电子在这些能级之间跃迁，是更加方便的。
这个图景在经典理论中无法使用，因为此时的光子吸收相互作用顶角有一条入射线，两条出射线，从而一个有光子出射的过程一定有多条出射线（至少一条光子线，以及一条雷打不动的电子出射线），从而无法在经典理论中表达。

在基于电子能级的图景中，非线性光学效应来自高阶微扰论，因为一张费曼图中可以有数量任意的入射和出射光子线，另一方面，电子线除了和光子相互作用以外，没有别的相互作用。
这和基于非线性振子的图景非常不同，在后者中一个光子只能连接到一条内线上，即光子到振子振动模式的转换始终是线性的，但是振子振动模式之间可以碰撞，从而有非线性过程。
遮去电子线，将电子的非线性响应表示为宏观的“极化”，以上两种图景统一变成了\autoref{sec:non-linear-maxwell}中的图景。

\section{非线性极化的麦克斯韦方程}\label{sec:non-linear-maxwell}

本节将从一个比较唯象的角度描述经典非线性光学——我们忽略所有微观细节，只是去解麦克斯韦方程组，不过在这里，$\vb*{P}$和$\vb*{E}$之间的关系不再是线性的。
一般来说$E \sim \SI{1}{kV/cm}$时非线性效应变得重要起来。

\subsection{非线性波动方程的建立和微扰求解}

\subsubsection{均匀介质中的传播}

本节讨论均匀非线性介质中的光的传播。在大部分情况下介质对电磁波中的磁场的响应都是可以忽略的，因此介质对光的影响可以概括为极化。
以下我们用短直线代表极化$P$，用波浪线代表电场；后者的意义一目了然，前者和前面几节的意义其实也是一样的，因为无非有
\[
    \vb*{P} = N q \vb*{x},
\]
其中$N$为单位体积的谐振子数目。我们知道极化强度矢量可以产生一个电场。我们有波动方程
\[
    \curl{(\curl{\vb*{E}})} + \frac{1}{\epsilon_0 c^2} \pdv[2]{\vb*{D}}{t} = 0,
\]
代入$\vb*{D}$的定义，就得到
\begin{equation}
    \curl{(\curl{\vb*{E}})} + \frac{1}{c^2} \pdv[2]{\vb*{E}}{t} = - \frac{1}{\epsilon_0 c^2} \pdv[2]{\vb*{P}}{t}.
\end{equation}
实际上，这就是“电流作为一个天线，发出电磁波”，只不过此时天线是由总电场驱动的，从而上式左边和右边都有$\vb*{E}$，并且由于$\vb*{P}$和$\vb*{E}$之间的关心是非线性的，上式关于$\vb*{E}$也是非线性的。
不过，从$\vb*{P}$到$\vb*{E}$的关系的确是完全线性的，因此可以使用
\begin{equation}
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \vertex (c) at (2, 0);

                \propag[plain] (a) to (b);
                \propag[photon] (b) to (c);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} = - \left( \curl{\curl{}} + \frac{1}{c^2} \pdv[2]{t} \right)^{-1} \frac{1}{\epsilon_0 c^2} \pdv[2]{\vb*{P}}{t}
\end{equation}
表示。这是$\vb*{P}$消灭而光子产生的过程，看起来非常直观：一个天线上的激发态消失了，取而代之的是天线发出来的光。
本节讨论的是均匀介质，我们可以认为$\grad{\rho_\text{p}}=0$，从而$\grad{\div{\vb*{P}}}=0$，从而就得到$\div{\vb*{E}} = 0$。这样一来我们要求解的就是
\begin{equation}
    - \laplacian \vb*{E} + \frac{1}{c^2} \pdv[2]{\vb*{E}}{t} = -\frac{1}{\epsilon_0 c^2} \pdv[2]{\vb*{P}}{t},
\end{equation}
而
\begin{equation}
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \vertex (c) at (2, 0);

                \propag[plain] (a) to (b);
                \propag[photon] (b) to (c);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} = \left( \laplacian - \frac{1}{c^2} \pdv[2]{t} \right)^{-1} \frac{1}{\epsilon_0 c^2} \pdv[2]{\vb*{P}}{t}.
\end{equation}

此外我们还有任意的形如
\begin{equation}
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (-0.8, 0.25) ;
                \vertex (b) at (-0.8, -0.25) ;
                \vertex (d) at (0, -1) {$\ldots$};
                \vertex (c) at (0, 0);
                \vertex (e) at (1, 0);

                \propag[photon] (a) to (c);
                \propag[photon] (b) to (c);
                \propag[photon] (d) to (c);
                \propag[plain] (c) to (e);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} = \epsilon_0 \chi^{(n)}_{i_1 i_2 \ldots i_n}
\end{equation}
的产生$\vb*{P}$的顶角，代表$n$阶非线性极化（一阶极化是线性的），使得
\[
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[crossdot] (a) at (-0.8, 0.25) {};
                \vertex[crossdot] (b) at (-0.8, -0.25) {};
                \vertex (d) at (0, -1) {$\ldots$};
                \vertex (c) at (0, 0);
                \vertex (e) at (1, 0);

                \propag[photon] (a) to (c);
                \propag[photon] (b) to (c);
                \propag[photon] (d) to (c);
                \propag[plain] (c) to (e);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} = \epsilon_0 \vb*{\chi}^{(n)} : \vb*{E} \vb*{E} \cdots \vb*{E}.
\]
线性光学中只有一条入射线，非线性光学中可以有多条。

这就是非线性波动方程中的所有顶角了。我们马上可以发现一件事，就是虽然看起来$\vb*{P}$场能够有自能修正
\[
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \propag[double] (a) to (b);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} = \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \propag[plain] (a) to (b);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} + 
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \vertex (c) at (2, 0);
                \vertex (d) at (3, 0);
                \propag[plain] (a) to (b);
                \propag[photon] (b) to (c);
                \propag[plain] (c) to (d);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} + \cdots,
\]
但是，因为我们讨论的所有过程都以光子开始以光子结束，加上入射和出射线之后上式实际上是光的自能修正。因此实际上$\vb*{P}$只是一个辅助量，我们可以将
\[
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \vertex (c) at (2, 0);
                \vertex (d) at (3, 0);
                \propag[photon] (a) to (b);
                \propag[plain] (b) to (c);
                \propag[photon] (c) to (d);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered}
\]
看成一个整体。当然，本该如此。

我们要求解外加电场下的总场。这就是说，要计算
\[
    \begin{aligned}
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1.25, 0);
                    \propag[boldphoton] (a) to (b);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} &= 
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \propag[photon] (a) to (b);
                \end{feynhand}
            \end{tikzpicture} 
        \end{gathered} + 
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (2, 0);
                    \vertex (d) at (3, 0);
                    \propag[photon] (a) to (b);
                    \propag[plain] (b) to (c);
                    \propag[photon] (c) to (d);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} + \cdots \\
        &+ \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (-0.8, 0.25) {};
                    \vertex[crossdot] (b) at (-0.8, -0.25) {};
                    \vertex (d) at (0, -1) {$\ldots$};
                    \vertex (c) at (0, 0);
                    \vertex (e) at (1, 0);
                    \vertex (f) at (2, 0);
    
                    \propag[photon] (a) to (c);
                    \propag[photon] (b) to (c);
                    \propag[photon] (d) to (c);
                    \propag[plain] (c) to (e);
                    \propag[photon] (e) to (f);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered}
    \end{aligned}
\]
请注意上式左边的源不是$\otimes$而是一个灰色圆圈，因为非线性效应的存在让我们不知道外源被用到了多少次。
上式直接计算当然是非常复杂的，我们做重求和，根据最后一个顶角是什么，可以将上式写成
\begin{equation}
    \begin{aligned}
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1.25, 0);
                    \propag[boldphoton] (a) to (b);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} &= \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \propag[photon] (a) to (b);
                \end{feynhand}
            \end{tikzpicture} 
        \end{gathered} +
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (1.6, 0);
                    \vertex (d) at (2.2, 0);
                    \propag[boldphoton] (a) to (b);
                    \propag[plain] (b) to (c);
                    \propag[photon] (c) to (d);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} +
        \sum \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (-1.2, 0.5) {};
                    \vertex[grayblob] (b) at (-1.2, -0.5) {};
                    \vertex (f) at (0, -1) {$\ldots$};
                    \vertex (c) at (0, 0);
                    \vertex (d) at (0.75, 0);
                    \vertex (e) at (1.5, 0);
    
                    \propag[boldphoton] (a) to (c);
                    \propag[boldphoton] (b) to (c);
                    \propag[boldphoton] (f) to (c);
                    \propag[plain] (c) to (d);
                    \propag[photon] (d) to (e);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} \\
        &= \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \propag[photon] (a) to (b);
                \end{feynhand}
            \end{tikzpicture} 
        \end{gathered} +
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (2, 0);
                    \propag[plain] (a) to (b);
                    \propag[photon] (b) to (c);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} \ .
    \end{aligned}
\end{equation}
当然，这就是
\[
    \vb*{E} = \vb*{E}_\text{ext} + \left( \laplacian - \frac{1}{c^2} \pdv[2]{t} \right)^{-1} \frac{1}{\epsilon_0 c^2} \pdv[2]{\vb*{P}}{t} ,
\]
稍加变形就会发现实际上这就是
\[
    \left( \laplacian - \frac{1}{c^2} \pdv[2]{t} \right) (\vb*{E} - \vb*{E}_\text{ext}) = \frac{1}{\epsilon_0 c^2} \pdv[2]{\vb*{P}}{t}.
\]
求解出上式中的$\vb*{E}$就完全确定了外加电场下的总场。“外加电场”当然是一个不良定义的概念，但这是因为我们将$\otimes$的来源省去了；它可能来自介质中的电荷或是介质两边的极板（归根到底，也是一些电荷），无论如何不来自$\vb*{P}$，即它是“没有经过相互作用修正的”，从而
\[
    \left( \laplacian - \frac{1}{c^2} \pdv[2]{t} \right) \vb*{E}_\text{ext} = 0.
\]
如果将理论量子化，它就是入射的近乎自由的粒子。我们经常称外加电场为\concept{泵浦光}，因为它将材料中的电子激发。%
\footnote{
    只要满足这个形式的电场分量都有机会被称为泵浦光。因此这个概念的确有定义模糊的地方。它可以指代从空气射向介质的入射光，可以指代将空气-介质界面当成线性介质界面而获得的折射光，甚至我们不能排除它指代经过局域场修正之后的折射光。
    本节讨论均匀介质内部的宏观问题，因此泵浦光不是从空气到介质的入射光也不需要做局域场修正。
}%

不过，具体什么是“相互作用修正”仍然有选择的余地，如我们可以将线性极化（即$\vb*{P}$关于$\vb*{E}$是线性的那部分；从$\vb*{P}$到$\vb*{E}$的转换则完全是线性的）部分作为自能修正重求和，然后将经过线性极化修正的光束（也就是服从关于不等于$\epsilon_0$的$\epsilon$的线性麦克斯韦方程组的光束）重新定义为\begin{tikzpicture}
    \begin{feynhand}
        \vertex (a) at (0, 0);
        \vertex (b) at (1, 0);
        \propag[photon] (a) to (b);
    \end{feynhand}
\end{tikzpicture}，此时\begin{tikzpicture}
    \begin{feynhand}
        \vertex (a) at (0, 0);
        \vertex (b) at (1, 0);
        \vertex (c) at (2, 0);

        \propag[plain] (a) to (b);
        \propag[photon] (b) to (c);
    \end{feynhand}
\end{tikzpicture}也需要调整（原本的意思是总的$\vb*{P}$产生真空中电场的响应函数，现在的意思是（非线性的）$\vb*{P}$产生线性介质中电场的响应函数），引入$\epsilon_{ij}$张量，然后顶角只剩下一种，就有
\begin{equation}
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[grayblob] (a) at (0, 0) {};
                \vertex (b) at (1.25, 0);
                \propag[boldphoton] (a) to (b);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} = \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[crossdot] (a) at (0, 0) {};
                \vertex (b) at (1, 0);
                \propag[photon] (a) to (b);
            \end{feynhand}
        \end{tikzpicture} 
    \end{gathered} +
    \sum \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[grayblob] (a) at (-1.2, 0.5) {};
                \vertex[grayblob] (b) at (-1.2, -0.5) {};
                \vertex (f) at (0, -1) {$\ldots$};
                \vertex (c) at (0, 0);
                \vertex (d) at (0.75, 0);
                \vertex (e) at (1.5, 0);

                \propag[boldphoton] (a) to (c);
                \propag[boldphoton] (b) to (c);
                \propag[boldphoton] (f) to (c);
                \propag[plain] (c) to (d);
                \propag[photon] (d) to (e);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} \ ,
\end{equation}
即
\begin{equation}
    \left( \laplacian - \frac{\vb*{\epsilon}_\text{r} \cdot}{c^2} \pdv[2]{t} \right) (\vb*{E} - \vb*{E}_\text{ext}) = \left( \laplacian - \frac{\vb*{\epsilon}_\text{r} \cdot}{c^2} \pdv[2]{t} \right) \vb*{E} = \frac{1}{\epsilon_0 c^2} \pdv[2]{\vb*{P}_\text{NL}}{t},
    \label{eq:nonlinear-maxwell-eq}
\end{equation}
其中NL表示非线性。这样做的好处一目了然：线性极化相当于对光速做了一个修正，是可以严格处理的，从而可以将主要精力集中在非线性极化上。

一个在线性光学中也会出现的现象是\concept{局域场强化}。这个现象来自于，从$\vb*{P}$产生的电场在空间上可能有比较大的变化，我们关心的是空间平均过之后的电场，即只是从$\vb*{P}$产生的电场的低频傅里叶分量。
因此我们做分解
\begin{equation}
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \vertex (c) at (2, 0);

                \propag[plain] (a) to (b);
                \propag[photon] (b) to (c);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} = 
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \vertex (c) at (2, 0);

                \propag[plain] (a) to (b);
                \propag[photon, mom={$\text{low $k$}$}] (b) to (c);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} + 
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \vertex (c) at (2, 0);

                \propag[plain] (a) to (b);
                \propag[photon, mom={$\text{high $k$}$}] (b) to (c);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered},
\end{equation}
那么就有
\begin{equation}
    \begin{aligned}
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1.25, 0);
                    \propag[boldphoton, mom={$\text{low $k$}$}] (a) to (b);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} &= \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \propag[photon, mom={$\text{low $k$}$}] (a) to (b);
                \end{feynhand}
            \end{tikzpicture} 
        \end{gathered} +
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (1.6, 0);
                    \vertex (d) at (2.2, 0);
                    \propag[boldphoton] (a) to (b);
                    \propag[plain] (b) to (c);
                    \propag[photon, mom={$\text{low $k$}$}] (c) to (d);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} +
        \sum \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (-1.2, 0.5) {};
                    \vertex[grayblob] (b) at (-1.2, -0.5) {};
                    \vertex (f) at (0, -1) {$\ldots$};
                    \vertex (c) at (0, 0);
                    \vertex (d) at (0.75, 0);
                    \vertex (e) at (1.5, 0);
    
                    \propag[boldphoton] (a) to (c);
                    \propag[boldphoton] (b) to (c);
                    \propag[boldphoton] (f) to (c);
                    \propag[plain] (c) to (d);
                    \propag[photon, mom={$\text{low $k$}$}] (d) to (e);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} \\
        &= \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \propag[photon, mom={$\text{low $k$}$}] (a) to (b);
                \end{feynhand}
            \end{tikzpicture} 
        \end{gathered} +
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (2, 0);
                    \propag[plain] (a) to (b);
                    \propag[photon, mom={$\text{low $k$}$}] (b) to (c);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} \ .
    \end{aligned}
    \label{eq:non-linear-smooth-p-e}
\end{equation}
然而，在上式中与$\vb*{P}$有关的图中的入射电场却没有做这个动量截断。
其结果是我们无法单纯从上式计算经过动量截断的出射电场，即我们需要手动提供没做动量截断的入射电场。
由于入射电场通常只具有低频分量，即
\[
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[crossdot] (a) at (0, 0) {};
                \vertex (b) at (1, 0);
                \propag[photon, mom={$\text{low $k$}$}] (a) to (b);
            \end{feynhand}
        \end{tikzpicture} 
    \end{gathered} = \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[crossdot] (a) at (0, 0) {};
                \vertex (b) at (1, 0);
                \propag[photon] (a) to (b);
            \end{feynhand}
        \end{tikzpicture} 
    \end{gathered},
\]
我们有
\[
    \begin{aligned}
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1.25, 0);
                    \propag[boldphoton, mom={$\text{high $k$}$}] (a) to (b);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} &= 
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (1.6, 0);
                    \vertex (d) at (2.5, 0);
                    \propag[boldphoton] (a) to (b);
                    \propag[plain] (b) to (c);
                    \propag[photon, mom={$\text{high $k$}$}] (c) to (d);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} +
        \sum \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (-1.2, 0.5) {};
                    \vertex[grayblob] (b) at (-1.2, -0.5) {};
                    \vertex (f) at (0, -1) {$\ldots$};
                    \vertex (c) at (0, 0);
                    \vertex (d) at (0.75, 0);
                    \vertex (e) at (1.5, 0);
    
                    \propag[boldphoton] (a) to (c);
                    \propag[boldphoton] (b) to (c);
                    \propag[boldphoton] (f) to (c);
                    \propag[plain] (c) to (d);
                    \propag[photon, mom={$\text{high $k$}$}] (d) to (e);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} \\
        &= \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (2, 0);
                    \propag[plain] (a) to (b);
                    \propag[photon, mom={$\text{high $k$}$}] (b) to (c);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} \ ,
    \end{aligned}
\]
于是就有
\begin{equation}
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[grayblob] (a) at (0, 0) {};
                \vertex (b) at (1.25, 0);
                \propag[boldphoton] (a) to (b);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} = \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[grayblob] (a) at (0, 0) {};
                \vertex (b) at (1.25, 0);
                \propag[boldphoton, mom={$\text{low $k$}$}] (a) to (b);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} + 
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[grayblob] (a) at (0, 0) {};
                \vertex (b) at (1, 0);
                \vertex (c) at (2, 0);
                \propag[plain] (a) to (b);
                \propag[photon, mom={$\text{high $k$}$}] (b) to (c);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered}.
    \label{eq:local-field-enhancement-diagram}
\end{equation}
联立计算\eqref{eq:non-linear-smooth-p-e}和\eqref{eq:local-field-enhancement-diagram}（求解过程中很容易看到，虽然$\vb*{P}$是辅助量但是确实能够简化书写），就得到外场作用下的做了动量截断的$\vb*{E}$——实际上，由于宏观下我们讨论的“介质中电场”一般都是均一化的电场，我们将做了动量截断的$\vb*{E}$就称为$\vb*{E}$。%
\footnote{
    电动力学教科书上通常会泛泛地说这是“做了宏观平均的电场”，实际上这就是动量截断。
    要看出这是为什么，注意到“做了宏观平均的电场”总是可以通过一个体积为$V$的移动平均给出：
    \[
        \bar{\vb*{E}}(\vb*{r}) = \frac{1}{V} \int \dd[3]{\vb*{r}'} \vb*{E}(\vb*{r}'),
    \]
    做傅里叶展开，有
    \[
        \begin{aligned}
            \bar{\vb*{E}}(\vb*{r}) &= \frac{1}{V} \int \dd[3]{\vb*{r}'} \int \frac{\dd[3]{\vb*{k}}}{(2\pi)^3} \vb*{E}(\vb*{k}) \ee^{\ii \vb*{k} \cdot \vb*{r}'} \\
            &= \int \frac{\dd[3]{\vb*{k}}}{(2\pi)^3} \vb*{E}(\vb*{k}) \frac{1}{V} \int \dd[3]{\vb*{r}'} \ee^{\ii \vb*{k} \cdot \vb*{r}'},
        \end{aligned}
    \]
    显然对那些较大的$\vb*{k}$，对$\vb*{r}'$的积分会由于快速振荡而变成零，于是我们就得到了一个动量截断。
}%
此时\eqref{eq:local-field-enhancement-diagram}应当理解为“靠近介质粒子时电场的局域增强”。
在这种视角下，有
\begin{equation}
    \begin{aligned}
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1.25, 0);
                    \propag[boldphoton] (a) to (b);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} &= \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \propag[photon] (a) to (b);
                \end{feynhand}
            \end{tikzpicture} 
        \end{gathered} +
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (1.6, 0);
                    \vertex (d) at (2.2, 0);
                    \propag[boldphoton, mom={$\text{enhanced}$}] (a) to (b);
                    \propag[plain] (b) to (c);
                    \propag[photon] (c) to (d);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} +
        \sum \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (-1.2, 0.5) {};
                    \vertex[grayblob] (b) at (-1.2, -0.5) {};
                    \vertex (f) at (0, -1) {$\ldots$};
                    \vertex (c) at (0, 0);
                    \vertex (d) at (0.75, 0);
                    \vertex (e) at (1.5, 0);
    
                    \propag[boldphoton, mom={$\text{enhanced}$}] (a) to (c);
                    \propag[boldphoton, mom={$\text{enhanced}$}] (b) to (c);
                    \propag[boldphoton, mom={$\text{enhanced}$}] (f) to (c);
                    \propag[plain] (c) to (d);
                    \propag[photon] (d) to (e);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} \\
        &= \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \propag[photon] (a) to (b);
                \end{feynhand}
            \end{tikzpicture} 
        \end{gathered} +
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (2, 0);
                    \propag[plain] (a) to (b);
                    \propag[photon] (b) to (c);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} , \\
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1.25, 0);
                    \propag[boldphoton, mom={$\text{enhanced}$}] (a) to (b);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} &= \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1.25, 0);
                    \propag[boldphoton] (a) to (b);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} + 
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (2, 0);
                    \propag[plain] (a) to (b);
                    \propag[photon, mom={$\text{high $k$}$}] (b) to (c);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered}.
    \end{aligned}
\end{equation}

\subsubsection{边界条件}

边界，反射，折射：在线性的折射、反射上引入三个相互作用，一个是介质内部的光子-光子和频和差频，一个是入射端，介质内部两个光子打在边界上然后返回形成一个光子，一个是出射端，两个光子打在边界上然后一起出射。

\subsubsection{哪些解是重要的？}

非线性光学和线性光学非常不同的地方是，在线性光学中，给定一个时谐的（并且通常是平面波的，因为介质一般都很大，近似空间平移不变）泵浦光，计算入射导致的响应以及总电场，我们就得到了一个\emph{稳定的}模式；一个任意的入射波传入介质后的行为可以直接根据入射波在各个模式上的分量计算出来。
这意味着在线性光学中我们无需为任意的泵浦光求解麦克斯韦方程：只需要得到线性波动方程的所有振动模式就可以，各个振动模式的形状决定了这个光学系统的全部信息；场论上，这是自由场的情况。
线性性也意味着一个光束可以被分割成许多波包，计算每个波包的时间演化，加起来就得到光束的时间演化——实际上，我们经常反过来用线性性，即先求解一个系统中的电磁波模式（其时间演化是平凡的）然后诠释说“这意味着光先走到这里再走到那里”。
非线性光学则不同，输出和激励并没有简单的线性关系。不过实际上，这并不意味着我们真的需要为所有的泵浦场独立地从头求解非线性波动方程。

首先，我们看到\eqref{eq:nonlinear-maxwell-eq}相对于时间是线性的。这意味着我们可以在时间的频域求解\eqref{eq:nonlinear-maxwell-eq}。
也就是说，\eqref{eq:nonlinear-maxwell-eq}的全体时谐解已经包含了诸如“两个略有错开的波包打进介质将会如何反应”之类的瞬态问题的答案——只要入射波包不过于极端，以至于非线性麦克斯韦方程不再适用（如非常快导致介质来不及弛豫或是过强导致介质损坏等）。
在线性光学中这是常用的手段：例如，我们求解了时谐场在金属中的衰减，就可以不重新求解麦克斯韦方程就知道一个波包在金属中如何衰减，做一个傅里叶变换就行了：稳态问题提供了瞬态问题的答案，而前者往往更加容易做具体计算。
非线性光学中这个手段也是适用的。
因此，我们会在频域求解\eqref{eq:nonlinear-maxwell-eq}，然后看着光强随着光束前进的\emph{距离}发生的变化，评论说“波包随着传播\emph{时间}发生的变化”，因为两者是可以互相转化的。

其次，似乎存在这样一个疑难：在后文中我们将会求解诸如“泵浦光含有两个频率成分，它们都是平面波”这样的问题，但是实际上我们能够制备的光都是含有很多混杂的成分的，那么有什么理由保证后者发生的现象和前者一致？
例如，设泵浦光为
\[
    \vb*{E}^\text{ext} = \vb*{E}_1 \ee^{-\ii \omega_1 t} + \vb*{E}_2 \ee^{-\ii \omega_2 t} + \text{c.c.},
\]
微扰求解得到输出光为
\[
    \vb*{E} = \alpha^{(1)}(\omega_1) \vb*{E}_1 \ee^{-\ii \omega_1 t} + \alpha^{(1)}(\omega_2) \vb*{E}_2 \ee^{-\ii \omega_2 t} + \alpha^{(2)}(\omega_3 = \omega_1 + \omega_2) : \vb*{E}_1 \vb*{E}_2 \ee^{-\ii (\omega_1 + \omega_2) t} + \cdots + \text{c.c.}.
\]
现在如果我们要将泵浦光取为
\[
    \vb*{E}^\text{ext}(t) = \int \dd{\omega} \ee^{-\ii \omega t} \vb*{E}^\text{ext}(\omega),
\]
那么输出光$E(t)$不能通过简单地做一个傅里叶变换获得。
但其实我们可以效仿量子场论中的做法来解决这个问题。
我们要做的事情是通过计算\eqref{eq:nonlinear-maxwell-eq}的一些特解来获得通用的“看到泵浦光-写出输出光”的方法，这相当于我们在积掉整个光学系统，直接得到泵浦光的各个频率分量和输出的非线性谐波之间的关系。
所以其实可以采用量子场论中计算等效相互作用顶角的标准方法，即只计算连通图：设泵浦光包含$n$个（频率不同的）单频成分，微扰求解\eqref{eq:nonlinear-maxwell-eq}，只计算那些完全连通且正好包含$n$个\begin{tikzpicture}
    \begin{feynhand}
        \vertex[crossdot] (a) at (0, 0) {};
        \vertex (b) at (1, 0);
        \propag[photon] (a) to (b);
    \end{feynhand}
\end{tikzpicture}的图（后一个条件是为了保证我们计算的是$n$阶非线性过程，前一个条件是为了保证低于$n$阶的非线性过程没有被重复计数），这样可以得到形如$\alpha^{(n)} \vb*{E} \vb*{E} \cdots \vb*{E}$的响应，输出光就是
\[
    \vb*{E} = \int \dd{\omega} \alpha^{(1)}(\omega) \vb*{E}^\text{ext}(\omega) \ee^{-\ii \omega t} + \int \dd{\omega_1} \int \dd{\omega_2} \alpha^{(2)}(\omega_1 + \omega_2) : \vb*{E}^\text{ext}(\omega_1) \vb*{E}^\text{ext}(\omega_2) \ee^{-\ii (\omega_1 + \omega_2) t} + \cdots.
\]
请注意由于不存在圈图，每个$\alpha^{(n)}$中的图的数目是有限的，从而可以精确计算而不需要对圈数做截断等。

总之，虽然非线性光学问题比线性光学复杂上不少，我们仍然可以只计算泵浦光为若干个单频光叠加的情况，并且计算到给定的微扰阶数，这样足够提取到足够多的关于非线性光学体系的信息。

\subsection{近似求解方法}

由前述讨论，我们只要拿到非线性极化$\vb*{P}_\text{NL}$，就能够完全确定一个介质的非线性光学性能，只需要计算向介质中输入若干束单频光得到的输出就够了。
此时对\eqref{eq:nonlinear-maxwell-eq}做时域傅里叶变换，就得到不同频率的电场的空间分布方程，$\vb*{P}_\text{NL}$中如果有电场的$n-1$次方，这就是\concept{$n$波混频方程}。

求解

\section{二阶非线性极化的波动光学}

之前已经讨论过一个问题：具有两个频率分量的泵浦光被打入具有二阶非线性极化的材料中，计算和频光的强度。本节用非线性波动方程重新计算它。
二阶非线性极化意味着材料的中心反演对称性破缺。

\subsection{SFG过程的一阶微扰}

\subsubsection{输入光为两束泵浦光}

我们考虑一个最为简单的情况：各向同性介质，泵浦光足够强，以至于在介质中泵浦光几乎没有衰减，即做了\concept{泵浦波无衰减近似}。
假定泵浦光中有两个频率分量的光，它们的偏振方向均相同。取其波矢指向为$z$轴。
我们用$E_i$指代第$i$种傅里叶分量，用$A_i$表示其大小，即
\[
    E_i = \ee^{\ii k_i z - \ii \omega_i t} A_i + \ee^{- \ii k_i z + \ii \omega_i t} A_i^*.
\]
在线性光学中只取正频率或是负频率的分量不会造成任何问题，并且通常会让问题更加容易，但是我们现在在讨论非线性过程，因此$E$必须是实际的入射光，显然必须是实数。
这样，非线性极化导致的一阶微扰中%
\footnote{
    “阶”在本文中有两个意思，一个是非线性光学过程的阶数，$n$阶非线性光学过程就是$n$束光变成一束光；还有一个意思是微扰计算的阶数。
    前者描述单个顶角的粒子线数目，后者描述一张图中顶角的总数。
}%
，SFG过程给出修正（我们为何只考虑SFG过程，而且只考虑$\omega_2$和$\omega_3$指定的SFG过程马上就可以看到；相位匹配条件决定了SFG过程和DFG过程等不太可能同时很重要）
\[
    \left( \pdv[2]{z} - \frac{\epsilon_\text{r}}{c^2} \pdv[2]{t} \right) E_3 = \frac{1}{\epsilon_0 c^2} \pdv[2]{t} \left( 2 \epsilon_0  \chi^{(2)} A_1 A_2 \ee^{\ii (k_1 + k_2) z} \ee^{-\ii \omega_3 t} \right) + \text{h.c.},
\]
其中我们设$\omega_3 = \omega_1 + \omega_2$，$\chi^{(2)}$指的是$\chi^{(2)}(\omega_3=\omega_1+\omega_2)$。
请注意没有什么能够保证线性极化是频率无关的——没有理由认为$\omega=\omega(k)$是线性的。
$E_3$的频率当然还是$\omega_3$。我们假定$E_3$大体上仍然是一个平面波（即做了\concept{平面波近似}），但是随着$z$增大，$A_3$会有变化。这样就有
\[
    \ee^{\ii k_3 z - \ii \omega_3 t} \left( \pdv[2]{z} + 2 \ii k_3 \pdv{z} - k_3^2 + \frac{\epsilon_\text{r}}{c^2} \omega^2 \right) A_3 = - \frac{\omega_3^2}{\epsilon_0 c^2} 2 \epsilon_0  \chi^{(2)} A_1 A_2 \ee^{\ii (k_1 + k_2) z} \ee^{-\ii \omega_3 t} .
\]
由于色散关系可以不是线性的，从而$k_3$和$k_1 + k_2$完全可以不同。
上式左边括号中最后两项抵消了。再做\emph{慢变振幅近似}（几何光学中就做了这一近似，也可以称为旁轴近似），就有
\[
    \pdv{z} A_3 = \frac{\ii \omega_3^2}{k_3 c^2} \chi^{(2)} A_1 A_2 \ee^{\ii (k_1 + k_2 - k_3) z}.
\]
求解这一方程，考虑到泵浦光中没有$E_3$分量，从而$z=0$处$A_3=0$，以及晶体厚度为$L$，就得到
\begin{equation}
    A_3(L) = \frac{\ii \chi^{(2)} \omega_3^2 A_1 A_2}{k_3 c^2} \left( \frac{\ee^{\ii \Delta k L} - 1}{\ii \Delta k} \right),
    \label{eq:two-pump-a3}
\end{equation}
其中
\begin{equation}
    \Delta k = k_1 + k_2 - k_3.
\end{equation}
$E_3$分量的强度是
\[
    I_3 = \expval*{\epsilon_0 n c E_3^2} = 2 \epsilon_0 n c \abs*{A_3}^2,
\]
于是就得到
\begin{equation}
    I_3 = \frac{8 \epsilon_0 (\chi^{(2)})^2 \abs*{A_1}^2 \abs*{A_2}^2 \omega_3^2}{nc} \frac{\sin^2(\Delta k L / 2)}{(\Delta k)^2} = \frac{(\chi^{(2)})^2 \omega_3^2 I_1 I_2}{2 \epsilon_0 c^3 n_1 n_2 n_3} \mathrm{sinc}^2 \left( \frac{\Delta k L}{2} \right) L^2.
    \label{eq:sfg-intensity}
\end{equation}

如果\concept{相位匹配条件}——即$k_3 = k_1 + k_2$——的确成立，那么$I_3$就稳定地随着$L^2$增大而线性增大，此时的SFG转换效率是非常高的。
当然，$L$大到一定程度时，$I_1$和$I_2$就开始随着$L$增大而下降，并且吸收也开始明显了。
大部分情况下相位匹配条件是没法成立的，因为色散非线性。此时随着$L$的增大，能量先是从$E_1$和$E_2$移向$E_3$模式，然后再从$E_3$模式移向$E_1$和$E_2$模式。
大约需要
\begin{equation}
    L_\text{coh} = \frac{1}{\Delta k}
\end{equation}
的距离可以看到明显的能量转移，这个长度称为\concept{相干长度}。

相位匹配条件叫做这个名字并非没有原因。在某个位置$z$处新产生的$E_3$光大体上形如
\[
    E_3 \sim E_1 E_2 \sim A_1 A_2 \ee^{\ii (k_1 + k_2) z - \ii (\omega_1 + \omega_2) t},
\]
如果$\Delta k \neq 0$，那么新产生的$E_3$光和原来已有的$E_3$光就会有一个不断变化的相位差，在一些地方它们会发生相消干涉。
这就是$\Delta k \neq 0$时$E_3$光强度发生振荡的原因。

相位匹配时才有较高效的能量转换这一事实实际上大大简化了我们的分析。
原则上，我们将频率为$\omega_1$和$\omega_2$的光输入一个非线性晶体，所有过程——和频，差频，倍频，光学整流——都会发生，因此我们\emph{不能}只取一个过程并按照它写出振幅分布方程。
例如，种子光可以因为DFG过程而指数上升，也可以因为SFG过程而振荡，这两个效应按理说应该叠加，然后反过来影响SFG和DFG产生的光的强度。
然而，很多时候，入射光给定之后SFG和DFG过程或者其它一些过程不能同时满足相位匹配条件，从而\eqref{eq:sfg-intensity}分母中的$\Delta k$会压低$I_3$能够达到的最大值。
因此，其实可以分开计算每个过程。
在有广谱的输入光——如制作光谱仪时——这个近似可能不再适用，此时需要做完整的三波混频方程求解。

\subsubsection{输入光为泵浦光和种子光}

本节考虑一个有些不同的情况：输入光还是有两个频率分量，但是其中一个频率分量是很弱的，从而SFG过程产生的光的幅度振荡的同时，那个比较弱的光的幅度也会振荡。
用1表示泵浦光，2表示那个频率分量较弱的输入光（即所谓种子光），3表示SFG过程产生的光。
此时的非线性麦克斯韦方程为
\[
    \begin{aligned}
        \left( \pdv[2]{z} - \frac{\epsilon_\text{r}}{c^2} \pdv[2]{t} \right) E_3 &= \frac{1}{\epsilon_0 c^2} \pdv[2]{t} \left( 2 \epsilon_0  \chi^{(2)} A_1 A_2 \ee^{\ii (k_1 + k_2) z} \ee^{-\ii \omega_3 t} \right) + \text{h.c.}, \\
        \left( \pdv[2]{z} - \frac{\epsilon_\text{r}}{c^2} \pdv[2]{t} \right) E_2 &= \frac{1}{\epsilon_0 c^2} \pdv[2]{t} \left( 2 \epsilon_0  \chi^{(2)} A_1^* A_3 \ee^{\ii (- k_1 + k_3) z} \ee^{-\ii \omega_2 t} \right) + \text{h.c.}.
    \end{aligned}
\]
使用和上一节类似的慢变振幅近似，我们有
\begin{equation}
    \begin{aligned}
        \pdv{A_3}{z} &= \frac{\ii \omega_3^2}{k_3 c^2} \chi^{(2)} A_1 A_2 \ee^{\ii \Delta k z}, \\
        \pdv{A_2}{z} &= \frac{\ii \omega_2^2}{k_2 c^2} \chi^{(2)} A_1^* A_3 \ee^{- \ii \Delta k z}.
    \end{aligned}
    \label{eq:pump-and-seed-sfg}
\end{equation}
我们需要尝试将$A_2$和$A_3$的方程解耦。在相位匹配条件成立的情况下，只需要让以上两个方程两边各自对$z$再求一次导数，即可得到分别关于$A_2$和$A_3$的两个二阶微分方程
\[
    \pdv[2]{A_3}{z} = - \frac{\omega_3^2 \omega_2^2}{k_2 k_3 c^4} \abs*{A_1}^2 (\chi^{(2)})^2 A_3, \quad \pdv[2]{A_2}{z} = - \frac{\omega_3^2 \omega_2^2}{k_2 k_3 c^4} \abs*{A_1}^2 (\chi^{(2)})^2 A_2.
\]
在相位匹配条件不成立的时候，对\eqref{eq:pump-and-seed-sfg}中每个方程求导时等式右边会多出来一个$A_2$或$A_3$项，让求解变得困难。
然而，根据之前“相位不匹配会导致新产生的光和已有的光在一些地方发生相消干涉”的物理图像，我们仍然可以确信，相位不匹配会导致能量转化效率下降。

在相位匹配条件成立时，代入边界条件$A_3(0) = 0$，解得
\begin{equation}
    A_2(z) = A_2(0) \cos(k z), \quad A_3(z) = \ii \sqrt{\frac{\omega_3 n_2}{\omega_2 n_3}} \frac{A_1}{\abs*{A_1}} A_2(0) \sin(k z),
\end{equation}
其中
\begin{equation}
    k^2 = \frac{\omega_3^2 \omega_2^2}{k_2 k_3 c^4} \abs*{A_1}^2 (\chi^{(2)})^2. 
\end{equation}
我们发现一开始，能量从$\omega_2$模式转向$\omega_3$模式，但是一段时间之后能量又从$\omega_3$模式转向$\omega_2$模式。
两个耦合的模式如此来回振荡。存在能量从$E_3$模式流向$E_2$模式的过程意味着在完全经典的计算中，SFG过程的逆过程也是可行的，虽然由于没有量子涨落，必须有种子光这个过程才能发生。
在本节计算的例子中，泵浦光$E_1$起到了$\omega_3$转化为$\omega_1$和$\omega_2$的种子光的作用。

\subsection{DFG过程的一阶微扰}

我们现在转而考虑DFG过程。前面提到过，经典理论中DFG过程不能从一束光凭空产生两束光。
于是我们考虑一个这样的过程：$E_3$是基本上不衰减的泵浦光，它将要产生$E_1$和$E_2$两束光；$E_1$光也是输入光，即$E_1$模式上有种子光；$E_2$在$z=0$处为零。
使用慢变振幅近似，有以下方程：
\[
    \begin{aligned}
        \pdv{A_1}{z} &= \frac{\ii \chi^{(2)}(\omega_1 = \omega_3 - \omega_2) \omega_1^2}{k_1 c^2} A_3 A_2^* \ee^{-\ii \Delta k z}, \\
        \pdv{A_2}{z} &= \frac{\ii \chi^{(2)}(\omega_2 = \omega_3 - \omega_1) \omega_2^2}{k_2 c^2} A_3 A_1^* \ee^{-\ii \Delta k z}.
    \end{aligned}
\]
显然我们可以指定
\begin{equation}
    \chi^{(2)}(\omega_1 = \omega_3 - \omega_2) = \chi^{(2)}(\omega_2 = \omega_3 - \omega_1) = \chi^{(2)}.
\end{equation}
求解以上方程，得到
\begin{equation}
    A_1(z) = A_1(0) \cosh(\kappa z), \quad A_2(z) = \ii \sqrt{\frac{n_1 \omega_2}{n_2 \omega_1}} \frac{A_3}{\abs*{A_3}} A_1^*(0) \sinh(\kappa z),
\end{equation}
其中
\begin{equation}
    \kappa^2 = \frac{\omega_1^2 \omega_2^2}{k_1 k_2 c^4} \abs*{A_3}^2 (\chi^{(2)})^2 .
\end{equation}
这里，$\omega_1$和$\omega_2$光都指数增长。这里的关键点在于关于$A_1$的方程右边的$A_2$取了复共轭。
物理图像上，单泵浦光的DFG过程中，$\omega_1$光子的出现能够刺激$\omega_2$光子的出现，反之亦然，因此一旦有$\omega_1$光和泵浦光同时出现，$\omega_1$光和$\omega_2$光就会不断扩增，从而指数增长。
反之，在单泵浦光输入的SFG过程中，产生$\omega_3$光子会消耗$\omega_2$光子，但是$\omega_3$光子不能诱发更多$\omega_1$光子转化为$\omega_2$光子，从而$\omega_2$光子和$\omega_3$光子存在竞争关系。

从以上解可以看到一个有趣的现象，就是种子光$\omega_1$的相位其实是自行决定的，而$\omega_2$光的相位同时由泵浦光$\omega_3$和和种子光$\omega_1$的相位决定。
这意味着非线性晶体不仅可以用来从一个频率的光源产生另一个频率的光源，还可以用于产生相位特定的新光源。

\subsection{相位匹配条件的实现}

如前所述，只有相位匹配时SFG过程或是DFG过程才足够明显。
由于介质色散的存在，相位匹配条件不总是能够完成的。本节讨论给定三个任意频率的光，如何让它们能够满足相位匹配条件。

\subsubsection{借用双折射}

Type I

\begin{equation}
    n^\text{e}_3 \omega_3 = n^\text{o}_1 \omega_1 + n^\text{o}_2 \omega_2
\end{equation}

\begin{equation}
    n^\text{e}_3 \omega_3 = n^\text{o}_1 \omega_1 + n^\text{e}_2 \omega_2
\end{equation}
这样的好处在于可以通过偏振将两束光分开。

问题：Walk off angle，走移角，

如果关心长距离

\subsubsection{准相位匹配}

在$\Delta k$非零但不大——即所谓\concept{准相位匹配}——时，可以通过这样的方法获得高效率的SFG转换：将一系列$\chi^{(2)}$指向周期性倒转的二阶非线性晶体贴在一起，让第一块晶体的厚度是$\pi L_\text{coh} / 2$，后面所有的晶体的厚度都是$\pi L_\text{coh}$。
这样，根据\eqref{eq:sfg-intensity}，走过第一块晶体时，$I_3$强度打到最大值，此时能和$E_3$光发生相长干涉的光的相位是$\pi$；随后进入第二块晶体，$\chi^{(2)}$倒转，根据\eqref{eq:two-pump-a3}，这意味着新产生的$E_3$光获得一个$\pi$的相位，于是第二块晶体内仍然发生了相长干涉；在第二块晶体和第三块晶体的交界处，能和$E_3$发生相长干涉的光的相位是$0$，$\chi^{(2)}$再次倒转，根据\eqref{eq:two-pump-a3}，在第三块晶体中产生的$E_3$光的相位是$0$，于是还是相长干涉……
如此重复即可获得持续增加的$\omega_3$光，虽然其增速不如相位完全匹配时的情况。

准相位匹配已经是成熟的技术。PPLN装置等铁电体阵列是实现准相位匹配的常用装置。

准相位匹配实际上说明了一点，就是晶体的性质有空间起伏时，之前的诸如相位匹配条件的东西都是不能直接适用的。
这就提示我们，晶体内部的元激发——声子或者别的什么——可以借此和光耦合。

\subsection{二阶非线性效应的各种应用}

光纤：？

设我们手头上只有一个频率的光——比如说\SI{800}{nm}的光——而需要得到一束频率低一些的光——比如说\SI{1500}{nm}的光。没有别的光源可用。
这时候可以这么做：首先将\SI{800}{nm}光尽可能聚焦到一个材料中，让super continue generation发生，从而得到一个非常宽的频谱（并且很弱），然后将纯净的\SI{800}{nm}光和这个宽谱光入射到一个二阶非线性晶体当中，这样这两者就分别起到了泵浦光和种子光的作用。
当然，DFG过程产生的光的频率也是宽谱的，但是请注意只有满足相位匹配条件的过程才是最可能发生的。
因此我们可以通过选用适当的非线性晶体，调整温度、入射角度等，让\SI{800}{nm}光变成\SI{1500}{nm}光的过程正好符合相位匹配条件，于是就得到了相当纯净的\SI{1500}{nm}输出光。


OPO装置：入射光

\subsubsection{荧光信号的时间分辨}

荧光持续的时间很长，但是很弱，我们可以在需要仔细分析的时间段制备一个脉冲，将荧光和这个脉冲同时输入一个非线性晶体，就可以把我们需要仔细观察的那一段分离出来。

\subsubsection{光谱学}

\section{三阶非线性极化的波动光学}

光学Korre效应，受激拉曼效应，受激光栅（让光自己产生干涉，然后非线性效应让折射率发生周期性变化，再来一束光，就发生了衍射），CARS

将一个波包压缩成一个阿秒级别的脉冲

\subsection{自相互作用，或者说简并四波混频}

三阶非线性极化允许这样的过程发生：$\omega = \omega - \omega + \omega$，即一束光可以同时提供三个光子，产生同一频率的一个光子。
也即，三阶非线性极化允许单频光自相互作用。在二阶非线性极化中没有这种现象。

\subsubsection{自聚焦}

波列很长的波进入一个各向同性的、中心反演对称的非线性晶体，我们会发现它的折射率大体上是
\begin{equation}
    n = n_0 + \bar{n}_2 \expval*{\vb*{E}(t)^2} = n_0 + 2 \bar{n}_2(\omega) \abs*{\vb*{E}(\omega)}^2,
    \label{eq:ref-index-change}
\end{equation}
其中$n_0$是弱光的折射率而$n_2$是一个二阶折射系数。

如果我们只考虑三阶非线性极化，就有
\[
    \vb*{P}_\text{NL} = 3 \epsilon_0 \chi^{(3)}(\omega=\omega + \omega - \omega) : \vb*{E}(\omega) \vb*{E}(\omega) \vb*{E}(\omega)^*,
\]
在介质各向同性的情况下可以将$\chi^{(3)}$用一个标量代替，它后面的三个电场的乘积和单位张量缩并，于是
\[
    \begin{aligned}
        \vb*{P} &= \epsilon_0 \chi^{(1)}(\omega) \vb*{E}(\omega) +  3 \chi^{(3)}(\omega=\omega + \omega - \omega) : \vb*{E}(\omega) \vb*{E}(\omega) \vb*{E}(\omega)^* \\
        &= \epsilon_0 (\chi^{(1)}(\omega) + 3 \chi^{(3)}(\omega=\omega+\omega-\omega) \abs*{\vb*{E}(\omega)}^2) \vb*{E}(\omega).
    \end{aligned}
\]
折射率的定义为
\[
    n^2 = 1 + \chi,
\]
取小量近似，就得到
\begin{equation}
    n_0(\omega)^2 = 1 + \chi^{(1)}(\omega), \quad \bar{n}_2(\omega) = \frac{3}{4n_0} \chi^{(3)}(\omega=\omega-\omega+\omega).
\end{equation}

我们还可以将折射率写成光的强度
\begin{equation}
    I = \frac{\epsilon_0 c n_0}{2} \abs*{\vb*{E}(\omega)}^2
\end{equation}
的函数，即
\begin{equation}
    n = n_0 + n_2 I,
\end{equation}
其中
\begin{equation}
    n_2 = \frac{4}{\epsilon_0 c n_0} \bar{n}_2.
\end{equation}

折射率会随着入射光强而变化这件事意味着进入三阶非线性晶体的光会\concept{自聚焦}。
如果$\bar{n}_2 > 0$，那么光束中心的光被偏折得更厉害，光束相当于经过了一个凸面镜；反之光束相当于经过了一个凹面镜。
这个等效“透镜”的行为和频率相关，因此自聚焦可以用来设计一个频率筛选装置，即可以用于锁频。
例如，可以在一个谐振腔内部放置两个自聚焦晶体，则只有频率适当的光能够在谐振腔中稳定地来回传播，频率不适当的光经过多次成像，会散得越来越开。

\subsubsection{自相位调节}

光波经过介质之后（相比另一束没有经过介质的光）会有相位变化，而由于$\bar{n}_2$的存在，光波经过一个三阶非线性晶体之后会有一个额外的相位变化
\begin{equation}
    \phi_\text{NL}(t) = \frac{\omega}{c} L n_2 I(t).
\end{equation}
仪器把一束光大体上当成单频光而测它的频率（即所谓\concept{即时频率}，对单色光它就是光的频率，对有多频率光它大概是波包的中心频率），就得到
\[
    \omega_\text{temp} = \pdv{\phi}{t},
\]
于是从三阶非线性晶体出来的光的即时频率会因为非线性效应而变化
\begin{equation}
    \Delta \omega_\text{temp} = - \frac{n_2 \omega L}{c} \pdv{I}{t},
    \label{eq:temp-phase-change}
\end{equation}
即一束多频率的光经过时前面的会看起来更红，后面的会看起来更蓝。
把这束光做频谱分析会发现频谱变宽了。频谱变宽了，时域的波包尺度就会变窄——因此可以用三阶非线性晶体做一个超快激光。
例如可以用三阶非线性晶体做一系列薄片，波包每经过一个薄片，在时域的展宽就窄一些。
我们这里不用一个非常厚的晶体，因为随着频谱变宽，波包的强度会下降，从而$\pdv*{I}{t}$也会下降。因此一个特别长的晶体除了让光束散开来以外并没有什么用处。
同样，表面上，虽然弱光的$I$并不大，但我们可以增大$L$去调节它的相位，但其实这是不现实的。

这其实提醒我们一点：可能可以使用一些特殊的非线性效应反过来补偿色散导致的不同频率的光的相位差，从而让介质中能够产生孤子。
在光纤中这已经有了应用，一些时候可以制造一个展宽为微米级的孤子。

设脉冲在时间上持续了$\tau$，则频谱宽度为
\[
    \Delta \omega \sim \frac{2\pi}{\tau},
\]
而即时频率的变化为$\Delta \phi_\text{NL} / \tau$，因此为了让频率展宽足够明显，应当有
\begin{equation}
    \Delta \phi_\text{NL} \sim 2\pi.
\end{equation}

\subsubsection{自陷}

想象一束已经被聚焦过了，然后被输入一个三阶非线性晶体。例如，可以将三阶非线性晶体放在一个高斯光的光腰上。
自聚焦现象如期发生，让光变得更强，然后自聚焦进一步增强……如果几何光学总是适用，那么最终光束将终结到一个点上。
当然，在此之前衍射已经变得明显了。
这里发生的事情就好像“外压和量子涨落的竞争”，最终形成一个光束尺寸相对稳定的\concept{光丝}。这就是所谓的\concept{自陷}。

光丝并不是一个非常稳定的状态，因为如果介质中有什么东西散射了一下光丝，它的直径就会增大，光强变小，于是自聚焦的逆过程开始发生，最后光束又四散开去。
但如果光丝足够强，它可能已经将介质内部打出一个等离子体通道了，这个时候支配光丝所在区域的光学性质的不是三阶非线性极化，而是等离子体的光学，光丝也就这样一直传播下去了。

我们来估算什么时候自聚焦会发生。假定自聚焦区域内的折射率大体上是均一的（从而自聚焦区域内的$I$是常数，一旦出了自聚焦区域，就快速衰减为零），则自聚焦区域的边界上的临界角为
\[
    \cos \theta_0 = \frac{n_0}{n_0 + \var{n}},
\]
射向边界而入射角大于这个角的光将被反射回去，即不会溢出光丝。
另一方面，光丝会有衍射，即在偏离入射光的传播方向的地方仍然有光传播，衍射角为
\[
    \theta_d = \frac{0.61 \lambda_0}{n_0 d}.
\]
如果很多衍射光的衍射角小于全反射临界角，那么衍射会破坏光丝，而反之光丝可以进一步聚焦。
因此，平衡时，$\theta_0 \sim \theta_d$，于是
\begin{equation}
    d \sim \frac{0.61 \lambda_0}{n_0} \frac{1}{\sqrt{2 n_0 n_2 I}}.
\end{equation}

\begin{equation}
    P_\text{cr} = \frac{\pi d^2}{4} I = \frac{\pi 0.61^2 \lambda_0^2}{8 n_0 n_2}.
\end{equation}

入射光仍然需要走过一段距离才能够形成光丝。

\subsection{光学共轭和非线性光栅}

全息？？

干涉条纹的空间频率是波矢差；干涉条纹因为自相位调节导致折射率光栅

无损光强测量和光开关

谐振腔的光强双稳

\section{光和介质中模式的散射}

布里渊散射，拉曼散射；

\subsection{经典电磁波}

Raman散射可以用一些经典图景分析。我们知道介质中的电子在振动，于是将$\alpha$泰勒展开到一阶，得到
\begin{equation}
    \vb*{P} = \alpha \vb*{E}, \quad \alpha(t) = \alpha_0 + \pdv{\alpha}{Q} Q(t),
\end{equation}
设介质中谐振子正在以$\omega_q$振荡，泵浦光频率为$\omega_l$，则
\begin{equation}
    \vb*{P}(t) = \alpha_0 \vb*{E}_0 \cos(\omega_l t) + \frac{1}{2} \pdv{\alpha}{Q} \vb*{E}_0 Q_0 (\cos(\omega_l + \omega_q) t + \cos(\omega_l - \omega_q)t).
\end{equation}
可以看到我们有三个过程：一个是普通的$\omega_l$光的传播，一个是\concept{Stokes过程}，即输出光频率为$\omega_l - \omega_q$，还有一个是\concept{反Stokes过程}，即输出频率为$\omega_l + \omega_q$。

以上经典图景无法给出一些需要“能级布居数”才能解释的东西。例如，基本上低能级上的电子数目要远大于高能级，因此Stokes过程总是比反Stokes过程容易发生。
实际上这个原理可以用来测定一个已知能谱的系统的温度，因为通过比较Stokes过程和反Stokes过程的发生几率来确定能级布居数，从而推算出温度。
例如，通过声子和光子的耦合，我们可以测量出固体晶格的温度。
分析Raman过程中的$\omega_q$也可以用于确定系统中的各个能级的相对能量差。

在有磁场存在，且两个能级的间距相比磁场并不大的时候，Stokes

现在我们改用量子力学做计算。由于并没有对光场做量子化，只需要做含时微扰即可。
\[
    \dv{W}{\omega} = \frac{2\pi}{\hbar} g(\omega) \abs{\sum_n \left(
        \frac{\mel*{f}{e \vb*{r} \cdot \vb*{E}}{n} \mel*{n}{e \vb*{r} \cdot \vb*{E}}{g}}{\omega_l - }
    \right)}^2
\]

我们在这里遇到了之前遇到过的类似的问题：如果没有频率为$\omega_l + \omega_q$的种子光，似乎拉曼光不能产生。
当然，这是因为我们没有考虑电磁场的量子涨落。我们现在将光场也视为量子化的，即

\begin{equation}
    \dv]{W}{\omega_s} = \frac{8\pi^3 N \omega_l \omega_s}{n_s^2 n_l^2 V} \abs*{\mel{f}{M}{g}}^2 g(\omega) \abs*{\mel*{\alpha_f}{a_s^\dagger a_l}{\alpha_s}}^2
\end{equation}

受激Raman效应中Stokes光似乎可以以$\ee$指数增加。这个机制称为\concept{Stokes激光}，是一种产生激光的机制。
Stokes光的相位和
重点：是否能够保证$\omega_s$是相干的；如果一个材料中的元激发（光学声子、自旋波等）、泵浦光和Stokes光能够持续耦合，“滚着往前跑”，那么就会有比较棘手的东西出现。

受激Raman效应可以用于展宽光谱。

在计算完单次光子-材料中模式的Raman散射之后，我们可以把有关计算结果用于确定宏观参数。我们有
\begin{equation}
    \abs{\vb*{E}_s}^2 = \ee^{G_R z - \alpha_s z} \abs{\vb*{E}_s(0)}^2,
\end{equation}
其中
\begin{equation}
    G_R = \gamma m_l \propto \frac{N}{V} \dv{\sigma}{\Omega} \frac{m_l}{\Gamma},
\end{equation}
其中
\[
    fuck%\frac{N}{V} \dv{\sigma}{\Omega} \sim \SI{10^{-8}}{cm^{-1}}, \quad \Gamma \sim \SI{1}{cm^{-1}}, \quad \gamma \sim %\SI{10^{-3}}{\cm/MW}
\]

使用拉曼散射还可以做高精度测量。其测定精度

拉曼散射

\subsection{自发发射}



\subsection{广义的三波混频}

传播相位和天线相位不同导致相位差。

\subsection{基于拉曼散射的激光冷却}

由于斯托克斯过程和反斯托克斯过程完全是等价的，可以设想，既然能够将激光照在介质上向介质提供能量，当然也可以设法将介质的能量转移到激光中。
实际上，我们可以制备一个腔共振线正好落在反斯托克斯过程上的谐振腔，然后将一些分子放在腔中，并入射激光。
其结果是反斯托克斯过程受到激励，分子不仅没有从激光吸收能量，反而被冷却了。

\section{布里渊散射}

设介质中有声波，则介质性能出现空间起伏，有
\begin{equation}
    \chi(\vb*{r}) = \chi_0 \cos(\vb*{G} \cdot (\vb*{r} - \vb*{v}_{\vb*{G}} t)), \quad \omega_\text{S} = \vb*{G} \cdot \vb*{v}_{\vb*{G}}.
\end{equation}
毫无疑问这会导致一定的光学效应：我们想象一系列折射率不同的介质被贴在一起，一束光被打入其中，则每一层界面都会有微弱的反射，在条件适当的情况下这些反射光相长干涉，产生明显的总的反射。%
\footnote{
    实际上，这样可以获得非常好的反射镜，比镀银的好得多。通过这种方法可以获得5到6个9的反射率。
}%
$\chi$出现周期性起伏的介质就是这样一种系统。
另一个值得注意的地方是反射光会有小的频率变化，因为反射面在动，会有多普勒效应。

在有了以上直觉性的考虑之后我们开始解方程。做通常的拟设

受激布里渊散射会限制光线通讯的激光功率。光纤存在热涨落，时不时就会自发出现声子，

\end{document}